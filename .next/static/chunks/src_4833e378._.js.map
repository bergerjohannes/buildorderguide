{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/Button.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement> {\n  children: React.ReactNode;\n  variant?: \"default\" | \"danger\" | \"secondary\";\n  fullWidth?: boolean;\n}\n\nexport default function Button({\n  children,\n  variant = \"default\",\n  fullWidth = false,\n  className = \"\",\n  ...props\n}: ButtonProps) {\n  const getVariantClasses = () => {\n    switch (variant) {\n      case \"danger\":\n        return \"bg-cancel hover:bg-background text-background hover:text-cancel border border-transparent hover:border-cancel\";\n      case \"secondary\":\n        return \"bg-background hover:bg-foreground text-foreground hover:text-background border border-foreground hover:border-transparent\";\n      case \"default\":\n      default:\n        return \"bg-foreground hover:bg-background text-background hover:text-foreground border border-transparent hover:border-foreground\";\n    }\n  };\n\n  return (\n    <button\n      className={`${getVariantClasses()} ${fullWidth ? \"w-full\" : \"\"} rounded-default font-medium transition-colors duration-200 focus:outline-none cursor-pointer px-4 py-2 text-sm ${className}`}\n      {...props}\n    >\n      {children}\n    </button>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;AAWe,SAAS,OAAO,KAMjB;QANiB,EAC7B,QAAQ,EACR,UAAU,SAAS,EACnB,YAAY,KAAK,EACjB,YAAY,EAAE,EACd,GAAG,OACS,GANiB;IAO7B,MAAM,oBAAoB;QACxB,OAAQ;YACN,KAAK;gBACH,OAAO;YACT,KAAK;gBACH,OAAO;YACT,KAAK;YACL;gBACE,OAAO;QACX;IACF;IAEA,qBACE,6LAAC;QACC,WAAW,AAAC,GAAyB,OAAvB,qBAAoB,KAA+I,OAA5I,YAAY,WAAW,IAAG,oHAA4H,OAAV;QAChL,GAAG,KAAK;kBAER;;;;;;AAGP;KA3BwB","debugId":null}},
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/Navigation.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport Link from \"next/link\";\nimport Image from \"next/image\";\nimport Button from \"@/components/Button\";\nimport { useAuth } from \"@/contexts/AuthContext\";\n\n// MenuItem component for reusable menu items\ninterface MenuItemProps {\n  href: string;\n  children: React.ReactNode;\n  variant?: \"default\" | \"primary\" | \"mobile\";\n  onClick?: () => void;\n  className?: string;\n}\n\nfunction MenuItem({\n  href,\n  children,\n  variant = \"default\",\n  onClick,\n  className = \"\",\n}: MenuItemProps) {\n  const getVariantClasses = () => {\n    switch (variant) {\n      case \"primary\":\n        return \"bg-foreground hover:bg-foreground text-foreground hover:text-foreground px-4 py-2 rounded-default text-sm font-medium transition-colors duration-200\";\n      case \"mobile\":\n        return \"text-foreground hover:text-foreground text-lg font-medium py-3 border-b border-muted\";\n      case \"default\":\n      default:\n        return \"bg-muted hover:bg-muted text-foreground px-4 py-2 rounded-default text-sm font-medium transition-colors duration-200\";\n    }\n  };\n\n  const combinedClassName = `${getVariantClasses()} ${className}`.trim();\n\n  return (\n    <Link href={href} className={combinedClassName} onClick={onClick}>\n      {children}\n    </Link>\n  );\n}\n\n// Special variant for mobile profile/auth buttons\nfunction MobileAuthMenuItem({\n  href,\n  children,\n  variant = \"default\",\n  onClick,\n  className = \"\",\n}: MenuItemProps) {\n  const getVariantClasses = () => {\n    switch (variant) {\n      case \"primary\":\n        return \"block w-full text-center bg-muted hover:bg-foreground text-foreground hover:text-background px-4 py-3 rounded-default text-lg font-medium transition-colors duration-200\";\n      case \"default\":\n      default:\n        return \"block w-full text-center bg-muted hover:bg-foreground text-foreground hover:text-background px-4 py-3 rounded-default text-lg font-medium transition-colors duration-200\";\n    }\n  };\n\n  const combinedClassName = `${getVariantClasses()} ${className}`.trim();\n\n  return (\n    <Link href={href} className={combinedClassName} onClick={onClick}>\n      {children}\n    </Link>\n  );\n}\n\nexport default function Navigation() {\n  const { currentUser } = useAuth();\n  const [isMobileMenuOpen, setIsMobileMenuOpen] = useState(false);\n\n  const toggleMobileMenu = () => {\n    setIsMobileMenuOpen(!isMobileMenuOpen);\n  };\n\n  const closeMobileMenu = () => {\n    setIsMobileMenuOpen(false);\n  };\n\n  return (\n    <>\n      <nav className=\"bg-background shadow-default sticky top-0 z-50\">\n        <div className=\"px-4\">\n          <div className=\"flex justify-between h-16\">\n            {/* Left side - Logo */}\n            <div className=\"flex items-center\">\n              <Link\n                href=\"/\"\n                className=\"flex items-center space-x-2 text-xl font-bold text-foreground\"\n              >\n                <Image\n                  src=\"/images/Other/Logo.png\"\n                  alt=\"Build Order Guide Logo\"\n                  width={32}\n                  height={32}\n                  className=\"flex-shrink-0\"\n                />\n                <span>BUILD ORDER GUIDE</span>\n              </Link>\n            </div>\n\n            {/* Desktop Menu - Right side */}\n            <div className=\"hidden md:flex items-center space-x-3\">\n              <Link href=\"/\">\n                <Button>Builds</Button>\n              </Link>\n              <Link href=\"/uptime\">\n                <Button>Uptime</Button>\n              </Link>\n              <Link href=\"/builder\">\n                <Button>Builder</Button>\n              </Link>\n              <Link href=\"/about\">\n                <Button>About</Button>\n              </Link>\n\n              {/* Auth section */}\n              {currentUser ? (\n                <Link href=\"/profile\">\n                  <Button>Profile</Button>\n                </Link>\n              ) : (\n                <Link href=\"/login\">\n                  <Button>Login</Button>\n                </Link>\n              )}\n            </div>\n\n            {/* Mobile hamburger button */}\n            <div className=\"md:hidden flex items-center\">\n              <Button onClick={toggleMobileMenu} aria-label=\"Toggle menu\">\n                {isMobileMenuOpen ? (\n                  // X icon\n                  <svg\n                    className=\"h-6 w-6\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M6 18L18 6M6 6l12 12\"\n                    />\n                  </svg>\n                ) : (\n                  // Hamburger icon\n                  <svg\n                    className=\"h-6 w-6\"\n                    fill=\"none\"\n                    viewBox=\"0 0 24 24\"\n                    stroke=\"currentColor\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M4 6h16M4 12h16M4 18h16\"\n                    />\n                  </svg>\n                )}\n              </Button>\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Mobile Menu Overlay - Outside of nav to prevent height changes */}\n      {isMobileMenuOpen && (\n        <div className=\"md:hidden fixed top-16 left-0 right-0 bottom-0 z-50 bg-background\">\n          {/* Mobile menu items */}\n          <div className=\"flex flex-col items-center space-y-4 p-6\">\n            <Link href=\"/\" onClick={closeMobileMenu}>\n              <Button>Builds</Button>\n            </Link>\n            <Link href=\"/builder\" onClick={closeMobileMenu}>\n              <Button>Builder</Button>\n            </Link>\n            <Link href=\"/uptime\" onClick={closeMobileMenu}>\n              <Button>Uptime</Button>\n            </Link>\n            <Link href=\"/about\" onClick={closeMobileMenu}>\n              <Button>About</Button>\n            </Link>\n\n            {/* Auth section */}\n            {currentUser ? (\n              <Link href=\"/profile\" onClick={closeMobileMenu}>\n                <Button>Profile</Button>\n              </Link>\n            ) : (\n              <Link href=\"/login\" onClick={closeMobileMenu}>\n                <Button>Login</Button>\n              </Link>\n            )}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 461, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/villagerCalculator.ts"],"sourcesContent":["import { Build } from \"@/types/build\";\nimport { BuildOrderStep } from \"@/types/buildFormat\";\n\nfunction getTotalVillagersFromResources(resources: { food: number; wood: number; gold: number; stone: number; build: number }): number {\n  return resources.food + resources.wood + resources.gold + resources.stone + resources.build;\n}\n\nfunction findLastStepBeforeAgeUp(steps: BuildOrderStep[], targetAge: string): BuildOrderStep | null {\n  let lastStepBeforeAgeUp: BuildOrderStep | null = null;\n\n  for (const step of steps) {\n    if (step.type === \"ageUp\" && step.age === targetAge) {\n      break;\n    }\n    // Keep track of the last step that has villager allocations\n    if (step.resources && getTotalVillagersFromResources(step.resources) > 0) {\n      lastStepBeforeAgeUp = step;\n    }\n  }\n\n  return lastStepBeforeAgeUp;\n}\n\nexport function getFeudalVillagerCount(build: Build): string {\n  if (!build.build || build.build.length === 0) {\n    return \"?\";\n  }\n\n  const lastStep = findLastStepBeforeAgeUp(build.build, \"feudalAge\");\n  if (!lastStep) {\n    return \"?\";\n  }\n\n  const count = getTotalVillagersFromResources(lastStep.resources);\n  return (count + 1).toString(); // +1 for the scout\n}\n\nexport function hasAgeTransition(build: Build, age: string): boolean {\n  if (!build.build) {\n    return false;\n  }\n\n  return build.build.some(step => step.type === \"ageUp\" && step.age === age);\n}\n\nexport function getVillagerDifference(\n  build: Build,\n  currentAge: \"castle\" | \"imperial\"\n): string | null {\n  if (!build.build) {\n    return null;\n  }\n  \n  // Check if the build actually reaches the requested age\n  const targetAge = currentAge === \"castle\" ? \"castleAge\" : \"imperialAge\";\n  if (!hasAgeTransition(build, targetAge)) {\n    return null; // Don't show differences for ages not reached\n  }\n  \n  let currentCount: number | null;\n  let previousCount: number | null;\n  \n  if (currentAge === \"castle\") {\n    // For castle, we need the count before castle age up\n    const lastStepBeforeCastle = findLastStepBeforeAgeUp(build.build || [], \"castleAge\");\n    currentCount = lastStepBeforeCastle ? getTotalVillagersFromResources(lastStepBeforeCastle.resources) : null;\n    \n    // Previous count is before feudal age up (without +1 scout for comparison)\n    const lastStepBeforeFeudal = findLastStepBeforeAgeUp(build.build || [], \"feudalAge\");\n    previousCount = lastStepBeforeFeudal ? getTotalVillagersFromResources(lastStepBeforeFeudal.resources) : null;\n  } else {\n    // Imperial age - only show if we also have castle age\n    if (!hasAgeTransition(build, \"castleAge\")) {\n      return null; // Can't show imperial difference without castle\n    }\n    \n    const lastStepBeforeImperial = findLastStepBeforeAgeUp(build.build || [], \"imperialAge\");\n    currentCount = lastStepBeforeImperial ? getTotalVillagersFromResources(lastStepBeforeImperial.resources) : null;\n    \n    const lastStepBeforeCastle = findLastStepBeforeAgeUp(build.build || [], \"castleAge\");\n    previousCount = lastStepBeforeCastle ? getTotalVillagersFromResources(lastStepBeforeCastle.resources) : null;\n  }\n  \n  if (currentCount !== null && previousCount !== null) {\n    const diff = currentCount - previousCount;\n    if (diff >= 0 && diff <= 5) {\n      return `+${diff}`;\n    }\n    return null; // Don't show badge for large differences\n  }\n  \n  return null;\n}\n\n// Legacy function compatibility - now only works with new format\nexport function calculateVillagerCount(\n  _checkpoints: Build[\"checkpoints\"],\n  _targetType: string,\n  _fallbackType: string\n): number | null {\n  return null; // Legacy format no longer supported\n}"],"names":[],"mappings":";;;;;;AAGA,SAAS,+BAA+B,SAAqF;IAC3H,OAAO,UAAU,IAAI,GAAG,UAAU,IAAI,GAAG,UAAU,IAAI,GAAG,UAAU,KAAK,GAAG,UAAU,KAAK;AAC7F;AAEA,SAAS,wBAAwB,KAAuB,EAAE,SAAiB;IACzE,IAAI,sBAA6C;IAEjD,KAAK,MAAM,QAAQ,MAAO;QACxB,IAAI,KAAK,IAAI,KAAK,WAAW,KAAK,GAAG,KAAK,WAAW;YACnD;QACF;QACA,4DAA4D;QAC5D,IAAI,KAAK,SAAS,IAAI,+BAA+B,KAAK,SAAS,IAAI,GAAG;YACxE,sBAAsB;QACxB;IACF;IAEA,OAAO;AACT;AAEO,SAAS,uBAAuB,KAAY;IACjD,IAAI,CAAC,MAAM,KAAK,IAAI,MAAM,KAAK,CAAC,MAAM,KAAK,GAAG;QAC5C,OAAO;IACT;IAEA,MAAM,WAAW,wBAAwB,MAAM,KAAK,EAAE;IACtD,IAAI,CAAC,UAAU;QACb,OAAO;IACT;IAEA,MAAM,QAAQ,+BAA+B,SAAS,SAAS;IAC/D,OAAO,CAAC,QAAQ,CAAC,EAAE,QAAQ,IAAI,mBAAmB;AACpD;AAEO,SAAS,iBAAiB,KAAY,EAAE,GAAW;IACxD,IAAI,CAAC,MAAM,KAAK,EAAE;QAChB,OAAO;IACT;IAEA,OAAO,MAAM,KAAK,CAAC,IAAI,CAAC,CAAA,OAAQ,KAAK,IAAI,KAAK,WAAW,KAAK,GAAG,KAAK;AACxE;AAEO,SAAS,sBACd,KAAY,EACZ,UAAiC;IAEjC,IAAI,CAAC,MAAM,KAAK,EAAE;QAChB,OAAO;IACT;IAEA,wDAAwD;IACxD,MAAM,YAAY,eAAe,WAAW,cAAc;IAC1D,IAAI,CAAC,iBAAiB,OAAO,YAAY;QACvC,OAAO,MAAM,8CAA8C;IAC7D;IAEA,IAAI;IACJ,IAAI;IAEJ,IAAI,eAAe,UAAU;QAC3B,qDAAqD;QACrD,MAAM,uBAAuB,wBAAwB,MAAM,KAAK,IAAI,EAAE,EAAE;QACxE,eAAe,uBAAuB,+BAA+B,qBAAqB,SAAS,IAAI;QAEvG,2EAA2E;QAC3E,MAAM,uBAAuB,wBAAwB,MAAM,KAAK,IAAI,EAAE,EAAE;QACxE,gBAAgB,uBAAuB,+BAA+B,qBAAqB,SAAS,IAAI;IAC1G,OAAO;QACL,sDAAsD;QACtD,IAAI,CAAC,iBAAiB,OAAO,cAAc;YACzC,OAAO,MAAM,gDAAgD;QAC/D;QAEA,MAAM,yBAAyB,wBAAwB,MAAM,KAAK,IAAI,EAAE,EAAE;QAC1E,eAAe,yBAAyB,+BAA+B,uBAAuB,SAAS,IAAI;QAE3G,MAAM,uBAAuB,wBAAwB,MAAM,KAAK,IAAI,EAAE,EAAE;QACxE,gBAAgB,uBAAuB,+BAA+B,qBAAqB,SAAS,IAAI;IAC1G;IAEA,IAAI,iBAAiB,QAAQ,kBAAkB,MAAM;QACnD,MAAM,OAAO,eAAe;QAC5B,IAAI,QAAQ,KAAK,QAAQ,GAAG;YAC1B,OAAO,AAAC,IAAQ,OAAL;QACb;QACA,OAAO,MAAM,yCAAyC;IACxD;IAEA,OAAO;AACT;AAGO,SAAS,uBACd,YAAkC,EAClC,WAAmB,EACnB,aAAqB;IAErB,OAAO,MAAM,oCAAoC;AACnD","debugId":null}},
    {"offset": {"line": 549, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/VillagerCounts.tsx"],"sourcesContent":["import Image from \"next/image\";\nimport { Build } from \"@/types/build\";\nimport {\n  getFeudalVillagerCount,\n  getVillagerDifference,\n} from \"@/lib/villagerCalculator\";\n\ninterface VillagerCountsProps {\n  build: Build;\n}\n\nfunction VillagerCounts({ build }: VillagerCountsProps) {\n  // Calculate all values upfront\n  const feudalCount = getFeudalVillagerCount(build);\n  \n  const castleDifference = getVillagerDifference(build, \"castle\");\n  const showCastle = castleDifference !== null;\n  \n  const imperialDifference = getVillagerDifference(build, \"imperial\");\n  const showImperial = imperialDifference !== null;\n\n  return (\n    <div className=\"flex items-center flex-wrap gap-2 mb-2\">\n      {/* Feudal Age */}\n      <div className=\"flex items-center space-x-2 bg-muted px-2 py-1 rounded-default\">\n        <Image\n          src=\"/images/Ages/feudal_age_de.png\"\n          alt=\"Feudal Age Villagers\"\n          width={20}\n          height={20}\n        />\n        <span className=\"text-sm font-medium text-foreground\">\n          {feudalCount}\n        </span>\n      </div>\n\n      {/* Castle Age */}\n      {showCastle && (\n        <div className=\"flex items-center space-x-2 bg-muted px-2 py-1 rounded-default\">\n          <Image\n            src=\"/images/Ages/castle_age_de.png\"\n            alt=\"Castle Age Additional Villagers\"\n            width={20}\n            height={20}\n          />\n          <span className=\"text-sm font-medium text-foreground\">\n            {castleDifference}\n          </span>\n        </div>\n      )}\n\n      {/* Imperial Age */}\n      {showImperial && (\n        <div className=\"flex items-center space-x-2 bg-muted px-2 py-1 rounded-default\">\n          <Image\n            src=\"/images/Ages/imperial_age_de.png\"\n            alt=\"Imperial Age Additional Villagers\"\n            width={20}\n            height={20}\n          />\n          <span className=\"text-sm font-medium text-foreground\">\n            {imperialDifference}\n          </span>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default VillagerCounts;"],"names":[],"mappings":";;;;AAAA;AAEA;;;;AASA,SAAS,eAAe,KAA8B;QAA9B,EAAE,KAAK,EAAuB,GAA9B;IACtB,+BAA+B;IAC/B,MAAM,cAAc,CAAA,GAAA,mIAAA,CAAA,yBAAsB,AAAD,EAAE;IAE3C,MAAM,mBAAmB,CAAA,GAAA,mIAAA,CAAA,wBAAqB,AAAD,EAAE,OAAO;IACtD,MAAM,aAAa,qBAAqB;IAExC,MAAM,qBAAqB,CAAA,GAAA,mIAAA,CAAA,wBAAqB,AAAD,EAAE,OAAO;IACxD,MAAM,eAAe,uBAAuB;IAE5C,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,gIAAA,CAAA,UAAK;wBACJ,KAAI;wBACJ,KAAI;wBACJ,OAAO;wBACP,QAAQ;;;;;;kCAEV,6LAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;YAKJ,4BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,gIAAA,CAAA,UAAK;wBACJ,KAAI;wBACJ,KAAI;wBACJ,OAAO;wBACP,QAAQ;;;;;;kCAEV,6LAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;YAMN,8BACC,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,gIAAA,CAAA,UAAK;wBACJ,KAAI;wBACJ,KAAI;wBACJ,OAAO;wBACP,QAAQ;;;;;;kCAEV,6LAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;;;;;;;AAMb;KAxDS;uCA0DM","debugId":null}},
    {"offset": {"line": 670, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/Rating.tsx"],"sourcesContent":["import React from \"react\";\n\ninterface RatingProps {\n  rating?: number;\n  size?: \"small\" | \"medium\" | \"large\";\n}\n\nexport default function Rating({ rating, size = \"medium\" }: RatingProps) {\n  const sizeClasses = {\n    small: \"w-5 h-5\",\n    medium: \"w-6 h-6\",\n    large: \"w-7 h-7\",\n  };\n\n  const starSize = sizeClasses[size];\n  const actualRating = rating || 0;\n  const hasNoRating = !rating;\n\n  return (\n    <div className=\"flex items-center\">\n      {[1, 2, 3, 4, 5].map((star) => (\n        <svg\n          key={star}\n          className={`${starSize} ${\n            hasNoRating\n              ? \"text-muted\"\n              : star <= actualRating\n              ? \"text-foreground\"\n              : \"text-muted\"\n          }`}\n          fill=\"currentColor\"\n          viewBox=\"0 0 20 20\"\n        >\n          <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n        </svg>\n      ))}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAOe,SAAS,OAAO,KAAwC;QAAxC,EAAE,MAAM,EAAE,OAAO,QAAQ,EAAe,GAAxC;IAC7B,MAAM,cAAc;QAClB,OAAO;QACP,QAAQ;QACR,OAAO;IACT;IAEA,MAAM,WAAW,WAAW,CAAC,KAAK;IAClC,MAAM,eAAe,UAAU;IAC/B,MAAM,cAAc,CAAC;IAErB,qBACE,6LAAC;QAAI,WAAU;kBACZ;YAAC;YAAG;YAAG;YAAG;YAAG;SAAE,CAAC,GAAG,CAAC,CAAC,qBACpB,6LAAC;gBAEC,WAAW,AAAC,GACV,OADY,UAAS,KAMtB,OALC,cACI,eACA,QAAQ,eACR,oBACA;gBAEN,MAAK;gBACL,SAAQ;0BAER,cAAA,6LAAC;oBAAK,GAAE;;;;;;eAXH;;;;;;;;;;AAgBf;KA/BwB","debugId":null}},
    {"offset": {"line": 727, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/imageUtils.ts"],"sourcesContent":["export function getCivImagePath(civName: string): string {\n  return `/images/Civs/${civName.toLowerCase()}.png`;\n}\n\nexport function getDifficultyImagePath(difficulty: string | number): string {\n  const difficultyMap: { [key: string]: string } = {\n    // Legacy string format\n    Beginner: \"/images/Medals/Bronze.png\",\n    Intermediate: \"/images/Medals/Silver.png\",\n    Advanced: \"/images/Medals/Gold.png\",\n    // New numbered format\n    \"1\": \"/images/Medals/Bronze.png\",\n    \"2\": \"/images/Medals/Silver.png\", \n    \"3\": \"/images/Medals/Gold.png\",\n  };\n  return difficultyMap[difficulty.toString()] || \"/images/Medals/Bronze.png\";\n}\n\nexport function getDifficultyLabel(difficulty: string | number): string {\n  const difficultyLabelMap: { [key: string]: string } = {\n    // Legacy string format\n    Beginner: \"Beginner\",\n    Intermediate: \"Intermediate\",\n    Advanced: \"Advanced\",\n    // New numbered format\n    \"1\": \"Beginner\",\n    \"2\": \"Intermediate\",\n    \"3\": \"Advanced\",\n  };\n  return difficultyLabelMap[difficulty.toString()] || \"Beginner\";\n}\n\nexport function getAgeImagePath(age: string): string {\n  const ageMap: { [key: string]: string } = {\n    dark_age: \"/images/Ages/dark_age_de.png\",\n    feudal_age: \"/images/Ages/feudal_age_de.png\",\n    castle_age: \"/images/Ages/castle_age_de.png\",\n    imperial_age: \"/images/Ages/imperial_age_de.png\",\n  };\n  return ageMap[age] || \"/images/Ages/dark_age_de.png\";\n}\n\nexport function getResourceImagePath(resource: string): string {\n  const resourceMap: { [key: string]: string } = {\n    food: \"/images/Res/Aoe2de_food.png\",\n    wood: \"/images/Res/Aoe2de_wood.png\",\n    gold: \"/images/Res/Aoe2de_gold.png\",\n    stone: \"/images/Res/Aoe2de_stone.png\",\n    builders: \"/images/Res/Aoe2de_builder.png\",\n    build: \"/images/Res/Aoe2de_builder.png\", // Map \"build\" to builder icon\n    fishingShips: \"/images/Res/Aoe2de_ship.png\",\n  };\n  return resourceMap[resource] || \"\";\n}"],"names":[],"mappings":";;;;;;;AAAO,SAAS,gBAAgB,OAAe;IAC7C,OAAO,AAAC,gBAAqC,OAAtB,QAAQ,WAAW,IAAG;AAC/C;AAEO,SAAS,uBAAuB,UAA2B;IAChE,MAAM,gBAA2C;QAC/C,uBAAuB;QACvB,UAAU;QACV,cAAc;QACd,UAAU;QACV,sBAAsB;QACtB,KAAK;QACL,KAAK;QACL,KAAK;IACP;IACA,OAAO,aAAa,CAAC,WAAW,QAAQ,GAAG,IAAI;AACjD;AAEO,SAAS,mBAAmB,UAA2B;IAC5D,MAAM,qBAAgD;QACpD,uBAAuB;QACvB,UAAU;QACV,cAAc;QACd,UAAU;QACV,sBAAsB;QACtB,KAAK;QACL,KAAK;QACL,KAAK;IACP;IACA,OAAO,kBAAkB,CAAC,WAAW,QAAQ,GAAG,IAAI;AACtD;AAEO,SAAS,gBAAgB,GAAW;IACzC,MAAM,SAAoC;QACxC,UAAU;QACV,YAAY;QACZ,YAAY;QACZ,cAAc;IAChB;IACA,OAAO,MAAM,CAAC,IAAI,IAAI;AACxB;AAEO,SAAS,qBAAqB,QAAgB;IACnD,MAAM,cAAyC;QAC7C,MAAM;QACN,MAAM;QACN,MAAM;QACN,OAAO;QACP,UAAU;QACV,OAAO;QACP,cAAc;IAChB;IACA,OAAO,WAAW,CAAC,SAAS,IAAI;AAClC","debugId":null}},
    {"offset": {"line": 793, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/CivIcon.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport { getCivImagePath } from \"@/lib/imageUtils\";\n\ninterface CivIconProps {\n  civilization: string;\n  size?: \"sm\" | \"md\" | \"lg\";\n  showName?: boolean;\n}\n\nexport default function CivIcon({\n  civilization,\n  size = \"md\",\n  showName = false,\n}: CivIconProps) {\n  const iconClasses = size === \"sm\" ? \"w-4 h-4\" : size === \"lg\" ? \"w-8 h-8\" : \"w-6 h-6\";\n  const textClasses = size === \"sm\" ? \"text-xs\" : size === \"lg\" ? \"text-base\" : \"text-sm\";\n  const imageSize = size === \"sm\" ? 16 : size === \"lg\" ? 32 : 24;\n  \n  const civImagePath = getCivImagePath(\n    civilization === \"Generic\" ? \"generic\" : civilization\n  );\n\n  if (showName) {\n    return (\n      <div className=\"flex items-center space-x-2\">\n        <div className=\"rounded-full bg-muted flex items-center justify-center p-1\">\n          <Image\n            src={civImagePath}\n            alt={civilization}\n            width={imageSize}\n            height={imageSize}\n            className={iconClasses}\n            onError={(e) => {\n              e.currentTarget.src = \"/images/Civs/generic.png\";\n            }}\n          />\n        </div>\n        <span className={`font-medium text-foreground ${textClasses}`}>\n          {civilization}\n        </span>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"rounded-full bg-muted flex items-center justify-center p-1\">\n      <Image\n        src={civImagePath}\n        alt={civilization}\n        width={imageSize}\n        height={imageSize}\n        className={iconClasses}\n        onError={(e) => {\n          e.currentTarget.src = \"/images/Civs/generic.png\";\n        }}\n      />\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAGA;AACA;AAJA;;;;AAYe,SAAS,QAAQ,KAIjB;QAJiB,EAC9B,YAAY,EACZ,OAAO,IAAI,EACX,WAAW,KAAK,EACH,GAJiB;IAK9B,MAAM,cAAc,SAAS,OAAO,YAAY,SAAS,OAAO,YAAY;IAC5E,MAAM,cAAc,SAAS,OAAO,YAAY,SAAS,OAAO,cAAc;IAC9E,MAAM,YAAY,SAAS,OAAO,KAAK,SAAS,OAAO,KAAK;IAE5D,MAAM,eAAe,CAAA,GAAA,2HAAA,CAAA,kBAAe,AAAD,EACjC,iBAAiB,YAAY,YAAY;IAG3C,IAAI,UAAU;QACZ,qBACE,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC,gIAAA,CAAA,UAAK;wBACJ,KAAK;wBACL,KAAK;wBACL,OAAO;wBACP,QAAQ;wBACR,WAAW;wBACX,SAAS,CAAC;4BACR,EAAE,aAAa,CAAC,GAAG,GAAG;wBACxB;;;;;;;;;;;8BAGJ,6LAAC;oBAAK,WAAW,AAAC,+BAA0C,OAAZ;8BAC7C;;;;;;;;;;;;IAIT;IAEA,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC,gIAAA,CAAA,UAAK;YACJ,KAAK;YACL,KAAK;YACL,OAAO;YACP,QAAQ;YACR,WAAW;YACX,SAAS,CAAC;gBACR,EAAE,aAAa,CAAC,GAAG,GAAG;YACxB;;;;;;;;;;;AAIR;KAjDwB","debugId":null}},
    {"offset": {"line": 883, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/attributes.ts"],"sourcesContent":["export const AVAILABLE_ATTRIBUTES = [\n  \"drush\",\n  \"fastFeudal\",\n  \"fastCastle\",\n  \"fastImperial\",\n  \"water\",\n  \"meme\",\n  \"arena\",\n];\n\n// Translation mapping for camelCase attribute values\nconst ATTRIBUTE_VALUE_MAP: Record<string, string> = {\n  drush: \"drush\",\n  fastfeudal: \"fastFeudal\",\n  fastcastle: \"fastCastle\",\n  fastimperial: \"fastImperial\",\n  water: \"water\",\n  waterhybrid: \"water\",\n  meme: \"meme\",\n  arena: \"arena\",\n};\n\nfunction toReadableLabel(attribute: string): string {\n  return attribute\n    .replace(/([a-z])([A-Z])/g, \"$1 $2\")\n    .replace(/(^|\\s)([a-z])/g, (match) => match.toUpperCase());\n}\n\nfunction normalizeAttributeValue(attribute: string): string | null {\n  if (!attribute) return null;\n  if (AVAILABLE_ATTRIBUTES.includes(attribute)) {\n    return attribute;\n  }\n  const sanitized = attribute.toLowerCase().replace(/[^a-z]/g, \"\");\n  return ATTRIBUTE_VALUE_MAP[sanitized] || null;\n}\n\n/**\n * Translates an attribute value to its readable display text.\n * Handles both camelCase values and current display-ready labels.\n */\nexport function translateAttribute(attribute: string): string {\n  const normalized = normalizeAttributeValue(attribute);\n  if (normalized) {\n    return toReadableLabel(normalized);\n  }\n  return toReadableLabel(attribute);\n}\n\n/**\n * Translates an array of attribute values to readable display text.\n * Filters out unsupported attributes.\n */\nexport function translateAttributes(attributes: string[]): string[] {\n  if (!attributes || !Array.isArray(attributes)) return [];\n  \n  return attributes\n    .filter(attr => attr && typeof attr === 'string')\n    .map(translateAttribute)\n    .filter(translatedAttr => translatedAttr !== '');\n}\n\nexport function getAttributeOptions() {\n  return AVAILABLE_ATTRIBUTES.map((attr) => ({\n    value: attr,\n    label: toReadableLabel(attr),\n  }));\n}\n\nexport function getAttributeDropdownOptions() {\n  return [\n    { value: \"All\", label: \"All\" },\n    ...AVAILABLE_ATTRIBUTES.map((attr) => ({\n      value: attr,\n      label: toReadableLabel(attr),\n    })),\n  ];\n}\n"],"names":[],"mappings":";;;;;;;AAAO,MAAM,uBAAuB;IAClC;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,qDAAqD;AACrD,MAAM,sBAA8C;IAClD,OAAO;IACP,YAAY;IACZ,YAAY;IACZ,cAAc;IACd,OAAO;IACP,aAAa;IACb,MAAM;IACN,OAAO;AACT;AAEA,SAAS,gBAAgB,SAAiB;IACxC,OAAO,UACJ,OAAO,CAAC,mBAAmB,SAC3B,OAAO,CAAC,kBAAkB,CAAC,QAAU,MAAM,WAAW;AAC3D;AAEA,SAAS,wBAAwB,SAAiB;IAChD,IAAI,CAAC,WAAW,OAAO;IACvB,IAAI,qBAAqB,QAAQ,CAAC,YAAY;QAC5C,OAAO;IACT;IACA,MAAM,YAAY,UAAU,WAAW,GAAG,OAAO,CAAC,WAAW;IAC7D,OAAO,mBAAmB,CAAC,UAAU,IAAI;AAC3C;AAMO,SAAS,mBAAmB,SAAiB;IAClD,MAAM,aAAa,wBAAwB;IAC3C,IAAI,YAAY;QACd,OAAO,gBAAgB;IACzB;IACA,OAAO,gBAAgB;AACzB;AAMO,SAAS,oBAAoB,UAAoB;IACtD,IAAI,CAAC,cAAc,CAAC,MAAM,OAAO,CAAC,aAAa,OAAO,EAAE;IAExD,OAAO,WACJ,MAAM,CAAC,CAAA,OAAQ,QAAQ,OAAO,SAAS,UACvC,GAAG,CAAC,oBACJ,MAAM,CAAC,CAAA,iBAAkB,mBAAmB;AACjD;AAEO,SAAS;IACd,OAAO,qBAAqB,GAAG,CAAC,CAAC,OAAS,CAAC;YACzC,OAAO;YACP,OAAO,gBAAgB;QACzB,CAAC;AACH;AAEO,SAAS;IACd,OAAO;QACL;YAAE,OAAO;YAAO,OAAO;QAAM;WAC1B,qBAAqB,GAAG,CAAC,CAAC,OAAS,CAAC;gBACrC,OAAO;gBACP,OAAO,gBAAgB;YACzB,CAAC;KACF;AACH","debugId":null}},
    {"offset": {"line": 959, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/AttributeBadges.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { translateAttributes } from \"@/lib/attributes\";\n\ninterface AttributeBadgesProps {\n  attributes: string[];\n  maxVisible?: number;\n}\n\nexport default function AttributeBadges({\n  attributes,\n  maxVisible,\n}: AttributeBadgesProps) {\n  if (!attributes || attributes.length === 0) {\n    return null;\n  }\n\n  // Translate attributes from camelCase values to readable text\n  const translatedAttributes = translateAttributes(attributes);\n  \n  const visibleAttributes = maxVisible\n    ? translatedAttributes.slice(0, maxVisible)\n    : translatedAttributes;\n  const remainingCount =\n    maxVisible && translatedAttributes.length > maxVisible\n      ? translatedAttributes.length - maxVisible\n      : 0;\n\n  return (\n    <div className=\"flex items-center flex-wrap gap-2\">\n      {visibleAttributes.map((attr, index) => (\n        <span\n          key={index}\n          className=\"bg-muted text-foreground rounded-default font-medium text-sm px-2 py-1\"\n        >\n          {attr}\n        </span>\n      ))}\n      {remainingCount > 0 && (\n        <span className=\"bg-muted text-foreground rounded-default font-medium text-sm px-2 py-1\">\n          +{remainingCount}\n        </span>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAHA;;;AAUe,SAAS,gBAAgB,KAGjB;QAHiB,EACtC,UAAU,EACV,UAAU,EACW,GAHiB;IAItC,IAAI,CAAC,cAAc,WAAW,MAAM,KAAK,GAAG;QAC1C,OAAO;IACT;IAEA,8DAA8D;IAC9D,MAAM,uBAAuB,CAAA,GAAA,2HAAA,CAAA,sBAAmB,AAAD,EAAE;IAEjD,MAAM,oBAAoB,aACtB,qBAAqB,KAAK,CAAC,GAAG,cAC9B;IACJ,MAAM,iBACJ,cAAc,qBAAqB,MAAM,GAAG,aACxC,qBAAqB,MAAM,GAAG,aAC9B;IAEN,qBACE,6LAAC;QAAI,WAAU;;YACZ,kBAAkB,GAAG,CAAC,CAAC,MAAM,sBAC5B,6LAAC;oBAEC,WAAU;8BAET;mBAHI;;;;;YAMR,iBAAiB,mBAChB,6LAAC;gBAAK,WAAU;;oBAAyE;oBACrF;;;;;;;;;;;;;AAKZ;KApCwB","debugId":null}},
    {"offset": {"line": 1017, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/LoadingSpinner.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\ninterface LoadingSpinnerProps {\n  label?: string;\n}\n\nexport default function LoadingSpinner({\n  label,\n}: LoadingSpinnerProps) {\n  return (\n    <div className=\"flex flex-col items-center\">\n      <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-foreground\" />\n      {label && (\n        <p className=\"text-foreground mt-2\">{label}</p>\n      )}\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAAA;;AAQe,SAAS,eAAe,KAEjB;QAFiB,EACrC,KAAK,EACe,GAFiB;IAGrC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;;;;;YACd,uBACC,6LAAC;gBAAE,WAAU;0BAAwB;;;;;;;;;;;;AAI7C;KAXwB","debugId":null}},
    {"offset": {"line": 1062, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/EmptyState.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\n\ninterface EmptyStateProps {\n  text: string;\n}\n\nexport default function EmptyState({ text }: EmptyStateProps) {\n  return (\n    <div\n      className={`flex flex-col items-center justify-center py-12 px-4 text-center`}\n    >\n      <div className=\"mb-6\">\n        <Image\n          src=\"/images/Other/BuildImagePlaceholder.png\"\n          alt=\"Empty state placeholder\"\n          width={120}\n          height={120}\n          className=\"w-30 h-30 object-contain opacity-60\"\n        />\n      </div>\n      <p className=\"text-foreground text-lg font-medium max-w-md\">{text}</p>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAGA;AAHA;;;AASe,SAAS,WAAW,KAAyB;QAAzB,EAAE,IAAI,EAAmB,GAAzB;IACjC,qBACE,6LAAC;QACC,WAAY;;0BAEZ,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC,gIAAA,CAAA,UAAK;oBACJ,KAAI;oBACJ,KAAI;oBACJ,OAAO;oBACP,QAAQ;oBACR,WAAU;;;;;;;;;;;0BAGd,6LAAC;gBAAE,WAAU;0BAAgD;;;;;;;;;;;;AAGnE;KAjBwB","debugId":null}},
    {"offset": {"line": 1120, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/Header.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\ninterface HeaderProps {\n  text: string;\n  subtitle?: string;\n}\n\nexport default function Header({ text, subtitle }: HeaderProps) {\n  return (\n    <div className=\"text-center mb-8\">\n      <h1 className=\"text-2xl sm:text-3xl lg:text-4xl font-bold text-foreground mb-2 text-pretty\">\n        {text}\n      </h1>\n      {subtitle && (\n        <p className=\"text-foreground text-sm sm:text-base\">\n          {subtitle}\n        </p>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;;AASe,SAAS,OAAO,KAA+B;QAA/B,EAAE,IAAI,EAAE,QAAQ,EAAe,GAA/B;IAC7B,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAG,WAAU;0BACX;;;;;;YAEF,0BACC,6LAAC;gBAAE,WAAU;0BACV;;;;;;;;;;;;AAKX;KAbwB","debugId":null}},
    {"offset": {"line": 1166, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/DifficultyBadge.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport { getDifficultyImagePath, getDifficultyLabel } from \"@/lib/imageUtils\";\n\ninterface DifficultyBadgeProps {\n  difficulty: string | number | undefined;\n}\n\nexport default function DifficultyBadge({\n  difficulty,\n}: DifficultyBadgeProps) {\n  if (!difficulty && difficulty !== 0) {\n    return null;\n  }\n\n  const difficultyLabel = getDifficultyLabel(difficulty);\n\n  return (\n    <div className=\"flex items-center space-x-2 bg-muted rounded-default px-2 py-1\">\n      <Image\n        src={getDifficultyImagePath(difficulty)}\n        alt={`${difficultyLabel} difficulty`}\n        width={20}\n        height={20}\n        className=\"flex-shrink-0\"\n      />\n      <span className=\"text-sm font-medium text-foreground\">\n        {difficultyLabel}\n      </span>\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAGA;AACA;AAJA;;;;AAUe,SAAS,gBAAgB,KAEjB;QAFiB,EACtC,UAAU,EACW,GAFiB;IAGtC,IAAI,CAAC,cAAc,eAAe,GAAG;QACnC,OAAO;IACT;IAEA,MAAM,kBAAkB,CAAA,GAAA,2HAAA,CAAA,qBAAkB,AAAD,EAAE;IAE3C,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC,gIAAA,CAAA,UAAK;gBACJ,KAAK,CAAA,GAAA,2HAAA,CAAA,yBAAsB,AAAD,EAAE;gBAC5B,KAAK,AAAC,GAAkB,OAAhB,iBAAgB;gBACxB,OAAO;gBACP,QAAQ;gBACR,WAAU;;;;;;0BAEZ,6LAAC;gBAAK,WAAU;0BACb;;;;;;;;;;;;AAIT;KAvBwB","debugId":null}},
    {"offset": {"line": 1223, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/taskUtils.ts"],"sourcesContent":["import { Resources } from \"@/types/buildFormat\";\n\nconst FOOD_TASKS = new Set([\n  \"sheep\",\n  \"boar\",\n  \"deer\",\n  \"chicken\",\n  \"berries\",\n  \"farms\",\n  \"shorefish\",\n  \"foodundertc\",\n]);\n\nconst WOOD_TASKS = new Set([\"wood\", \"stragglertree\", \"lumber\", \"lumbercamp\"]);\nconst GOLD_TASKS = new Set([\"gold\", \"fox\", \"mine\", \"miningcamp\"]);\nconst STONE_TASKS = new Set([\"stone\"]);\n\nexport const RESOURCE_KEYS: (keyof Resources)[] = [\n  \"food\",\n  \"wood\",\n  \"gold\",\n  \"stone\",\n  \"build\",\n];\n\nexport function createEmptyResourceSnapshot(): Resources {\n  return {\n    food: 0,\n    wood: 0,\n    gold: 0,\n    stone: 0,\n    build: 0,\n  };\n}\n\nexport function normalizeTaskIdentifier(task?: string): string {\n  return (task || \"\").toLowerCase().replace(/[^a-z]/g, \"\");\n}\n\nexport function taskToResource(task?: string): keyof Resources {\n  const normalized = normalizeTaskIdentifier(task);\n\n  if (FOOD_TASKS.has(normalized)) {\n    return \"food\";\n  }\n\n  if (WOOD_TASKS.has(normalized)) {\n    return \"wood\";\n  }\n\n  if (GOLD_TASKS.has(normalized)) {\n    return \"gold\";\n  }\n\n  if (STONE_TASKS.has(normalized)) {\n    return \"stone\";\n  }\n\n  if (normalized === \"build\" || normalized === \"forward\") {\n    return \"build\";\n  }\n\n  // Default to food when we cannot determine the resource explicitly\n  return \"food\";\n}\n"],"names":[],"mappings":";;;;;;AAEA,MAAM,aAAa,IAAI,IAAI;IACzB;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAED,MAAM,aAAa,IAAI,IAAI;IAAC;IAAQ;IAAiB;IAAU;CAAa;AAC5E,MAAM,aAAa,IAAI,IAAI;IAAC;IAAQ;IAAO;IAAQ;CAAa;AAChE,MAAM,cAAc,IAAI,IAAI;IAAC;CAAQ;AAE9B,MAAM,gBAAqC;IAChD;IACA;IACA;IACA;IACA;CACD;AAEM,SAAS;IACd,OAAO;QACL,MAAM;QACN,MAAM;QACN,MAAM;QACN,OAAO;QACP,OAAO;IACT;AACF;AAEO,SAAS,wBAAwB,IAAa;IACnD,OAAO,CAAC,QAAQ,EAAE,EAAE,WAAW,GAAG,OAAO,CAAC,WAAW;AACvD;AAEO,SAAS,eAAe,IAAa;IAC1C,MAAM,aAAa,wBAAwB;IAE3C,IAAI,WAAW,GAAG,CAAC,aAAa;QAC9B,OAAO;IACT;IAEA,IAAI,WAAW,GAAG,CAAC,aAAa;QAC9B,OAAO;IACT;IAEA,IAAI,WAAW,GAAG,CAAC,aAAa;QAC9B,OAAO;IACT;IAEA,IAAI,YAAY,GAAG,CAAC,aAAa;QAC/B,OAAO;IACT;IAEA,IAAI,eAAe,WAAW,eAAe,WAAW;QACtD,OAAO;IACT;IAEA,mEAAmE;IACnE,OAAO;AACT","debugId":null}},
    {"offset": {"line": 1302, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/buildValidation.ts"],"sourcesContent":["import { BuildOrderStep, Resources } from \"@/types/buildFormat\";\nimport { taskToResource, createEmptyResourceSnapshot } from \"@/lib/taskUtils\";\n\nexport interface BuildValidationError {\n  message: string;\n  stepIndex?: number;\n  severity: \"error\" | \"warning\";\n}\n\nexport interface BuildValidationResult {\n  isValid: boolean;\n  errors: BuildValidationError[];\n}\n\ntype IndexedBuildStep = {\n  step: BuildOrderStep;\n  index: number;\n};\n\nfunction splitIntoAlternativePaths(\n  steps: BuildOrderStep[]\n): IndexedBuildStep[][] {\n  const firstDecisionIndex = steps.findIndex((step) => step.type === \"decision\");\n  const indexedSteps = steps.map((step, index) => ({ step, index }));\n\n  if (firstDecisionIndex === -1) {\n    return [indexedSteps];\n  }\n\n  const commonSteps = indexedSteps.slice(0, firstDecisionIndex);\n  const paths: IndexedBuildStep[][] = [];\n  let currentPath: IndexedBuildStep[] = [];\n\n  for (let i = firstDecisionIndex; i < indexedSteps.length; i++) {\n    const entry = indexedSteps[i];\n    if (entry.step.type === \"decision\") {\n      if (currentPath.length > 0) {\n        paths.push([...commonSteps, ...currentPath]);\n        currentPath = [];\n      }\n      continue;\n    }\n    currentPath.push(entry);\n  }\n\n  if (currentPath.length > 0) {\n    paths.push([...commonSteps, ...currentPath]);\n  }\n\n  if (paths.length === 0) {\n    paths.push([...commonSteps]);\n  }\n\n  return paths;\n}\n\nfunction getAgeDisplayName(age: string): string {\n  switch (age) {\n    case \"feudalAge\":\n      return \"Feudal Age\";\n    case \"castleAge\":\n      return \"Castle Age\";\n    case \"imperialAge\":\n      return \"Imperial Age\";\n    default:\n      return \"Unknown Age\";\n  }\n}\n\nexport function validateBuildOrder(\n  steps: BuildOrderStep[],\n  civilization?: string\n): BuildValidationResult {\n  const errors: BuildValidationError[] = [];\n  const errorSignatures = new Set<string>();\n  const addError = (error: BuildValidationError) => {\n    const signature = `${error.stepIndex ?? -1}|${error.message}`;\n    if (errorSignatures.has(signature)) return;\n    errorSignatures.add(signature);\n    errors.push(error);\n  };\n\n  const alternativePaths = splitIntoAlternativePaths(steps);\n\n  // Check for duplicate technology research within each possible path\n  for (const path of alternativePaths) {\n    const researchedTechs = new Map<string, number>();\n    for (const { step, index } of path) {\n      if (step.type === \"research\" && step.tech) {\n        for (const tech of step.tech) {\n          if (researchedTechs.has(tech)) {\n            const firstIndex = researchedTechs.get(tech)!;\n            addError({\n              message: `Technology \"${tech}\" is researched multiple times in the same path (steps ${\n                firstIndex + 1\n              } and ${index + 1}). Each technology can only be researched once per path.`,\n              stepIndex: index,\n              severity: \"error\",\n            });\n          } else {\n            researchedTechs.set(tech, index);\n          }\n        }\n      }\n    }\n  }\n\n  // Check for empty custom or decision steps\n  for (let i = 0; i < steps.length; i++) {\n    const step = steps[i];\n    if (step.type === \"custom\" || step.type === \"decision\") {\n      if (!step.text || step.text.trim() === \"\") {\n        addError({\n          message: `Step ${i + 1}: Empty custom or decision step.`,\n          stepIndex: i,\n          severity: \"error\",\n        });\n      }\n    }\n  }\n\n  // Check age-related rules within each possible path\n  for (const path of alternativePaths) {\n    const ageUps = new Map<string, number>();\n    const newAgeIndices = new Map<string, number>();\n\n    for (const { step, index } of path) {\n      if (step.type === \"ageUp\") {\n        if (ageUps.has(step.age)) {\n          const firstIndex = ageUps.get(step.age)!;\n          const ageName = getAgeDisplayName(step.age);\n          addError({\n            message: `${ageName} is researched multiple times in the same path (steps ${\n              firstIndex + 1\n            } and ${index + 1}). Each age can only be researched once per path.`,\n            stepIndex: index,\n            severity: \"error\",\n          });\n        } else {\n          ageUps.set(step.age, index);\n        }\n      } else if (step.type === \"newAge\") {\n        newAgeIndices.set(step.age, index);\n      }\n    }\n\n    // Check that newAge comes after ageUp in the same path\n    for (const [age, newAgeIndex] of newAgeIndices) {\n      const ageUpIndex = ageUps.get(age);\n      const ageName = getAgeDisplayName(age);\n      if (ageUpIndex === undefined) {\n        addError({\n          message: `${ageName} reached (step ${\n            newAgeIndex + 1\n          }) without researching it first. You must research an age before reaching it.`,\n          stepIndex: newAgeIndex,\n          severity: \"error\",\n        });\n      } else if (newAgeIndex <= ageUpIndex) {\n        addError({\n          message: `${ageName} reached (step ${\n            newAgeIndex + 1\n          }) before or at the same time as researching it (step ${\n            ageUpIndex + 1\n          }). The age must be researched before it can be reached.`,\n          stepIndex: newAgeIndex,\n          severity: \"error\",\n        });\n      }\n    }\n\n    // Check that Castle Age requires Feudal Age to be reached first in this path\n    if (ageUps.has(\"castleAge\")) {\n      const castleUpIndex = ageUps.get(\"castleAge\")!;\n      const feudalReachedIndex = newAgeIndices.get(\"feudalAge\");\n      if (feudalReachedIndex === undefined) {\n        addError({\n          message: `Castle Age is researched (step ${\n            castleUpIndex + 1\n          }) but Feudal Age was never reached in this path. You must reach Feudal Age before researching Castle Age.`,\n          stepIndex: castleUpIndex,\n          severity: \"error\",\n        });\n      } else if (castleUpIndex <= feudalReachedIndex) {\n        addError({\n          message: `Castle Age is researched (step ${\n            castleUpIndex + 1\n          }) before or at the same time as reaching Feudal Age (step ${\n            feudalReachedIndex + 1\n          }). You must reach Feudal Age before researching Castle Age.`,\n          stepIndex: castleUpIndex,\n          severity: \"error\",\n        });\n      }\n    }\n\n    // Check that Imperial Age requires Castle Age to be reached first in this path\n    if (ageUps.has(\"imperialAge\")) {\n      const imperialUpIndex = ageUps.get(\"imperialAge\")!;\n      const castleReachedIndex = newAgeIndices.get(\"castleAge\");\n      if (castleReachedIndex === undefined) {\n        addError({\n          message: `Imperial Age is researched (step ${\n            imperialUpIndex + 1\n          }) but Castle Age was never reached in this path. You must reach Castle Age before researching Imperial Age.`,\n          stepIndex: imperialUpIndex,\n          severity: \"error\",\n        });\n      } else if (imperialUpIndex <= castleReachedIndex) {\n        addError({\n          message: `Imperial Age is researched (step ${\n            imperialUpIndex + 1\n          }) before or at the same time as reaching Castle Age (step ${\n            castleReachedIndex + 1\n          }). You must reach Castle Age before researching Imperial Age.`,\n          stepIndex: imperialUpIndex,\n          severity: \"error\",\n        });\n      }\n    }\n  }\n\n  // Check for invalid villager movements\n  for (let i = 0; i < steps.length; i++) {\n    const step = steps[i];\n    if (step.type === \"moveVillagers\") {\n      // Check 1: Cannot move villagers from a task to the same task\n      if (step.from === step.to) {\n        addError({\n          message: `Step ${i + 1}: Cannot move villagers from ${step.from} to ${\n            step.to\n          }. The source and destination tasks are the same.`,\n          stepIndex: i,\n          severity: \"error\",\n        });\n        continue; // Skip the second check if this fails\n      }\n\n      // Check 2: Must have enough villagers on the source task\n      // Calculate villager distribution up to this step\n      const villagerDistribution = calculateResourceDistribution(steps, i - 1);\n      const fromResource = taskToResource(step.from);\n      const availableVillagers = villagerDistribution[fromResource] || 0;\n\n      if (availableVillagers < step.count) {\n        addError({\n          message: `Step ${i + 1}: Cannot move ${step.count} villager${\n            step.count > 1 ? \"s\" : \"\"\n          } from ${step.from}. Only ${availableVillagers} villager${\n            availableVillagers !== 1 ? \"s\" : \"\"\n          } available on this task.`,\n          stepIndex: i,\n          severity: \"error\",\n        });\n      }\n    }\n  }\n\n  // Check for civilization-specific building restrictions\n  if (civilization && civilization !== \"Generic\") {\n    for (let i = 0; i < steps.length; i++) {\n      const step = steps[i];\n      const buildings =\n        (step.type === \"newVillagers\" ||\n          step.type === \"moveVillagers\" ||\n          step.type === \"build\") &&\n        step.buildings\n          ? step.buildings\n          : [];\n\n      for (const building of buildings) {\n        const buildingType = building.type;\n\n        // Poles cannot build mills (only folwarks)\n        if (civilization === \"Poles\" && buildingType === \"mill\") {\n          addError({\n            message: `Step ${i + 1}: Poles civilization cannot build mills. Use folwark instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Non-Poles cannot build folwarks\n        if (civilization !== \"Poles\" && buildingType === \"folwark\") {\n          addError({\n            message: `Step ${i + 1}: Only Poles civilization can build folwarks. Use mill instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Armenians and Georgians cannot build lumber camps or mining camps\n        if (\n          (civilization === \"Armenians\" || civilization === \"Georgians\") &&\n          (buildingType === \"lumberCamp\" || buildingType === \"miningCamp\")\n        ) {\n          addError({\n            message: `Step ${i + 1}: ${civilization} civilization cannot build ${\n              buildingType === \"lumberCamp\" ? \"lumber camps\" : \"mining camps\"\n            }. Use mule cart instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Non-Armenians/Georgians cannot build mule carts\n        if (\n          civilization !== \"Armenians\" &&\n          civilization !== \"Georgians\" &&\n          buildingType === \"muleCart\"\n        ) {\n          addError({\n            message: `Step ${i + 1}: Only Armenians and Georgians civilizations can build mule carts. Use lumber camp or mining camp instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Hindustanis and Persians can build caravanserai\n        if (\n          civilization !== \"Hindustanis\" &&\n          civilization !== \"Persians\" &&\n          buildingType === \"caravanserai\"\n        ) {\n          addError({\n            message: `Step ${i + 1}: Only Hindustanis and Persians civilizations can build caravanserai.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Sicilians cannot build watch tower, guard tower, or keep\n        if (\n          civilization === \"Sicilians\" &&\n          (buildingType === \"watchTower\" || buildingType === \"guardTower\" || buildingType === \"keep\")\n        ) {\n          addError({\n            message: `Step ${i + 1}: Sicilians civilization cannot build watch towers, guard towers, or keeps. Use donjon instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Sicilians can build donjon\n        if (civilization !== \"Sicilians\" && buildingType === \"donjon\") {\n          addError({\n            message: `Step ${i + 1}: Only Sicilians civilization can build donjons.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Portuguese can build feitoria\n        if (civilization !== \"Portuguese\" && buildingType === \"feitoria\") {\n          addError({\n            message: `Step ${i + 1}: Only Portuguese civilization can build feitorias.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Bulgarians can build krepost\n        if (civilization !== \"Bulgarians\" && buildingType === \"krepost\") {\n          addError({\n            message: `Step ${i + 1}: Only Bulgarians civilization can build kreposts.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Armenians and Georgians can build fortified church (not monastery)\n        if (\n          (civilization === \"Armenians\" || civilization === \"Georgians\") &&\n          buildingType === \"monastery\"\n        ) {\n          addError({\n            message: `Step ${i + 1}: ${civilization} civilization cannot build monasteries. Use fortified church instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Armenians and Georgians can build fortified church\n        if (\n          civilization !== \"Armenians\" &&\n          civilization !== \"Georgians\" &&\n          buildingType === \"fortifiedChurch\"\n        ) {\n          addError({\n            message: `Step ${i + 1}: Only Armenians and Georgians civilizations can build fortified churches. Use monastery instead.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Malay can build harbor\n        if (civilization !== \"Malay\" && buildingType === \"harbor\") {\n          addError({\n            message: `Step ${i + 1}: Only Malay civilization can build harbors.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n\n        // Only Khitans can build pasture\n        if (civilization !== \"Khitans\" && buildingType === \"pasture\") {\n          addError({\n            message: `Step ${i + 1}: Only Khitans civilization can build pastures.`,\n            stepIndex: i,\n            severity: \"error\",\n          });\n        }\n      }\n    }\n  }\n\n  // Add more validation rules here as needed\n  // Example: Check for invalid resource counts, missing required fields, etc.\n\n  return {\n    isValid: errors.filter((e) => e.severity === \"error\").length === 0,\n    errors,\n  };\n}\n\n/**\n * Helper function to calculate villager distribution up to a specific step\n * This tracks how many villagers are on each task\n */\nfunction calculateResourceDistribution(\n  steps: BuildOrderStep[],\n  upToStepIndex: number\n): Resources {\n  const distribution = createEmptyResourceSnapshot();\n\n  for (let i = 0; i <= upToStepIndex && i < steps.length; i++) {\n    const step = steps[i];\n\n    if (step.type === \"newVillagers\") {\n      const targetResource = taskToResource(step.task);\n      const count = Math.max(0, Number(step.count) || 0);\n      distribution[targetResource] =\n        (distribution[targetResource] || 0) + count;\n    } else if (step.type === \"moveVillagers\") {\n      const fromResource = taskToResource(step.from);\n      const toResource = taskToResource(step.to);\n      const count = Math.max(0, Number(step.count) || 0);\n\n      distribution[fromResource] = (distribution[fromResource] || 0) - count;\n      distribution[toResource] = (distribution[toResource] || 0) + count;\n    }\n  }\n\n  return distribution;\n}\n\n/**\n * Validates and throws if there are errors\n * Used by the converter to prevent conversion of invalid builds\n */\nexport function validateAndThrow(steps: BuildOrderStep[]): void {\n  const result = validateBuildOrder(steps);\n\n  const errorMessages = result.errors\n    .filter((e) => e.severity === \"error\")\n    .map((e) => e.message);\n\n  if (errorMessages.length > 0) {\n    throw new Error(`Build validation failed:\\n${errorMessages.join(\"\\n\")}`);\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1666, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/database.ts"],"sourcesContent":["import { store, storage } from \"./firebase\";\nimport {\n  doc,\n  getDoc,\n  getDocs,\n  updateDoc,\n  addDoc,\n  setDoc,\n  query,\n  collection,\n  where,\n  deleteDoc,\n  arrayUnion,\n  arrayRemove,\n} from \"firebase/firestore\";\nimport { ref, listAll, getDownloadURL } from \"firebase/storage\";\nimport { Build } from \"@/types/build\";\nimport { BuildOrderStep } from \"@/types/buildFormat\";\nimport { validateBuildOrder } from \"./buildValidation\";\n\nconst DEFAULT_BUILD_STEPS: BuildOrderStep[] = [\n  {\n    count: 6,\n    resources: {\n      gold: 0,\n      stone: 0,\n      build: 0,\n      food: 6,\n      wood: 0,\n    },\n    task: \"sheep\",\n    buildings: [\n      {\n        type: \"house\",\n        count: 2,\n      },\n    ],\n    type: \"newVillagers\",\n  },\n  {\n    type: \"newVillagers\",\n    count: 3,\n    task: \"wood\",\n    resources: {\n      food: 6,\n      stone: 0,\n      gold: 0,\n      build: 0,\n      wood: 3,\n    },\n  },\n  {\n    resources: {\n      food: 7,\n      gold: 0,\n      build: 0,\n      stone: 0,\n      wood: 3,\n    },\n    task: \"boar\",\n    type: \"newVillagers\",\n    count: 1,\n  },\n  {\n    buildings: [\n      {\n        count: 2,\n        type: \"house\",\n      },\n      {\n        count: 1,\n        type: \"mill\",\n      },\n    ],\n    task: \"berries\",\n    type: \"newVillagers\",\n    resources: {\n      build: 0,\n      gold: 0,\n      food: 11,\n      stone: 0,\n      wood: 3,\n    },\n    count: 4,\n  },\n  {\n    animal: \"boar\",\n    type: \"lure\",\n    resources: {\n      build: 0,\n      gold: 0,\n      wood: 3,\n      stone: 0,\n      food: 14,\n    },\n    count: 1,\n  },\n  {\n    task: \"berries\",\n    count: 3,\n    type: \"newVillagers\",\n    resources: {\n      build: 0,\n      food: 14,\n      gold: 0,\n      stone: 0,\n      wood: 6,\n    },\n  },\n  {\n    resources: {\n      build: 0,\n      wood: 6,\n      food: 14,\n      stone: 0,\n      gold: 0,\n    },\n    type: \"research\",\n    tech: [\"loom\"],\n  },\n  {\n    type: \"ageUp\",\n    resources: {\n      build: 0,\n      wood: 6,\n      gold: 0,\n      food: 14,\n      stone: 0,\n    },\n    age: \"feudalAge\",\n  },\n  {\n    resources: {\n      stone: 0,\n      wood: 10,\n      food: 10,\n      gold: 0,\n      build: 0,\n    },\n    to: \"wood\",\n    from: \"sheep\",\n    type: \"moveVillagers\",\n    count: 4,\n    buildings: [\n      {\n        type: \"lumberCamp\",\n        count: 1,\n      },\n    ],\n  },\n  {\n    type: \"build\",\n    buildings: [\n      {\n        count: 1,\n        type: \"barracks\",\n      },\n    ],\n    resources: {\n      wood: 10,\n      build: 0,\n      food: 10,\n      stone: 0,\n      gold: 0,\n    },\n  },\n  {\n    resources: {\n      food: 14,\n      wood: 6,\n      gold: 0,\n      build: 0,\n      stone: 0,\n    },\n    type: \"newAge\",\n    age: \"feudalAge\",\n  },\n  {\n    type: \"research\",\n    tech: [\"doubleBitAxe\", \"horseCollar\"],\n    resources: {\n      wood: 10,\n      build: 0,\n      stone: 0,\n      gold: 0,\n      food: 10,\n    },\n  },\n  {\n    resources: {\n      build: 0,\n      stone: 0,\n      wood: 10,\n      food: 10,\n      gold: 0,\n    },\n    buildings: [\n      {\n        count: 1,\n        type: \"stable\",\n      },\n    ],\n    type: \"build\",\n  },\n  {\n    type: \"trainUnit\",\n    unit: \"scout\",\n    count: 3,\n    resources: {\n      gold: 0,\n      food: 10,\n      build: 0,\n      wood: 10,\n      stone: 0,\n    },\n  },\n];\n\nfunction createDefaultBuildSteps(): BuildOrderStep[] {\n  return DEFAULT_BUILD_STEPS.map((step) =>\n    JSON.parse(JSON.stringify(step))\n  ) as BuildOrderStep[];\n}\n\ninterface User {\n  uid: string;\n}\n\ninterface UserProfile {\n  email: string;\n  favorites: string[];\n  profile_id: string;\n}\n\ninterface Rating {\n  build_id: string;\n  user_id: string;\n  rating: number;\n}\n\nclass DatabaseService {\n\n\n  static async loadAllPublishedBuilds(): Promise<Build[]> {\n    // Query for only builds with status 'published' or 'changed'\n    const q = query(\n      collection(store, \"published-builds\"),\n      where(\"status\", \"in\", [\"published\", \"changed\"])\n    );\n    const querySnapshot = await getDocs(q);\n    const data: Build[] = [];\n    querySnapshot.forEach((doc) => {\n      const build = doc.data() as Build;\n      build.id = doc.id;\n      data.push(build);\n    });\n    console.log(\n      `[DatabaseService] loadAllPublishedBuilds: found ${data.length} builds`\n    );\n    return data;\n  }\n\n  static async loadPublishedBuildWithId(id: string): Promise<Build> {\n    const docRef = doc(store, \"published-builds\", id);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n      const build = docSnap.data() as Build;\n      build.id = docSnap.id;\n      console.log(\n        \"[DatabaseService] loadPublishedBuildWithId: \",\n        JSON.stringify(build, null, 2)\n      );\n      if (build.status === \"published\" || build.status === \"changed\") {\n        return build;\n      } else {\n        throw new Error(`Build with id ${id} is not published`);\n      }\n    } else {\n      throw new Error(`No build with id ${id}`);\n    }\n  }\n\n  static async publishBuildWithId(id: string): Promise<string> {\n    // Load the draft build\n    const draftRef = doc(store, \"builds\", id);\n    const draftSnap = await getDoc(draftRef);\n\n    if (!draftSnap.exists()) {\n      throw new Error(`No draft build with id ${id} found`);\n    }\n\n    const draftBuild = draftSnap.data() as Build;\n\n    // Validate the build before publishing\n    if (draftBuild.build && Array.isArray(draftBuild.build)) {\n      const validationResult = validateBuildOrder(draftBuild.build, draftBuild.civilization);\n      if (!validationResult.isValid) {\n        const errorMessages = validationResult.errors\n          .filter(e => e.severity === \"error\")\n          .map(e => e.message)\n          .join(\"\\n\");\n        throw new Error(`Cannot publish build with validation errors:\\n${errorMessages}`);\n      }\n    }\n\n    // Copy to published-builds collection with published status\n    const publishedRef = doc(store, \"published-builds\", id);\n    await setDoc(publishedRef, {\n      ...draftBuild,\n      status: \"published\",\n    });\n\n    // Update draft status to published\n    await updateDoc(draftRef, { status: \"published\" });\n\n    return id;\n  }\n\n  static async unpublishBuildWithId(id: string): Promise<string> {\n    // Delete from published-builds collection\n    const publishedRef = doc(store, \"published-builds\", id);\n    await deleteDoc(publishedRef).catch((error) => {\n      throw new Error(`Error deleting published build with id ${id}: ${error}`);\n    });\n\n    // Update draft status to draft\n    const draftRef = doc(store, \"builds\", id);\n    await updateDoc(draftRef, { status: \"draft\" }).catch((error) => {\n      throw new Error(`Error updating draft build with id ${id}: ${error}`);\n    });\n\n    return id;\n  }\n\n  static async loadBuilds(userId?: string): Promise<Build[]> {\n    // Load from builds collection (drafts)\n    // If userId is provided, filter by publisher. Otherwise return all builds (admin view).\n    const q =\n      userId !== undefined\n        ? query(collection(store, \"builds\"), where(\"publisher\", \"==\", userId))\n        : query(collection(store, \"builds\"));\n    const querySnapshot = await getDocs(q);\n    const data: Build[] = [];\n    querySnapshot.forEach((doc) => {\n      const build = doc.data() as Build;\n      build.id = doc.id;\n      data.push(build);\n    });\n    return data;\n  }\n\n  static async loadBuildWithId(id: string): Promise<Build> {\n    const docRef = doc(store, \"builds\", id);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n      const build = docSnap.data() as Build;\n      build.id = docSnap.id;\n      console.log(\"Loaded build:\", JSON.stringify(build, null, 2));\n      return build;\n    } else {\n      throw new Error(`No build with id ${id}`);\n    }\n  }\n\n  static async saveBuildWithId(\n    buildId: string,\n    buildData: Partial<Build>\n  ): Promise<void> {\n    // Save to builds collection (draft/working version)\n    const docRef = doc(store, \"builds\", buildId);\n\n    await updateDoc(docRef, buildData).catch((error) => {\n      throw new Error(`Error saving build with id ${buildId}: ${error}`);\n    });\n  }\n\n  static async addNewBuildForPublisher(publisher: string): Promise<string> {\n    const build: Partial<Build> = {\n      title: \"New Build\",\n      civilization: \"Generic\",\n      publisher: publisher,\n      status: \"draft\",\n      build: createDefaultBuildSteps(),\n    };\n    const docRef = await addDoc(collection(store, \"builds\"), build);\n    return docRef.id;\n  }\n\n  static async deleteBuildWithId(id: string): Promise<void> {\n    // Delete from both collections\n    const draftRef = doc(store, \"builds\", id);\n    await deleteDoc(draftRef).catch((error) => {\n      throw new Error(`Error deleting draft build with id ${id}: ${error}`);\n    });\n\n    // Try to delete from published-builds (may not exist)\n    try {\n      const publishedRef = doc(store, \"published-builds\", id);\n      await deleteDoc(publishedRef);\n    } catch {\n      // Ignore error if published version doesn't exist\n    }\n  }\n\n  static async loadPublishedVersionOfBuild(id: string): Promise<Build | null> {\n    try {\n      const docRef = doc(store, \"published-builds\", id);\n      const docSnap = await getDoc(docRef);\n\n      if (docSnap.exists()) {\n        const build = docSnap.data() as Build;\n        build.id = docSnap.id;\n        return build;\n      }\n      return null;\n    } catch {\n      return null;\n    }\n  }\n\n  static async getListOfAllAvailableImages(): Promise<string[]> {\n    const imagesRef = ref(storage, \"Images\");\n    const images: string[] = [];\n\n    await listAll(imagesRef)\n      .then((res) => {\n        res.items.forEach((itemRef) => {\n          images.push(itemRef.name.slice(0, -4));\n        });\n      })\n      .catch((error) => {\n        throw new Error(`Couldn't get all available images: ${error}`);\n      });\n\n    return images;\n  }\n\n  static async getImageURLWithName(name: string): Promise<string> {\n    return await getDownloadURL(ref(storage, `Images/${name}.png`))\n      .then((url) => {\n        return url;\n      })\n      .catch((error) => {\n        throw new Error(\n          `Not able to get URL for image with name: ${name} - Error: ${error}`\n        );\n      });\n  }\n\n  static async loadProfileInfo(user: User): Promise<UserProfile> {\n    const docRef = doc(store, \"users\", user.uid);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n      const userData = docSnap.data() as UserProfile;\n      return userData;\n    } else {\n      throw new Error(`No user with id ${user.uid} found`);\n    }\n  }\n\n  static async saveProfileInfo(\n    user: User,\n    email: string,\n    profileId: string\n  ): Promise<void> {\n    const docRef = doc(store, \"users\", user.uid);\n\n    const userData = { email: email, profile_id: profileId };\n\n    await updateDoc(docRef, userData).catch((error) => {\n      throw new Error(\n        `Error saving profile info for user with id ${user.uid}: ${error}`\n      );\n    });\n  }\n\n  // FAV BUILDS\n  static async favBuildWithIdForUser(id: string, user: User): Promise<void> {\n    const docRef = doc(store, \"users\", user.uid);\n\n    try {\n      await updateDoc(docRef, {\n        favorites: arrayUnion(id),\n      });\n    } catch (error) {\n      // If user document doesn't exist, create it with the favorite\n      const docSnap = await getDoc(docRef);\n      if (!docSnap.exists()) {\n        await setDoc(docRef, {\n          favorites: [id],\n          email: \"\",\n          profile_id: \"\",\n        });\n      } else {\n        throw new Error(`Error favoring build with id ${id}: ${error}`);\n      }\n    }\n  }\n\n  static async removeFavBuildWithIdForUser(\n    id: string,\n    user: User\n  ): Promise<void> {\n    const docRef = doc(store, \"users\", user.uid);\n\n    try {\n      await updateDoc(docRef, {\n        favorites: arrayRemove(id),\n      });\n    } catch (error) {\n      // If user document doesn't exist, create it without the favorite (empty array)\n      const docSnap = await getDoc(docRef);\n      if (!docSnap.exists()) {\n        await setDoc(docRef, {\n          favorites: [],\n          email: \"\",\n          profile_id: \"\",\n        });\n      } else {\n        throw new Error(\n          `Error removing favorite build with id ${id}: ${error}`\n        );\n      }\n    }\n  }\n\n  // RATINGS\n  static async rateBuildWithIdForUser(\n    id: string,\n    user: User,\n    rating: number\n  ): Promise<string> {\n    const docRef = doc(store, \"ratings\", `rating-${id}-${user.uid}`);\n    const data = { build_id: id, user_id: user.uid, rating: rating };\n\n    await setDoc(docRef, data).catch((error) => {\n      throw new Error(`Error rating build with id ${id}: ${error}`);\n    });\n\n    return docRef.id;\n  }\n\n  static async loadUserRatingForBuild(\n    buildId: string,\n    userId: string\n  ): Promise<Rating> {\n    const docRef = doc(store, \"ratings\", `rating-${buildId}-${userId}`);\n    const docSnap = await getDoc(docRef);\n\n    if (docSnap.exists()) {\n      return docSnap.data() as Rating;\n    } else {\n      throw new Error(\n        `No rating for build with id ${buildId} and user ${userId}`\n      );\n    }\n  }\n}\n\nexport default DatabaseService;\n"],"names":[],"mappings":";;;AAAA;AACA;AAAA;AAcA;AAAA;AAGA;;;;;AAEA,MAAM,sBAAwC;IAC5C;QACE,OAAO;QACP,WAAW;YACT,MAAM;YACN,OAAO;YACP,OAAO;YACP,MAAM;YACN,MAAM;QACR;QACA,MAAM;QACN,WAAW;YACT;gBACE,MAAM;gBACN,OAAO;YACT;SACD;QACD,MAAM;IACR;IACA;QACE,MAAM;QACN,OAAO;QACP,MAAM;QACN,WAAW;YACT,MAAM;YACN,OAAO;YACP,MAAM;YACN,OAAO;YACP,MAAM;QACR;IACF;IACA;QACE,WAAW;YACT,MAAM;YACN,MAAM;YACN,OAAO;YACP,OAAO;YACP,MAAM;QACR;QACA,MAAM;QACN,MAAM;QACN,OAAO;IACT;IACA;QACE,WAAW;YACT;gBACE,OAAO;gBACP,MAAM;YACR;YACA;gBACE,OAAO;gBACP,MAAM;YACR;SACD;QACD,MAAM;QACN,MAAM;QACN,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,OAAO;IACT;IACA;QACE,QAAQ;QACR,MAAM;QACN,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,OAAO;IACT;IACA;QACE,MAAM;QACN,OAAO;QACP,MAAM;QACN,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,OAAO;YACP,MAAM;QACR;IACF;IACA;QACE,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,OAAO;YACP,MAAM;QACR;QACA,MAAM;QACN,MAAM;YAAC;SAAO;IAChB;IACA;QACE,MAAM;QACN,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,MAAM;YACN,OAAO;QACT;QACA,KAAK;IACP;IACA;QACE,WAAW;YACT,OAAO;YACP,MAAM;YACN,MAAM;YACN,MAAM;YACN,OAAO;QACT;QACA,IAAI;QACJ,MAAM;QACN,MAAM;QACN,OAAO;QACP,WAAW;YACT;gBACE,MAAM;gBACN,OAAO;YACT;SACD;IACH;IACA;QACE,MAAM;QACN,WAAW;Y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","debugId":null}},
    {"offset": {"line": 2149, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/text.ts"],"sourcesContent":["const ACRONYM_PATTERN = /^[A-Z0-9]+$/;\nconst SMALL_WORDS = new Set([\n  \"a\",\n  \"an\",\n  \"and\",\n  \"as\",\n  \"at\",\n  \"but\",\n  \"by\",\n  \"for\",\n  \"from\",\n  \"in\",\n  \"into\",\n  \"nor\",\n  \"of\",\n  \"on\",\n  \"or\",\n  \"per\",\n  \"than\",\n  \"the\",\n  \"to\",\n  \"vs\",\n  \"with\",\n]);\n\nexport function toTitleCaseLabel(input: string | undefined | null): string {\n  if (!input) {\n    return \"\";\n  }\n\n  const normalizedInput = input.normalize(\"NFKC\");\n  const WORD_REGEX = /[A-Za-z0-9']+/g;\n  const matches = Array.from(normalizedInput.matchAll(WORD_REGEX));\n\n  if (matches.length === 0) {\n    return normalizedInput;\n  }\n\n  const totalWords = matches.length;\n  let lastIndex = 0;\n  let forceCapNext = true;\n  const parts: string[] = [];\n\n  for (let index = 0; index < totalWords; index++) {\n    const match = matches[index];\n    const word = match[0];\n    const start = match.index ?? 0;\n    const end = start + word.length;\n    const lower = word.toLowerCase();\n    const isFirst = index === 0;\n    const isLast = index === totalWords - 1;\n    const preceding = normalizedInput.slice(lastIndex, start);\n    const hasTerminalPunctuation = /[:.!?]/.test(preceding);\n    if (hasTerminalPunctuation) {\n      forceCapNext = true;\n    }\n\n    const isSmallWord = SMALL_WORDS.has(lower);\n    const isAcronym =\n      !isSmallWord &&\n      ((ACRONYM_PATTERN.test(word) && word.length <= 4) ||\n        word === word.toUpperCase());\n\n    const shouldForce = forceCapNext || isFirst;\n\n    parts.push(normalizedInput.slice(lastIndex, start));\n\n    let transformed = word;\n    if (!isAcronym) {\n      if (isSmallWord && !shouldForce && !isLast) {\n        transformed = lower;\n      } else {\n        transformed = lower.charAt(0).toUpperCase() + lower.slice(1);\n      }\n    } else {\n      transformed = word.toUpperCase();\n    }\n\n    parts.push(transformed);\n    lastIndex = end;\n\n    const nextStart =\n      index + 1 < totalWords\n        ? matches[index + 1].index ?? normalizedInput.length\n        : normalizedInput.length;\n\n    const between = normalizedInput.slice(end, nextStart);\n    forceCapNext = /[:.!?]/.test(between);\n  }\n\n  parts.push(normalizedInput.slice(lastIndex));\n\n  return parts.join(\"\");\n}\n"],"names":[],"mappings":";;;AAAA,MAAM,kBAAkB;AACxB,MAAM,cAAc,IAAI,IAAI;IAC1B;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;IACA;CACD;AAEM,SAAS,iBAAiB,KAAgC;IAC/D,IAAI,CAAC,OAAO;QACV,OAAO;IACT;IAEA,MAAM,kBAAkB,MAAM,SAAS,CAAC;IACxC,MAAM,aAAa;IACnB,MAAM,UAAU,MAAM,IAAI,CAAC,gBAAgB,QAAQ,CAAC;IAEpD,IAAI,QAAQ,MAAM,KAAK,GAAG;QACxB,OAAO;IACT;IAEA,MAAM,aAAa,QAAQ,MAAM;IACjC,IAAI,YAAY;IAChB,IAAI,eAAe;IACnB,MAAM,QAAkB,EAAE;IAE1B,IAAK,IAAI,QAAQ,GAAG,QAAQ,YAAY,QAAS;QAC/C,MAAM,QAAQ,OAAO,CAAC,MAAM;QAC5B,MAAM,OAAO,KAAK,CAAC,EAAE;YACP;QAAd,MAAM,QAAQ,CAAA,eAAA,MAAM,KAAK,cAAX,0BAAA,eAAe;QAC7B,MAAM,MAAM,QAAQ,KAAK,MAAM;QAC/B,MAAM,QAAQ,KAAK,WAAW;QAC9B,MAAM,UAAU,UAAU;QAC1B,MAAM,SAAS,UAAU,aAAa;QACtC,MAAM,YAAY,gBAAgB,KAAK,CAAC,WAAW;QACnD,MAAM,yBAAyB,SAAS,IAAI,CAAC;QAC7C,IAAI,wBAAwB;YAC1B,eAAe;QACjB;QAEA,MAAM,cAAc,YAAY,GAAG,CAAC;QACpC,MAAM,YACJ,CAAC,eACD,CAAC,AAAC,gBAAgB,IAAI,CAAC,SAAS,KAAK,MAAM,IAAI,KAC7C,SAAS,KAAK,WAAW,EAAE;QAE/B,MAAM,cAAc,gBAAgB;QAEpC,MAAM,IAAI,CAAC,gBAAgB,KAAK,CAAC,WAAW;QAE5C,IAAI,cAAc;QAClB,IAAI,CAAC,WAAW;YACd,IAAI,eAAe,CAAC,eAAe,CAAC,QAAQ;gBAC1C,cAAc;YAChB,OAAO;gBACL,cAAc,MAAM,MAAM,CAAC,GAAG,WAAW,KAAK,MAAM,KAAK,CAAC;YAC5D;QACF,OAAO;YACL,cAAc,KAAK,WAAW;QAChC;QAEA,MAAM,IAAI,CAAC;QACX,YAAY;YAIN;QAFN,MAAM,YACJ,QAAQ,IAAI,aACR,CAAA,kBAAA,OAAO,CAAC,QAAQ,EAAE,CAAC,KAAK,cAAxB,6BAAA,kBAA4B,gBAAgB,MAAM,GAClD,gBAAgB,MAAM;QAE5B,MAAM,UAAU,gBAAgB,KAAK,CAAC,KAAK;QAC3C,eAAe,SAAS,IAAI,CAAC;IAC/B;IAEA,MAAM,IAAI,CAAC,gBAAgB,KAAK,CAAC;IAEjC,OAAO,MAAM,IAAI,CAAC;AACpB","debugId":null}},
    {"offset": {"line": 2237, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/gameConstants.ts"],"sourcesContent":["import gameConstants from \"@/data/gameConstants.json\";\nimport { toTitleCaseLabel } from \"@/lib/text\";\n\nexport interface GameConstant {\n  value: string;\n  label: string;\n}\n\nexport interface GameConstants {\n  technologies: GameConstant[];\n  buildings: GameConstant[];\n  units: GameConstant[];\n  resources: GameConstant[];\n  ages: GameConstant[];\n  tasks: GameConstant[];\n  tradeActions: GameConstant[];\n  animals: GameConstant[];\n}\n\nconst rawGameConstants = gameConstants as GameConstants;\n\nconst sortByLabel = (items: GameConstant[] = []): GameConstant[] =>\n  [...items].sort((a, b) => a.label.localeCompare(b.label));\n\nconst normalizeItems = (items: GameConstant[] = []): GameConstant[] =>\n  items.map((item) => ({\n    ...item,\n    label: toTitleCaseLabel(item.label || \"\"),\n  }));\n\nexport const GAME_CONSTANTS: GameConstants = {\n  ...rawGameConstants,\n  technologies: sortByLabel(normalizeItems(rawGameConstants.technologies)),\n  buildings: sortByLabel(normalizeItems(rawGameConstants.buildings)),\n  units: sortByLabel(normalizeItems(rawGameConstants.units)),\n  resources: sortByLabel(normalizeItems(rawGameConstants.resources)),\n  ages: sortByLabel(normalizeItems(rawGameConstants.ages)),\n  tasks: sortByLabel(normalizeItems(rawGameConstants.tasks)),\n  tradeActions: sortByLabel(normalizeItems(rawGameConstants.tradeActions)),\n  animals: sortByLabel(normalizeItems(rawGameConstants.animals)),\n};\n\n// Utility functions to get labels by value\nexport function getTechnologyLabel(value: string): string {\n  const tech = GAME_CONSTANTS.technologies.find(t => t.value === value);\n  return tech ? tech.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getBuildingLabel(value: string): string {\n  const building = GAME_CONSTANTS.buildings.find(b => b.value === value);\n  return building ? building.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getUnitLabel(value: string): string {\n  const unit = GAME_CONSTANTS.units.find(u => u.value === value);\n  return unit ? unit.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getResourceLabel(value: string): string {\n  const resource = GAME_CONSTANTS.resources.find(r => r.value === value);\n  return resource ? resource.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getAgeLabel(value: string): string {\n  const age = GAME_CONSTANTS.ages.find(a => a.value === value);\n  return age ? age.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getTaskLabel(value: string): string {\n  const task = GAME_CONSTANTS.tasks.find(t => t.value === value);\n  return task ? task.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getTradeActionLabel(value: string): string {\n  const action = GAME_CONSTANTS.tradeActions.find(a => a.value === value);\n  return action ? action.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\nexport function getAnimalLabel(value: string): string {\n  const animal = GAME_CONSTANTS.animals.find(a => a.value === value);\n  return animal ? animal.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n\n// Generic function to get any label by category and value\nexport function getGameConstantLabel(category: keyof GameConstants, value: string): string {\n  const item = GAME_CONSTANTS[category].find((item: GameConstant) => item.value === value);\n  return item ? item.label : value.charAt(0).toUpperCase() + value.slice(1);\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2323, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/stepParser.ts"],"sourcesContent":["import { BuildOrderStep, Resources } from \"@/types/buildFormat\";\nimport { toTitleCaseLabel } from \"@/lib/text\";\n\nexport interface ParsedStepInfo {\n  action: string;\n  resource?: string;\n  amount?: number;\n  condition?: string;\n  building?: string;\n  unit?: string;\n  details?: string;\n}\n\nfunction convertCamelCaseToReadable(camelCaseString: string): string {\n  // Insert spaces before capital letters and numbers\n  const readable = camelCaseString\n    .replace(/([a-z])([A-Z])/g, '$1 $2') // camelCase -> camel Case\n    .replace(/([a-zA-Z])(\\d)/g, '$1 $2') // letter followed by number -> letter number  \n    .replace(/(\\d)([a-zA-Z])/g, '$1 $2'); // number followed by letter -> number letter\n\n  // Split into words and apply smart capitalization\n  const words = readable.split(/\\s+/);\n  const capitalizedWords = words.map((word, index) => \n    smartCapitalize(word, index === 0)\n  );\n\n  return capitalizedWords.join(' ');\n}\n\nconst SPECIAL_TASK_LABELS: Record<string, string> = {\n  foodundertc: \"Food Under TC\",\n};\n\nexport function convertTaskToReadableText(taskString: string): string {\n  const normalizedTask = taskString.trim().toLowerCase();\n\n  if (SPECIAL_TASK_LABELS[normalizedTask]) {\n    return SPECIAL_TASK_LABELS[normalizedTask];\n  }\n\n  const readable = convertCamelCaseToReadable(taskString);\n  return toTitleCaseLabel(readable);\n}\n\nexport function parseCamelCaseStep(stepName: string): ParsedStepInfo {\n  const info: ParsedStepInfo = {\n    action: stepName\n  };\n\n  // Extract numbers (amounts, counts)\n  const numberMatch = stepName.match(/(\\d+)/);\n  if (numberMatch) {\n    info.amount = parseInt(numberMatch[1]);\n  }\n\n  // Extract resource names\n  const resourcePatterns = ['gold', 'food', 'wood', 'stone'];\n  for (const resource of resourcePatterns) {\n    if (stepName.toLowerCase().includes(resource)) {\n      info.resource = resource;\n      break;\n    }\n  }\n\n  // Extract building names\n  const buildingPatterns = [\n    'barracks', 'range', 'archeryrange', 'stable', 'market', 'blacksmith',\n    'mill', 'lumbercamp', 'miningcamp', 'dock', 'monastery', 'university',\n    'castle', 'towncenter', 'house', 'farm', 'wall', 'gate', 'tower'\n  ];\n  for (const building of buildingPatterns) {\n    if (stepName.toLowerCase().includes(building)) {\n      info.building = building;\n      break;\n    }\n  }\n\n  // Extract unit names\n  const unitPatterns = [\n    'villager', 'militia', 'archer', 'spearman', 'scout', 'knight',\n    'crossbow', 'longsword', 'pikeman', 'cavalry', 'monk'\n  ];\n  for (const unit of unitPatterns) {\n    if (stepName.toLowerCase().includes(unit)) {\n      info.unit = unit;\n      break;\n    }\n  }\n\n  // Extract conditions (after/when/before/if)\n  const conditionMatch = stepName.match(/after([A-Z][a-z]*)/i);\n  if (conditionMatch) {\n    info.condition = conditionMatch[1].toLowerCase();\n  }\n\n  // Determine action based on common patterns\n  if (stepName.toLowerCase().includes('collect')) {\n    info.action = 'collect';\n  } else if (stepName.toLowerCase().includes('build')) {\n    info.action = 'build';\n  } else if (stepName.toLowerCase().includes('train')) {\n    info.action = 'train';\n  } else if (stepName.toLowerCase().includes('research')) {\n    info.action = 'research';\n  } else if (stepName.toLowerCase().includes('move')) {\n    info.action = 'move';\n  } else if (stepName.toLowerCase().includes('lure')) {\n    info.action = 'lure';\n  }\n\n  return info;\n}\n\nexport function createStepFromString(stepName: string, resources: Resources): BuildOrderStep {\n  const parsed = parseCamelCaseStep(stepName);\n  \n  // Try to determine step type based on parsed information\n  if (parsed.building && parsed.action === 'build') {\n    return {\n      type: \"build\",\n      buildings: [{ type: parsed.building, count: parsed.amount || 1 }],\n      resources\n    };\n  }\n  \n  if (parsed.unit && parsed.action === 'train') {\n    return {\n      type: \"trainUnit\",\n      unit: parsed.unit,\n      count: parsed.amount || 1,\n      resources\n    };\n  }\n  \n  // Default to custom step for unrecognized patterns\n  return {\n    type: \"custom\",\n    text: stepName.replace(/([A-Z])/g, ' $1').trim(),\n    resources\n  };\n}\n\n// Special game terms that should be capitalized\nconst SPECIAL_TERMS = {\n  resources: ['gold', 'food', 'wood', 'stone', 'tree'],\n  buildings: [\n    'barracks', 'range', 'archeryrange', 'stable', 'market', 'blacksmith', 'mill',\n    'lumbercamp', 'miningcamp', 'dock', 'monastery', 'university', 'castle',\n    'towncenter', 'house', 'farm', 'wall', 'gate', 'tower', 'outpost', 'wonder',\n    'feitoria', 'krepost', 'donjon'\n  ],\n  units: [\n    'villager', 'militia', 'archer', 'spearman', 'scout', 'knight', 'crossbow',\n    'longsword', 'pikeman', 'cavalry', 'monk', 'catapult', 'trebuchet', 'bombard',\n    'cannon', 'galley', 'warship', 'transport'\n  ],\n  technologies: [\n    'loom', 'wheelbarrow', 'handcart', 'horsecollar', 'heavyplow', 'croppotation',\n    'doubleribtaxes', 'coinage', 'banking', 'guilds', 'forging', 'ironsting',\n    'blastfurnace', 'scalemailarmor', 'chainmailarmor', 'platemailarmor',\n    'fletching', 'boddkinpoint', 'bracer', 'paddedarcherarmor', 'leatherarcherarmor',\n    'ringarcherarmor'\n  ],\n  ages: ['darkage', 'feudalage', 'castleage', 'imperialage']\n};\n\nfunction isSpecialTerm(word: string): boolean {\n  const lowerWord = word.toLowerCase();\n  return SPECIAL_TERMS.resources.includes(lowerWord) ||\n         SPECIAL_TERMS.buildings.includes(lowerWord) ||\n         SPECIAL_TERMS.units.includes(lowerWord) ||\n         SPECIAL_TERMS.technologies.includes(lowerWord) ||\n         SPECIAL_TERMS.ages.includes(lowerWord);\n}\n\nfunction capitalizeWord(word: string): string {\n  return word.charAt(0).toUpperCase() + word.slice(1);\n}\n\nfunction smartCapitalize(word: string, isFirstWord: boolean = false): string {\n  if (isFirstWord || isSpecialTerm(word)) {\n    return capitalizeWord(word);\n  }\n  return word.toLowerCase();\n}\n\nfunction formatBuildingName(building: string): string {\n  // Handle special building names\n  const buildingMap: { [key: string]: string } = {\n    'barracks': 'Barracks',\n    'archeryrange': 'Archery Range', \n    'range': 'Archery Range',\n    'stable': 'Stable',\n    'market': 'Market',\n    'blacksmith': 'Blacksmith',\n    'mill': 'Mill',\n    'lumbercamp': 'Lumber Camp',\n    'miningcamp': 'Mining Camp',\n    'dock': 'Dock',\n    'monastery': 'Monastery',\n    'university': 'University',\n    'castle': 'Castle',\n    'towncenter': 'Town Center',\n    'house': 'House',\n    'farm': 'Farm'\n  };\n  \n  return buildingMap[building.toLowerCase()] || capitalizeWord(building);\n}\n\nexport function formatStepDescription(step: BuildOrderStep): string {\n  switch (step.type) {\n    default:\n      return '';\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2610, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/pluralization.ts"],"sourcesContent":["/**\n * Pluralization utility for Age of Empires II unit and building names\n */\n\nconst IRREGULAR_PLURALS: Record<string, string> = {\n  // Units ending in -man\n  Spearman: \"Spearmen\",\n  Militiaman: \"Militiamen\",\n  Longbowman: \"Longbowmen\",\n  \"Jian Swordsman\": \"Jian Swordsmen\",\n  \"Urumi Swordsman\": \"Urumi Swordsmen\",\n  \"Throwing Axeman\": \"Throwing Axemen\",\n  \"Genoese Crossbowman\": \"Genoese Crossbowmen\",\n\n  // Compound units\n  \"Man-at-Arms\": \"Men-at-Arms\",\n\n  // Units that don't change in plural\n  Militia: \"Militia\",\n\n  // Buildings ending in -s (already plural-looking)\n  Barracks: \"Barracks\",\n\n  // Buildings with irregular plurals\n  \"Fortified Church\": \"Fortified Churches\",\n\n  // Buildings that are always plural or don't change\n  Wall: \"Walls\",\n  Gate: \"Gates\",\n};\n\n/**\n * Pluralize a unit or building name\n */\nexport function pluralize(name: string, count: number = 2): string {\n  if (count === 1) {\n    return name;\n  }\n\n  // Check for irregular plurals first\n  if (name in IRREGULAR_PLURALS) {\n    return IRREGULAR_PLURALS[name];\n  }\n\n  // Words ending in 's', 'x', 'z', 'ch', 'sh' typically add 'es'\n  if (/[sxz]$|[cs]h$/.test(name)) {\n    return `${name}es`;\n  }\n\n  // Words ending in consonant + 'y' change to 'ies'\n  if (/[^aeiou]y$/i.test(name)) {\n    return name.slice(0, -1) + \"ies\";\n  }\n\n  // Default: add 's'\n  return `${name}s`;\n}\n"],"names":[],"mappings":"AAAA;;CAEC;;;AAED,MAAM,oBAA4C;IAChD,uBAAuB;IACvB,UAAU;IACV,YAAY;IACZ,YAAY;IACZ,kBAAkB;IAClB,mBAAmB;IACnB,mBAAmB;IACnB,uBAAuB;IAEvB,iBAAiB;IACjB,eAAe;IAEf,oCAAoC;IACpC,SAAS;IAET,kDAAkD;IAClD,UAAU;IAEV,mCAAmC;IACnC,oBAAoB;IAEpB,mDAAmD;IACnD,MAAM;IACN,MAAM;AACR;AAKO,SAAS,UAAU,IAAY;QAAE,QAAA,iEAAgB;IACtD,IAAI,UAAU,GAAG;QACf,OAAO;IACT;IAEA,oCAAoC;IACpC,IAAI,QAAQ,mBAAmB;QAC7B,OAAO,iBAAiB,CAAC,KAAK;IAChC;IAEA,+DAA+D;IAC/D,IAAI,gBAAgB,IAAI,CAAC,OAAO;QAC9B,OAAO,AAAC,GAAO,OAAL,MAAK;IACjB;IAEA,kDAAkD;IAClD,IAAI,cAAc,IAAI,CAAC,OAAO;QAC5B,OAAO,KAAK,KAAK,CAAC,GAAG,CAAC,KAAK;IAC7B;IAEA,mBAAmB;IACnB,OAAO,AAAC,GAAO,OAAL,MAAK;AACjB","debugId":null}},
    {"offset": {"line": 2665, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/specialUnits.ts"],"sourcesContent":["export const SINGLE_UNIT_ONLY_UNITS = new Set([\n  \"sunJian\",\n  \"caoCao\",\n  \"liuBei\",\n]);\n"],"names":[],"mappings":";;;AAAO,MAAM,yBAAyB,IAAI,IAAI;IAC5C;IACA;IACA;CACD","debugId":null}},
    {"offset": {"line": 2682, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/stepDescriptions.ts"],"sourcesContent":["\"use client\";\n\nimport { BuildOrderStep, CollectGoldStep, LureStep } from \"@/types/buildFormat\";\nimport {\n  getTechnologyLabel,\n  getBuildingLabel,\n  getUnitLabel,\n  getAgeLabel,\n} from \"@/lib/gameConstants\";\nimport {\n  convertTaskToReadableText,\n  createStepFromString,\n  formatStepDescription,\n} from \"@/lib/stepParser\";\nimport { pluralize } from \"@/lib/pluralization\";\nimport { SINGLE_UNIT_ONLY_UNITS } from \"@/lib/specialUnits\";\n\nconst MOVE_TASK_LABELS: Record<\n  string,\n  {\n    singular: string;\n    plural?: string;\n  }\n> = {\n  boar: { singular: \"Boar\", plural: \"Boars\" },\n  sheep: { singular: \"Sheep\", plural: \"Sheep\" },\n  deer: { singular: \"Deer\", plural: \"Deer\" },\n  chicken: { singular: \"Chicken\", plural: \"Chickens\" },\n  fox: { singular: \"Fox\", plural: \"Foxes\" },\n  berries: { singular: \"Berry\", plural: \"Berries\" },\n  farms: { singular: \"Farm\", plural: \"Farms\" },\n  wood: { singular: \"Wood\", plural: \"Wood\" },\n  shorefish: { singular: \"Shore Fish\", plural: \"Shore Fish\" },\n  gold: { singular: \"Gold\", plural: \"Gold\" },\n  stone: { singular: \"Stone\", plural: \"Stone\" },\n  stragglertree: { singular: \"Straggler Tree\", plural: \"Straggler Trees\" },\n  forward: { singular: \"Forward\", plural: \"Forward\" },\n  foodundertc: { singular: \"Food Under TC\", plural: \"Food Under TC\" },\n};\n\nfunction formatMoveTaskLabel(task: string | undefined, count: number): string {\n  const normalized = (task || \"\").trim().toLowerCase();\n\n  if (!normalized) {\n    return count === 1 ? \"Task\" : \"Tasks\";\n  }\n\n  if (normalized === \"build\") {\n    return count === 1 ? \"Builder\" : \"Builders\";\n  }\n\n  const labels = MOVE_TASK_LABELS[normalized];\n  if (labels) {\n    const value =\n      count === 1 ? labels.singular : labels.plural || labels.singular;\n    return value;\n  }\n\n  const readable = convertTaskToReadableText(task || \"\");\n  if (count === 1) {\n    return readable;\n  }\n  return pluralize(readable, count);\n}\n\nexport interface DescribeStepOptions {\n  includeAgeTransitions?: boolean;\n}\n\nexport function describeBuildStep(\n  step: BuildOrderStep,\n  index: number,\n  currentVillagerCount = 3,\n  options: DescribeStepOptions = {}\n): string {\n  const prefixOptional = (text: string): string => {\n    if (!text) return text;\n    if (!step.optional) return text;\n    if (/^optional:\\s*/i.test(text)) return text;\n    return `Optional: ${text}`;\n  };\n\n  switch (step.type) {\n    case \"newVillagers\": {\n      let description = \"\";\n      if (step.buildings && step.buildings.length > 0) {\n        const buildingText = step.buildings\n          .map((b) => {\n            const buildingName =\n              b.type === \"archeryRange\" ? \"Range\" : getBuildingLabel(b.type);\n            if (b.count > 1) {\n              return `${b.count} ${pluralize(buildingName, b.count)}`;\n            }\n            return buildingName;\n          })\n          .join(\" + \");\n\n        if (step.task.toLowerCase() === \"build\") {\n          description = `${step.count} Build${step.count > 1 ? \"\" : \"s\"} ${buildingText}`;\n        } else {\n          const taskName = convertTaskToReadableText(step.task);\n          description = `${buildingText} + ${step.count} on ${taskName}`;\n        }\n      } else {\n        const taskName = convertTaskToReadableText(step.task);\n\n        if (step.task.toLowerCase() === \"boar\") {\n          description = `${step.count} Lure${step.count === 1 ? \"s\" : \"\"} Boar`;\n        } else {\n          description = `${step.count} on ${taskName}`;\n        }\n      }\n      return prefixOptional(description);\n    }\n    case \"moveVillagers\": {\n      const normalizedFrom = (step.from || \"\").toLowerCase();\n      const normalizedTo = (step.to || \"\").toLowerCase();\n      let moveDescription = \"\";\n\n      if (normalizedTo === \"farms\" || normalizedTo === \"farm\") {\n        const farmText = step.count === 1 ? \"Farm\" : \"Farms\";\n\n        if (\n          normalizedFrom === \"sheep\" ||\n          normalizedFrom === \"boar\" ||\n          normalizedFrom === \"deer\"\n        ) {\n          moveDescription = `Seed ${step.count} ${farmText} with Villagers under TC`;\n        } else {\n          let villagerType = \"\";\n          switch (normalizedFrom) {\n            case \"wood\":\n              villagerType = \"Lumberjack\";\n              break;\n            case \"berries\":\n            case \"food\":\n              villagerType = \"Forager\";\n              break;\n            case \"gold\":\n              villagerType = \"Gold Miner\";\n              break;\n            case \"stone\":\n              villagerType = \"Stone Miner\";\n              break;\n            case \"build\":\n              villagerType = \"Builder\";\n              break;\n            default:\n              villagerType = formatMoveTaskLabel(step.from, 1);\n          }\n\n          moveDescription = `Seed ${step.count} ${farmText} with ${pluralize(\n            villagerType,\n            step.count\n          )}`;\n        }\n      } else {\n        const fromResourceText = formatMoveTaskLabel(step.from, step.count);\n        const toResourceText = formatMoveTaskLabel(step.to, step.count);\n\n        moveDescription = `${step.count} ${fromResourceText}  ${toResourceText}`;\n      }\n\n      if (step.buildings && step.buildings.length > 0) {\n        const buildingText = step.buildings\n          .map((b) => {\n            const buildingName =\n              b.type === \"archeryRange\" ? \"Range\" : getBuildingLabel(b.type);\n            if (b.count > 1) {\n              return `${b.count} ${pluralize(buildingName, b.count)}`;\n            }\n            return buildingName;\n          })\n          .join(\" + \");\n\n        return prefixOptional(`${moveDescription} + ${buildingText}`);\n      }\n\n      return prefixOptional(moveDescription);\n    }\n    case \"lure\": {\n      const lureStep = step as LureStep;\n      const animal = (lureStep.animal || \"\").toLowerCase();\n      const animalName = animal.charAt(0).toUpperCase() + animal.slice(1);\n\n      if (animal === \"boar\") {\n        return prefixOptional(\"Lure Boar With Villager Under TC\");\n      }\n\n      if (animal === \"deer\") {\n        const pushCount = Math.max(Number(lureStep.count) || 1, 1);\n        return prefixOptional(`Push ${pushCount} Deer With Your Scout`);\n      }\n\n      return prefixOptional(\n        `${lureStep.count} Lure${lureStep.count === 1 ? \"s\" : \"\"} ${animalName}`\n      );\n    }\n    case \"research\": {\n      const techNames = step.tech.map((tech) => getTechnologyLabel(tech));\n      return prefixOptional(`Research ${techNames.join(\" + \")}`);\n    }\n    case \"ageUp\": {\n      const ageName = getAgeLabel(step.age);\n\n      if (step.age === \"feudalAge\") {\n        return prefixOptional(\n          `Research ${currentVillagerCount + 1} Pop ${ageName}`\n        );\n      }\n      return prefixOptional(`Research ${ageName}`);\n    }\n    case \"newAge\":\n      if (!options.includeAgeTransitions) {\n        return \"\";\n      }\n      return prefixOptional(getAgeLabel(step.age));\n    case \"build\": {\n      const buildingText = step.buildings\n        .map((b) => {\n          const buildingName =\n            b.type === \"archeryRange\" ? \"Range\" : getBuildingLabel(b.type);\n          if (b.count > 1) {\n            return `${b.count} ${pluralize(buildingName, b.count)}`;\n          }\n          return buildingName;\n        })\n        .join(\" + \");\n      return prefixOptional(buildingText);\n    }\n    case \"custom\":\n      return prefixOptional(step.text || `Step ${index + 1}`);\n    case \"trade\": {\n      const actionText = step.action === \"sell\" ? \"Sell\" : \"Buy\";\n      const resourceName =\n        step.resource.charAt(0).toUpperCase() + step.resource.slice(1);\n      return prefixOptional(`${actionText} ${step.count} ${resourceName}`);\n    }\n    case \"trainUnit\": {\n      const unitName = getUnitLabel(step.unit);\n\n      if (step.count === \"\" || step.count === \"unlimited\") {\n        return prefixOptional(`Start Training ${pluralize(unitName)}`);\n      }\n\n      const isSingleUnit = SINGLE_UNIT_ONLY_UNITS.has(step.unit);\n      const displayCount =\n        isSingleUnit || step.count === 1 ? \"\" : `${step.count} `;\n      const unitText =\n        step.count === 1\n          ? unitName\n          : pluralize(unitName, Number(step.count));\n      return prefixOptional(`Train ${displayCount}${unitText}`.trim());\n    }\n    case \"collectGold\": {\n      const goldStep = step as CollectGoldStep;\n      return prefixOptional(convertTaskToReadableText(goldStep.task));\n    }\n    case \"decision\":\n      return prefixOptional(step.text || `Decision ${index + 1}`);\n    default: {\n      const unknownStep = step as Record<string, unknown>;\n\n      if (unknownStep.task && typeof unknownStep.task === \"string\") {\n        const taskString = unknownStep.task;\n        return prefixOptional(convertTaskToReadableText(taskString));\n      }\n\n      const resources =\n        (unknownStep.resources as {\n          food: number;\n          wood: number;\n          gold: number;\n          stone: number;\n          build: number;\n        }) || { food: 0, wood: 0, gold: 0, stone: 0, build: 0 };\n\n        if (unknownStep.type && typeof unknownStep.type === \"string\") {\n          const stepType = unknownStep.type;\n          const parsedStep = createStepFromString(stepType, resources);\n          const description = formatStepDescription(parsedStep);\n          if (description) return prefixOptional(description);\n        }\n\n      for (const key in unknownStep) {\n        const value = unknownStep[key];\n        if (\n          typeof value === \"string\" &&\n          key !== \"type\" &&\n          key !== \"task\" &&\n          value.length > 3\n        ) {\n          const directConversion = convertTaskToReadableText(value);\n          if (directConversion && directConversion !== value) {\n            return prefixOptional(directConversion);\n          }\n\n          const parsedStep = createStepFromString(value, resources);\n          const description = formatStepDescription(parsedStep);\n          if (description) return prefixOptional(description);\n        }\n      }\n\n      return prefixOptional(`Step ${index + 1}`);\n    }\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2971, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/BuildStepRenderer.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { BuildOrderStep } from \"@/types/buildFormat\";\nimport { describeBuildStep } from \"@/lib/stepDescriptions\";\n\ninterface BuildStepRendererProps {\n  step: BuildOrderStep;\n  index: number;\n  usedResources: string[];\n  currentVillagerCount?: number;\n  resourceVisibility?: Record<string, boolean>;\n}\n\nexport default function BuildStepRenderer({\n  step,\n  index,\n  usedResources,\n  currentVillagerCount = 3,\n  resourceVisibility = {},\n}: BuildStepRendererProps) {\n  const [isHovered, setIsHovered] = React.useState(false);\n  const resources = step.resources;\n  const description = describeBuildStep(step, index, currentVillagerCount);\n\n  // Don't render empty rows (like newAge steps)\n  if (!description) {\n    return null;\n  }\n\n  const displayText = step.optional ? `Optional: ${description}` : description;\n\n  return (\n    <tr\n      className={`transition-colors ${isHovered ? \"bg-muted\" : \"\"}`}\n      onMouseEnter={() => setIsHovered(true)}\n      onMouseLeave={() => setIsHovered(false)}\n    >\n      <td className=\"py-0.5 px-2 sm:px-4 text-xs sm:text-base text-foreground text-pretty whitespace-normal\">\n        {displayText}\n      </td>\n      {usedResources.map((resource) => {\n        const resourceValue = resources[resource as keyof typeof resources];\n        const shouldShowNormally = resourceVisibility[resource] && resourceValue > 0;\n        const shouldShowOnHover = isHovered && resourceValue > 0;\n        const shouldShow = shouldShowNormally || shouldShowOnHover;\n\n        return (\n          <td\n            key={resource}\n            className=\"py-0.5 px-1 sm:px-4 text-center text-xs sm:text-sm align-middle w-[1%] whitespace-nowrap min-w-[2rem] sm:min-w-[3rem] font-medium\"\n          >\n            {shouldShow ? resourceValue : \"\"}\n          </td>\n        );\n      })}\n      <td className=\"py-0.5 px-3 text-center text-sm align-middle w-[1%] whitespace-nowrap hidden sm:table-cell font-medium\">\n        {currentVillagerCount}\n      </td>\n    </tr>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;;;AAJA;;;AAce,SAAS,kBAAkB,KAMjB;QANiB,EACxC,IAAI,EACJ,KAAK,EACL,aAAa,EACb,uBAAuB,CAAC,EACxB,qBAAqB,CAAC,CAAC,EACA,GANiB;;IAOxC,MAAM,CAAC,WAAW,aAAa,GAAG,6JAAA,CAAA,UAAK,CAAC,QAAQ,CAAC;IACjD,MAAM,YAAY,KAAK,SAAS;IAChC,MAAM,cAAc,CAAA,GAAA,iIAAA,CAAA,oBAAiB,AAAD,EAAE,MAAM,OAAO;IAEnD,8CAA8C;IAC9C,IAAI,CAAC,aAAa;QAChB,OAAO;IACT;IAEA,MAAM,cAAc,KAAK,QAAQ,GAAG,AAAC,aAAwB,OAAZ,eAAgB;IAEjE,qBACE,6LAAC;QACC,WAAW,AAAC,qBAAgD,OAA5B,YAAY,aAAa;QACzD,cAAc,IAAM,aAAa;QACjC,cAAc,IAAM,aAAa;;0BAEjC,6LAAC;gBAAG,WAAU;0BACX;;;;;;YAEF,cAAc,GAAG,CAAC,CAAC;gBAClB,MAAM,gBAAgB,SAAS,CAAC,SAAmC;gBACnE,MAAM,qBAAqB,kBAAkB,CAAC,SAAS,IAAI,gBAAgB;gBAC3E,MAAM,oBAAoB,aAAa,gBAAgB;gBACvD,MAAM,aAAa,sBAAsB;gBAEzC,qBACE,6LAAC;oBAEC,WAAU;8BAET,aAAa,gBAAgB;mBAHzB;;;;;YAMX;0BACA,6LAAC;gBAAG,WAAU;0BACX;;;;;;;;;;;;AAIT;GA/CwB;KAAA","debugId":null}},
    {"offset": {"line": 3048, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/ResourceIcon.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport { getResourceImagePath } from \"@/lib/imageUtils\";\n\ninterface ResourceIconProps {\n  resource: string;\n  width?: number;\n  height?: number;\n  className?: string;\n}\n\nexport default function ResourceIcon({\n  resource,\n  width = 20,\n  height = 20,\n  className,\n}: ResourceIconProps) {\n  const imagePath = getResourceImagePath(resource);\n\n  if (!imagePath) {\n    return null;\n  }\n\n  return (\n    <Image\n      src={imagePath}\n      alt={resource}\n      width={width}\n      height={height}\n      className={`mx-auto object-contain ${className || \"\"}`}\n      style={{ width: `${width}px`, height: `${height}px` }}\n    />\n  );\n}"],"names":[],"mappings":";;;;AAGA;AACA;AAJA;;;;AAae,SAAS,aAAa,KAKjB;QALiB,EACnC,QAAQ,EACR,QAAQ,EAAE,EACV,SAAS,EAAE,EACX,SAAS,EACS,GALiB;IAMnC,MAAM,YAAY,CAAA,GAAA,2HAAA,CAAA,uBAAoB,AAAD,EAAE;IAEvC,IAAI,CAAC,WAAW;QACd,OAAO;IACT;IAEA,qBACE,6LAAC,gIAAA,CAAA,UAAK;QACJ,KAAK;QACL,KAAK;QACL,OAAO;QACP,QAAQ;QACR,WAAW,AAAC,0BAAyC,OAAhB,aAAa;QAClD,OAAO;YAAE,OAAO,AAAC,GAAQ,OAAN,OAAM;YAAK,QAAQ,AAAC,GAAS,OAAP,QAAO;QAAI;;;;;;AAG1D;KAtBwB","debugId":null}},
    {"offset": {"line": 3092, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/ValidationWarnings.tsx"],"sourcesContent":["import React from \"react\";\nimport { BuildValidationError } from \"@/lib/buildValidation\";\n\ninterface ValidationWarningsProps {\n  errors: BuildValidationError[];\n  title: string;\n}\n\nexport default function ValidationWarnings({ errors, title }: ValidationWarningsProps) {\n  if (errors.length === 0) return null;\n\n  return (\n    <div className=\"bg-background rounded-default shadow-default overflow-hidden p-6 mb-6\">\n      <div className=\"flex items-start space-x-3\">\n        <div className=\"flex-shrink-0\">\n          <svg className=\"w-6 h-6 text-cancel\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n          </svg>\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"text-lg font-semibold text-foreground mb-3\">{title}</h3>\n          <div className=\"space-y-2\">\n            {errors.map((error, index) => (\n              <p key={index} className=\"text-foreground/80 text-sm text-pretty\">\n                {error.message}\n              </p>\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;;AAQe,SAAS,mBAAmB,KAA0C;QAA1C,EAAE,MAAM,EAAE,KAAK,EAA2B,GAA1C;IACzC,IAAI,OAAO,MAAM,KAAK,GAAG,OAAO;IAEhC,qBACE,6LAAC;QAAI,WAAU;kBACb,cAAA,6LAAC;YAAI,WAAU;;8BACb,6LAAC;oBAAI,WAAU;8BACb,cAAA,6LAAC;wBAAI,WAAU;wBAAsB,MAAK;wBAAO,QAAO;wBAAe,SAAQ;kCAC7E,cAAA,6LAAC;4BAAK,eAAc;4BAAQ,gBAAe;4BAAQ,aAAa;4BAAG,GAAE;;;;;;;;;;;;;;;;8BAGzE,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAG,WAAU;sCAA8C;;;;;;sCAC5D,6LAAC;4BAAI,WAAU;sCACZ,OAAO,GAAG,CAAC,CAAC,OAAO,sBAClB,6LAAC;oCAAc,WAAU;8CACtB,MAAM,OAAO;mCADR;;;;;;;;;;;;;;;;;;;;;;;;;;;AAStB;KAxBwB","debugId":null}},
    {"offset": {"line": 3188, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/BuildDisplay.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport { Build } from \"@/types/build\";\nimport { BuildOrderStep } from \"@/types/buildFormat\";\nimport BuildStepRenderer from \"./BuildStepRenderer\";\nimport EmptyState from \"@/components/EmptyState\";\nimport ResourceIcon from \"@/components/ResourceIcon\";\nimport Image from \"next/image\";\nimport { validateBuildOrder } from \"@/lib/buildValidation\";\nimport ValidationWarnings from \"@/components/ValidationWarnings\";\n\ninterface BuildDisplayProps {\n  build: Build;\n}\n\ninterface AgeSection {\n  title: string;\n  steps: BuildOrderStep[];\n  isTransition?: boolean;\n}\n\ninterface AlternativePath {\n  decisionText?: string;\n  sections: AgeSection[];\n}\n\nexport default function BuildDisplay({ build }: BuildDisplayProps) {\n  if (!build.build || build.build.length === 0) {\n    return <EmptyState text=\"No build steps defined for this build.\" />;\n  }\n\n  // Validate the build and collect any errors/warnings\n  const validationResult = validateBuildOrder(build.build, build.civilization);\n\n  // If there are validation errors, show only the errors and don't render the build\n  if (!validationResult.isValid) {\n    return <ValidationWarnings errors={validationResult.errors} title=\"Cannot Display Build Order\" />;\n  }\n\n  const groupStepsByAge = (steps: BuildOrderStep[], startingAge?: string): AgeSection[] => {\n    const sections: AgeSection[] = [];\n    let currentSteps: BuildOrderStep[] = [];\n    let currentSectionTitle = startingAge || \"Dark Age\";\n    let isInTransition = false;\n    let transitionTitle = \"\";\n\n    steps.forEach((step) => {\n      if (step.type === \"ageUp\") {\n        // Add ageUp step to current section (research belongs to current age)\n        currentSteps.push(step);\n\n        // Save current section with the ageUp step\n        sections.push({ title: currentSectionTitle, steps: [...currentSteps] });\n        currentSteps = [];\n\n        // Start transition phase\n        transitionTitle =\n          step.age === \"feudalAge\"\n            ? \"Advance to Feudal Age\"\n            : step.age === \"castleAge\"\n              ? \"Advance to Castle Age\"\n              : \"Advance to Imperial Age\";\n        currentSectionTitle = transitionTitle;\n        isInTransition = true;\n      } else if (step.type === \"newAge\") {\n        // End transition phase, save \"Advance to [Age]\" section\n        if (isInTransition && currentSteps.length > 0) {\n          sections.push({\n            title: currentSectionTitle,\n            steps: [...currentSteps],\n            isTransition: true,\n          });\n          currentSteps = [];\n        }\n\n        // Start actual age section\n        currentSectionTitle =\n          step.age === \"feudalAge\"\n            ? \"Feudal Age\"\n            : step.age === \"castleAge\"\n              ? \"Castle Age\"\n              : \"Imperial Age\";\n        isInTransition = false;\n      } else {\n        // Regular step - add to current accumulation\n        currentSteps.push(step);\n      }\n    });\n\n    // Add any remaining steps\n    if (currentSteps.length > 0) {\n      sections.push({\n        title: currentSectionTitle,\n        steps: currentSteps,\n        isTransition: isInTransition,\n      });\n    }\n\n    return sections;\n  };\n\n  const getCurrentAge = (steps: BuildOrderStep[]): string => {\n    let currentAge = \"Dark Age\";\n\n    steps.forEach((step) => {\n      if (step.type === \"newAge\") {\n        currentAge =\n          step.age === \"feudalAge\"\n            ? \"Feudal Age\"\n            : step.age === \"castleAge\"\n              ? \"Castle Age\"\n              : \"Imperial Age\";\n      }\n    });\n\n    return currentAge;\n  };\n\n  const groupStepsByAlternatives = (\n    steps: BuildOrderStep[]\n  ): AlternativePath[] => {\n    const alternatives: AlternativePath[] = [];\n    let currentSteps: BuildOrderStep[] = [];\n    let currentDecisionText: string | undefined = undefined;\n    let stepsBeforeFirstDecision: BuildOrderStep[] = [];\n\n    steps.forEach((step) => {\n      if (step.type === \"decision\") {\n        // If this is the first decision, save steps before it\n        if (alternatives.length === 0 && currentSteps.length > 0) {\n          stepsBeforeFirstDecision = [...currentSteps];\n        }\n\n        // If we have accumulated steps, create an alternative from them\n        if (currentSteps.length > 0) {\n          const currentAge = getCurrentAge(stepsBeforeFirstDecision);\n          const sections = groupStepsByAge(currentSteps, currentAge);\n          alternatives.push({\n            decisionText: currentDecisionText,\n            sections: sections,\n          });\n          currentSteps = [];\n        }\n\n        // Set the decision text for the next alternative\n        currentDecisionText = step.text;\n      } else {\n        // Accumulate non-decision steps\n        currentSteps.push(step);\n      }\n    });\n\n    // Add any remaining steps as the final alternative\n    if (currentSteps.length > 0) {\n      const currentAge = getCurrentAge(stepsBeforeFirstDecision);\n      const sections = groupStepsByAge(currentSteps, currentAge);\n      alternatives.push({\n        decisionText: currentDecisionText,\n        sections: sections,\n      });\n    }\n\n    return alternatives;\n  };\n\n  const getUsedResources = (steps: BuildOrderStep[]): string[] => {\n    const allResourceTypes = [\"food\", \"wood\", \"gold\", \"stone\", \"build\"];\n    const usedResources = new Set<string>();\n\n    steps.forEach((step) => {\n      allResourceTypes.forEach((resourceType) => {\n        if (step.resources[resourceType as keyof typeof step.resources] > 0) {\n          usedResources.add(resourceType);\n        }\n      });\n    });\n\n    // Return in consistent order\n    return allResourceTypes.filter((resource) => usedResources.has(resource));\n  };\n\n  // Check if build has decision steps\n  const hasDecisions = build.build.some((step) => step.type === \"decision\");\n\n  const alternatives = hasDecisions\n    ? groupStepsByAlternatives(build.build)\n    : null;\n  const ageSections = hasDecisions ? null : groupStepsByAge(build.build);\n  const usedResources = getUsedResources(build.build);\n\n  // Check which specific resources changed compared to previous step\n  const getResourceVisibility = (\n    current: BuildOrderStep,\n    previous: BuildOrderStep | null\n  ): Record<string, boolean> => {\n    if (!previous || !current.resources || !previous.resources) {\n      // Show all resources for first step\n      return {\n        food: true,\n        wood: true,\n        gold: true,\n        stone: true,\n        build: true,\n      };\n    }\n\n    return {\n      food: current.resources.food !== previous.resources.food,\n      wood: current.resources.wood !== previous.resources.wood,\n      gold: current.resources.gold !== previous.resources.gold,\n      stone: current.resources.stone !== previous.resources.stone,\n      build: current.resources.build !== previous.resources.build,\n    };\n  };\n\n  // Calculate villager counts for each step\n  const calculateVillagerCount = (\n    steps: BuildOrderStep[],\n    stepIndex: number\n  ): number => {\n    if (stepIndex < 0) return 3;\n\n    const currentStep = steps[stepIndex];\n    if (!currentStep || !currentStep.resources) return 3;\n\n    // Sum up all villagers from resources (food, wood, gold, stone, build)\n    const totalVillagers =\n      currentStep.resources.food +\n      currentStep.resources.wood +\n      currentStep.resources.gold +\n      currentStep.resources.stone +\n      currentStep.resources.build;\n\n    return totalVillagers;\n  };\n\n  // Render function for age sections (each section becomes its own table)\n  const renderAgeSection = (\n    section: AgeSection,\n    sectionIndex: number,\n    globalStepIndex: { current: number },\n    previousStep: { current: BuildOrderStep | null }\n  ) => (\n    <div key={sectionIndex} className=\"bg-background rounded-default shadow-default overflow-hidden overflow-x-auto\">\n      <table className=\"w-full table-auto\">\n        <thead>\n          <tr className=\"bg-muted\">\n            <th className=\"py-3 px-4 sm:px-6 sm:py-4 text-left text-sm font-semibold text-foreground rounded-tl-default\">\n              <div className=\"flex items-center space-x-2\">\n                {section.isTransition ? (\n                  // For \"Advance to [Age]\" sections, show previous age  next age\n                  <div className=\"flex items-center space-x-1\">\n                    {section.title.includes(\"Feudal\") && (\n                      <>\n                        <Image\n                          src=\"/images/Ages/dark_age_de.png\"\n                          alt=\"Dark Age\"\n                          width={24}\n                          height={24}\n                        />\n                        <span className=\"text-foreground text-sm font-bold\"></span>\n                        <Image\n                          src=\"/images/Ages/feudal_age_de.png\"\n                          alt=\"Feudal Age\"\n                          width={24}\n                          height={24}\n                        />\n                      </>\n                    )}\n                    {section.title.includes(\"Castle\") && (\n                      <>\n                        <Image\n                          src=\"/images/Ages/feudal_age_de.png\"\n                          alt=\"Feudal Age\"\n                          width={24}\n                          height={24}\n                        />\n                        <span className=\"text-foreground text-sm font-bold\"></span>\n                        <Image\n                          src=\"/images/Ages/castle_age_de.png\"\n                          alt=\"Castle Age\"\n                          width={24}\n                          height={24}\n                        />\n                      </>\n                    )}\n                    {section.title.includes(\"Imperial\") && (\n                      <>\n                        <Image\n                          src=\"/images/Ages/castle_age_de.png\"\n                          alt=\"Castle Age\"\n                          width={24}\n                          height={24}\n                        />\n                        <span className=\"text-foreground text-sm font-bold\"></span>\n                        <Image\n                          src=\"/images/Ages/imperial_age_de.png\"\n                          alt=\"Imperial Age\"\n                          width={24}\n                          height={24}\n                        />\n                      </>\n                    )}\n                  </div>\n                ) : (\n                  // For regular age sections, show single age icon\n                  <>\n                    {section.title.includes(\"Dark\") && (\n                      <Image\n                        src=\"/images/Ages/dark_age_de.png\"\n                        alt=\"Dark Age\"\n                        width={24}\n                        height={24}\n                      />\n                    )}\n                    {section.title.includes(\"Feudal\") && (\n                      <Image\n                        src=\"/images/Ages/feudal_age_de.png\"\n                        alt=\"Feudal Age\"\n                        width={24}\n                        height={24}\n                      />\n                    )}\n                    {section.title.includes(\"Castle\") && (\n                      <Image\n                        src=\"/images/Ages/castle_age_de.png\"\n                        alt=\"Castle Age\"\n                        width={24}\n                        height={24}\n                      />\n                    )}\n                    {section.title.includes(\"Imperial\") && (\n                      <Image\n                        src=\"/images/Ages/imperial_age_de.png\"\n                        alt=\"Imperial Age\"\n                        width={24}\n                        height={24}\n                      />\n                    )}\n                  </>\n                )}\n                <span className=\"font-semibold text-foreground text-pretty hidden sm:inline\">\n                  {section.title}\n                </span>\n              </div>\n            </th>\n            {usedResources.map((resource) => (\n              <th\n                key={resource}\n                className=\"py-3 px-1 sm:px-4 text-center align-middle w-[1%] whitespace-nowrap min-w-[2rem] sm:min-w-[3rem]\"\n              >\n                <div className=\"w-4 h-4 sm:w-6 sm:h-6 mx-auto\">\n                  <ResourceIcon resource={resource} width={16} height={16} />\n                </div>\n              </th>\n            ))}\n            <th className=\"py-3 px-3 text-center align-middle w-[1%] whitespace-nowrap rounded-tr-default hidden sm:table-cell\">\n              <div className=\"flex items-center justify-center\">\n                <Image\n                  src=\"/images/Res/Aoe2de_villagers.png\"\n                  alt=\"Total Villagers\"\n                  width={16}\n                  height={16}\n                />\n              </div>\n            </th>\n          </tr>\n        </thead>\n        <tbody>\n          {section.steps.map((step, stepIndex) => {\n            const currentVillagerCount = calculateVillagerCount(\n              build.build!,\n              globalStepIndex.current\n            );\n            const resourceVisibility = getResourceVisibility(\n              step,\n              previousStep.current\n            );\n            const component = (\n              <BuildStepRenderer\n                key={`${sectionIndex}-${stepIndex}`}\n                step={step}\n                index={stepIndex}\n                usedResources={usedResources}\n                currentVillagerCount={currentVillagerCount}\n                resourceVisibility={resourceVisibility}\n              />\n            );\n            previousStep.current = step;\n            globalStepIndex.current++;\n            return component;\n          })}\n        </tbody>\n      </table>\n    </div>\n  );\n\n  if (hasDecisions && alternatives) {\n    // Render alternative paths\n    return (\n      <div className=\"space-y-6\">\n        {alternatives.map((alternative, altIndex) => (\n          <div key={altIndex}>\n            {/* Decision Header */}\n            {alternative.decisionText && (\n              <div className=\"bg-primary text-foreground px-4 py-3 font-bold text-lg text-center mb-2\">\n                {alternative.decisionText}\n              </div>\n            )}\n\n            {/* Alternative Content */}\n            <div className=\"space-y-6\">\n              {(() => {\n                const globalStepIndex = { current: 0 };\n                const previousStep = { current: null as BuildOrderStep | null };\n                return alternative.sections.map((section, sectionIndex) =>\n                  renderAgeSection(\n                    section,\n                    sectionIndex,\n                    globalStepIndex,\n                    previousStep\n                  )\n                );\n              })()}\n            </div>\n          </div>\n        ))}\n      </div>\n    );\n  } else {\n    // Render single path (no decisions)\n    return (\n      <div className=\"space-y-6\">\n        {(() => {\n          const globalStepIndex = { current: 0 };\n          const previousStep = { current: null as BuildOrderStep | null };\n          return ageSections!.map((section, sectionIndex) =>\n            renderAgeSection(\n              section,\n              sectionIndex,\n              globalStepIndex,\n              previousStep\n            )\n          );\n        })()}\n      </div>\n    );\n  }\n}"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 3735, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/AlternativeCheckpointDisplay.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport { AlternativeCheckpointPath, Checkpoint, VillagerDistribution } from \"@/types/build\";\nimport ResourceIcon from \"@/components/ResourceIcon\";\nimport { getAgeImagePath } from \"@/lib/imageUtils\";\n\ninterface AlternativeCheckpointDisplayProps {\n  alternatives: AlternativeCheckpointPath[];\n}\n\n// Resource Component\nconst ResourceItem = ({\n  resource,\n  count,\n  note,\n  difference,\n}: {\n  resource: string;\n  count: number;\n  note?: string;\n  difference?: number;\n}) => {\n  return (\n    <div className=\"flex items-center space-x-2 sm:space-x-3\">\n      <div className=\"bg-muted px-2 py-1 rounded-default min-w-14 sm:min-w-16 flex items-center justify-center space-x-1\">\n        <ResourceIcon resource={resource} width={20} height={20} />\n        <span className=\"text-foreground font-medium text-xs sm:text-sm\">\n          {count}\n        </span>\n      </div>\n      {difference !== undefined && difference !== 0 && (\n        <span\n          className={`text-xs font-medium ${\n            difference > 0 ? \"text-foreground\" : \"text-cancel\"\n          }`}\n        >\n          {difference > 0 ? \"+\" : \"\"}\n          {difference}\n        </span>\n      )}\n      {note && (\n        <span className=\"text-foreground text-xs sm:text-base\">{note}</span>\n      )}\n    </div>\n  );\n};\n\n// Text Component\nconst TextNote = ({ text }: { text: string }) => (\n  <li className=\"text-foreground text-xs sm:text-base text-pretty\">{text}</li>\n);\n\n// Phase Component\nconst BuildPhase = ({\n  checkpoint,\n  index,\n  previousCheckpoint,\n}: {\n  checkpoint: Checkpoint;\n  index: number;\n  previousCheckpoint?: Checkpoint;\n}) => {\n  const resources = [\n    \"food\",\n    \"wood\",\n    \"gold\",\n    \"stone\",\n    \"builders\",\n    \"fishingShips\",\n  ];\n\n  const getResourceNote = (resource: string): string | undefined => {\n    const noteKey = `${resource}Note` as keyof VillagerDistribution;\n    const note = checkpoint.villagers[noteKey];\n    return typeof note === \"string\" ? note : undefined;\n  };\n\n  const hasResourceChanges = (): boolean => {\n    if (!previousCheckpoint) return true; // Always show first checkpoint resources\n    return resources.some((resource) => {\n      const current =\n        (checkpoint.villagers[\n          resource as keyof typeof checkpoint.villagers\n        ] as number) || 0;\n      const previous =\n        (previousCheckpoint.villagers[\n          resource as keyof typeof previousCheckpoint.villagers\n        ] as number) || 0;\n      return current !== previous;\n    });\n  };\n\n  const hasResourceNotes = (): boolean => {\n    return resources.some((resource) => {\n      const note = getResourceNote(resource);\n      return note && note.trim() !== \"\";\n    });\n  };\n\n  const shouldShowResources = hasResourceChanges() || hasResourceNotes();\n  const hasGenericNotes =\n    checkpoint.genericNotes && checkpoint.genericNotes.length > 0;\n  const shouldShowCheckpoint = shouldShowResources || hasGenericNotes;\n\n  // Don't render checkpoint if there's nothing to show\n  if (!shouldShowCheckpoint) {\n    return null;\n  }\n\n  const getResourceDifference = (resource: string): number | undefined => {\n    if (!previousCheckpoint) return undefined;\n    const currentCount = checkpoint.villagers[\n      resource as keyof typeof checkpoint.villagers\n    ] as number;\n    const previousCount = previousCheckpoint.villagers[\n      resource as keyof typeof previousCheckpoint.villagers\n    ] as number;\n    return currentCount - previousCount;\n  };\n\n  const getPhaseTitle = (type?: string, index?: number): string => {\n    if (!type) return `Step ${(index || 0) + 1}`;\n\n    const titleMap: { [key: string]: string } = {\n      dark_age: \"Dark Age\",\n      feudal_age: \"Feudal Age\",\n      castle_age: \"Castle Age\",\n      imperial_age: \"Imperial Age\",\n      dark_age_to_feudal_age: \"Advance to Feudal Age\",\n      feudal_age_to_castle_age: \"Advance to Castle Age\",\n      castle_age_to_imperial_age: \"Advance to Imperial Age\",\n    };\n\n    return titleMap[type] || `Step ${(index || 0) + 1}`;\n  };\n\n  const renderAgeIcon = (type?: string) => {\n    if (!type) return null;\n\n    if (type.includes(\"_to_\")) {\n      const [startAge, endAge] = type.split(\"_to_\");\n      const startIconSrc = getAgeImagePath(startAge);\n      const endIconSrc = getAgeImagePath(endAge);\n\n      if (!startIconSrc || !endIconSrc) return null;\n\n      return (\n        <div className=\"flex items-center space-x-1\">\n          <Image src={startIconSrc} alt={startAge} width={24} height={24} />\n          <div className=\"text-foreground text-sm font-bold\"></div>\n          <Image src={endIconSrc} alt={endAge} width={24} height={24} />\n        </div>\n      );\n    }\n\n    const iconSrc = getAgeImagePath(type);\n    if (!iconSrc) return null;\n\n    return <Image src={iconSrc} alt={type} width={24} height={24} />;\n  };\n\n  return (\n    <div className=\"bg-background rounded-default shadow-default overflow-hidden mb-4 sm:mb-6\">\n      {/* Phase Header */}\n      <div className=\"bg-muted px-4 py-3 sm:px-6 sm:py-4 flex justify-between items-center\">\n        <div className=\"flex items-center space-x-2 min-w-0 flex-1\">\n          {checkpoint.type && (\n            <div className=\"flex items-center space-x-1 sm:space-x-2 flex-shrink-0\">\n              {renderAgeIcon(checkpoint.type)}\n            </div>\n          )}\n          <h3 className=\"text-sm font-semibold text-foreground text-pretty truncate\">\n            {getPhaseTitle(checkpoint.type, index)}\n          </h3>\n        </div>\n      </div>\n\n      {/* Phase Content */}\n      <div className=\"p-4 sm:p-6\">\n        {/* Resources */}\n        {shouldShowResources && (\n          <div className=\"space-y-2 sm:space-y-3\">\n            {resources.map((resource) => {\n              const count = checkpoint.villagers[\n                resource as keyof typeof checkpoint.villagers\n              ] as number;\n              if (count > 0) {\n                const note = getResourceNote(resource);\n                const difference = getResourceDifference(resource);\n                return (\n                  <ResourceItem\n                    key={resource}\n                    resource={resource}\n                    count={count}\n                    note={note}\n                    difference={difference}\n                  />\n                );\n              }\n              return null;\n            })}\n          </div>\n        )}\n\n        {/* Generic Notes */}\n        {hasGenericNotes && (\n          <div className={shouldShowResources ? \"mt-4 sm:mt-6\" : \"\"}>\n            {shouldShowResources && (\n              <div className=\"w-full h-px bg-muted mb-3 sm:mb-4\"></div>\n            )}\n            <ul className=\"space-y-1 sm:space-y-2 list-disc list-inside\">\n              {checkpoint.genericNotes.map((note, noteIndex) => (\n                <TextNote key={noteIndex} text={note} />\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default function AlternativeCheckpointDisplay({ alternatives }: AlternativeCheckpointDisplayProps) {\n  // Get common checkpoints from the first alternative (they're the same for all)\n  const commonCheckpoints = alternatives.length > 0 && alternatives[0].commonCheckpoints \n    ? alternatives[0].commonCheckpoints \n    : [];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Render common checkpoints once at the top */}\n      {commonCheckpoints.length > 0 && (\n        <div className=\"bg-background rounded-default overflow-hidden\">\n          <div className=\"space-y-4 sm:space-y-6 p-4 sm:p-6\">\n            {commonCheckpoints.map((checkpoint, index) => (\n              <BuildPhase\n                key={index}\n                checkpoint={checkpoint}\n                index={index}\n                previousCheckpoint={index > 0 ? commonCheckpoints[index - 1] : undefined}\n              />\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Render alternative-specific checkpoints */}\n      {alternatives.map((alternative, altIndex) => (\n        <div key={altIndex} className=\"bg-background rounded-default overflow-hidden\">\n          {/* Decision Header */}\n          {alternative.decisionText && (\n            <div className=\"bg-primary text-foreground px-4 py-3 font-bold text-lg text-center\">\n              {alternative.decisionText}\n            </div>\n          )}\n          \n          {/* Alternative Content */}\n          <div className=\"space-y-4 sm:space-y-6 p-4 sm:p-6\">\n            {alternative.checkpoints.map((checkpoint, index) => {\n              // For the first alternative checkpoint, use the last common checkpoint as context\n              // For subsequent checkpoints, use the previous checkpoint within the alternative\n              const getPreviousCheckpoint = () => {\n                if (index > 0) {\n                  return alternative.checkpoints[index - 1];\n                }\n                // For first checkpoint, use last common checkpoint if available\n                return commonCheckpoints.length > 0 ? commonCheckpoints[commonCheckpoints.length - 1] : undefined;\n              };\n\n              return (\n                <BuildPhase\n                  key={index}\n                  checkpoint={checkpoint}\n                  index={index}\n                  previousCheckpoint={getPreviousCheckpoint()}\n                />\n              );\n            })}\n          </div>\n        </div>\n      ))}\n    </div>\n  );\n}"],"names":[],"mappings":";;;;AAGA;AAEA;AACA;AANA;;;;;AAYA,qBAAqB;AACrB,MAAM,eAAe;QAAC,EACpB,QAAQ,EACR,KAAK,EACL,IAAI,EACJ,UAAU,EAMX;IACC,qBACE,6LAAC;QAAI,WAAU;;0BACb,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,qIAAA,CAAA,UAAY;wBAAC,UAAU;wBAAU,OAAO;wBAAI,QAAQ;;;;;;kCACrD,6LAAC;wBAAK,WAAU;kCACb;;;;;;;;;;;;YAGJ,eAAe,aAAa,eAAe,mBAC1C,6LAAC;gBACC,WAAW,AAAC,uBAEX,OADC,aAAa,IAAI,oBAAoB;;oBAGtC,aAAa,IAAI,MAAM;oBACvB;;;;;;;YAGJ,sBACC,6LAAC;gBAAK,WAAU;0BAAwC;;;;;;;;;;;;AAIhE;KAlCM;AAoCN,iBAAiB;AACjB,MAAM,WAAW;QAAC,EAAE,IAAI,EAAoB;yBAC1C,6LAAC;QAAG,WAAU;kBAAoD;;;;;;;MAD9D;AAIN,kBAAkB;AAClB,MAAM,aAAa;QAAC,EAClB,UAAU,EACV,KAAK,EACL,kBAAkB,EAKnB;IACC,MAAM,YAAY;QAChB;QACA;QACA;QACA;QACA;QACA;KACD;IAED,MAAM,kBAAkB,CAAC;QACvB,MAAM,UAAU,AAAC,GAAW,OAAT,UAAS;QAC5B,MAAM,OAAO,WAAW,SAAS,CAAC,QAAQ;QAC1C,OAAO,OAAO,SAAS,WAAW,OAAO;IAC3C;IAEA,MAAM,qBAAqB;QACzB,IAAI,CAAC,oBAAoB,OAAO,MAAM,yCAAyC;QAC/E,OAAO,UAAU,IAAI,CAAC,CAAC;YACrB,MAAM,UACJ,AAAC,WAAW,SAAS,CACnB,SACD,IAAe;YAClB,MAAM,WACJ,AAAC,mBAAmB,SAAS,CAC3B,SACD,IAAe;YAClB,OAAO,YAAY;QACrB;IACF;IAEA,MAAM,mBAAmB;QACvB,OAAO,UAAU,IAAI,CAAC,CAAC;YACrB,MAAM,OAAO,gBAAgB;YAC7B,OAAO,QAAQ,KAAK,IAAI,OAAO;QACjC;IACF;IAEA,MAAM,sBAAsB,wBAAwB;IACpD,MAAM,kBACJ,WAAW,YAAY,IAAI,WAAW,YAAY,CAAC,MAAM,GAAG;IAC9D,MAAM,uBAAuB,uBAAuB;IAEpD,qDAAqD;IACrD,IAAI,CAAC,sBAAsB;QACzB,OAAO;IACT;IAEA,MAAM,wBAAwB,CAAC;QAC7B,IAAI,CAAC,oBAAoB,OAAO;QAChC,MAAM,eAAe,WAAW,SAAS,CACvC,SACD;QACD,MAAM,gBAAgB,mBAAmB,SAAS,CAChD,SACD;QACD,OAAO,eAAe;IACxB;IAEA,MAAM,gBAAgB,CAAC,MAAe;QACpC,IAAI,CAAC,MAAM,OAAO,AAAC,QAAwB,OAAjB,CAAC,SAAS,CAAC,IAAI;QAEzC,MAAM,WAAsC;YAC1C,UAAU;YACV,YAAY;YACZ,YAAY;YACZ,cAAc;YACd,wBAAwB;YACxB,0BAA0B;YAC1B,4BAA4B;QAC9B;QAEA,OAAO,QAAQ,CAAC,KAAK,IAAI,AAAC,QAAwB,OAAjB,CAAC,SAAS,CAAC,IAAI;IAClD;IAEA,MAAM,gBAAgB,CAAC;QACrB,IAAI,CAAC,MAAM,OAAO;QAElB,IAAI,KAAK,QAAQ,CAAC,SAAS;YACzB,MAAM,CAAC,UAAU,OAAO,GAAG,KAAK,KAAK,CAAC;YACtC,MAAM,eAAe,CAAA,GAAA,2HAAA,CAAA,kBAAe,AAAD,EAAE;YACrC,MAAM,aAAa,CAAA,GAAA,2HAAA,CAAA,kBAAe,AAAD,EAAE;YAEnC,IAAI,CAAC,gBAAgB,CAAC,YAAY,OAAO;YAEzC,qBACE,6LAAC;gBAAI,WAAU;;kCACb,6LAAC,gIAAA,CAAA,UAAK;wBAAC,KAAK;wBAAc,KAAK;wBAAU,OAAO;wBAAI,QAAQ;;;;;;kCAC5D,6LAAC;wBAAI,WAAU;kCAAoC;;;;;;kCACnD,6LAAC,gIAAA,CAAA,UAAK;wBAAC,KAAK;wBAAY,KAAK;wBAAQ,OAAO;wBAAI,QAAQ;;;;;;;;;;;;QAG9D;QAEA,MAAM,UAAU,CAAA,GAAA,2HAAA,CAAA,kBAAe,AAAD,EAAE;QAChC,IAAI,CAAC,SAAS,OAAO;QAErB,qBAAO,6LAAC,gIAAA,CAAA,UAAK;YAAC,KAAK;YAAS,KAAK;YAAM,OAAO;YAAI,QAAQ;;;;;;IAC5D;IAEA,qBACE,6LAAC;QAAI,WAAU;;0BAEb,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;wBACZ,WAAW,IAAI,kBACd,6LAAC;4BAAI,WAAU;sCACZ,cAAc,WAAW,IAAI;;;;;;sCAGlC,6LAAC;4BAAG,WAAU;sCACX,cAAc,WAAW,IAAI,EAAE;;;;;;;;;;;;;;;;;0BAMtC,6LAAC;gBAAI,WAAU;;oBAEZ,qCACC,6LAAC;wBAAI,WAAU;kCACZ,UAAU,GAAG,CAAC,CAAC;4BACd,MAAM,QAAQ,WAAW,SAAS,CAChC,SACD;4BACD,IAAI,QAAQ,GAAG;gCACb,MAAM,OAAO,gBAAgB;gCAC7B,MAAM,aAAa,sBAAsB;gCACzC,qBACE,6LAAC;oCAEC,UAAU;oCACV,OAAO;oCACP,MAAM;oCACN,YAAY;mCAJP;;;;;4BAOX;4BACA,OAAO;wBACT;;;;;;oBAKH,iCACC,6LAAC;wBAAI,WAAW,sBAAsB,iBAAiB;;4BACpD,qCACC,6LAAC;gCAAI,WAAU;;;;;;0CAEjB,6LAAC;gCAAG,WAAU;0CACX,WAAW,YAAY,CAAC,GAAG,CAAC,CAAC,MAAM,0BAClC,6LAAC;wCAAyB,MAAM;uCAAjB;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAQ/B;MAvKM;AAyKS,SAAS,6BAA6B,KAAmD;QAAnD,EAAE,YAAY,EAAqC,GAAnD;IACnD,+EAA+E;IAC/E,MAAM,oBAAoB,aAAa,MAAM,GAAG,KAAK,YAAY,CAAC,EAAE,CAAC,iBAAiB,GAClF,YAAY,CAAC,EAAE,CAAC,iBAAiB,GACjC,EAAE;IAEN,qBACE,6LAAC;QAAI,WAAU;;YAEZ,kBAAkB,MAAM,GAAG,mBAC1B,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;8BACZ,kBAAkB,GAAG,CAAC,CAAC,YAAY,sBAClC,6LAAC;4BAEC,YAAY;4BACZ,OAAO;4BACP,oBAAoB,QAAQ,IAAI,iBAAiB,CAAC,QAAQ,EAAE,GAAG;2BAH1D;;;;;;;;;;;;;;;YAWd,aAAa,GAAG,CAAC,CAAC,aAAa,yBAC9B,6LAAC;oBAAmB,WAAU;;wBAE3B,YAAY,YAAY,kBACvB,6LAAC;4BAAI,WAAU;sCACZ,YAAY,YAAY;;;;;;sCAK7B,6LAAC;4BAAI,WAAU;sCACZ,YAAY,WAAW,CAAC,GAAG,CAAC,CAAC,YAAY;gCACxC,kFAAkF;gCAClF,iFAAiF;gCACjF,MAAM,wBAAwB;oCAC5B,IAAI,QAAQ,GAAG;wCACb,OAAO,YAAY,WAAW,CAAC,QAAQ,EAAE;oCAC3C;oCACA,gEAAgE;oCAChE,OAAO,kBAAkB,MAAM,GAAG,IAAI,iBAAiB,CAAC,kBAAkB,MAAM,GAAG,EAAE,GAAG;gCAC1F;gCAEA,qBACE,6LAAC;oCAEC,YAAY;oCACZ,OAAO;oCACP,oBAAoB;mCAHf;;;;;4BAMX;;;;;;;mBA7BM;;;;;;;;;;;AAmClB;MA7DwB","debugId":null}},
    {"offset": {"line": 4136, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/lib/buildConverter.ts"],"sourcesContent":["import { BuildOrderStep } from \"@/types/buildFormat\";\nimport {\n  Checkpoint,\n  VillagerDistribution,\n  AlternativeCheckpointPath,\n} from \"@/types/build\";\nimport { getTechnologyLabel, getUnitLabel } from \"@/lib/gameConstants\";\nimport { convertTaskToReadableText } from \"@/lib/stepParser\";\nimport { pluralize } from \"@/lib/pluralization\";\nimport { validateAndThrow } from \"@/lib/buildValidation\";\nimport { SINGLE_UNIT_ONLY_UNITS } from \"@/lib/specialUnits\";\nimport { toTitleCaseLabel } from \"@/lib/text\";\n\ntype AgeType = \"dark_age\" | \"feudal_age\" | \"castle_age\" | \"imperial_age\";\ntype TransitionType =\n  | \"dark_age_to_feudal_age\"\n  | \"feudal_age_to_castle_age\"\n  | \"castle_age_to_imperial_age\";\ntype CheckpointOption = AgeType | TransitionType;\n\ntype FoodSourceKey = \"deer\" | \"fox\" | \"chicken\" | \"shorefish\";\n\nconst STANDARD_OPENING_FOOD_VILLAGERS = 6;\n\ninterface ChronologicalAction {\n  stepIndex: number;\n  type: 'building' | 'research' | 'unit' | 'note';\n  content: string;\n  optional?: boolean;\n  buildingType?: string;\n  buildingCount?: number;\n}\n\ninterface FoodActionCounters {\n  pushDeer: number;\n  pushDeerOptional: boolean;\n  takeAssignments: Record<FoodSourceKey, number>;\n  takeAssignmentsOptional: Record<FoodSourceKey, boolean>;\n}\n\nconst FOOD_SOURCE_LABELS: Record<\n  FoodSourceKey,\n  { singular: string; plural: string }\n> = {\n  deer: { singular: \"Deer\", plural: \"Deer\" },\n  fox: { singular: \"Fox\", plural: \"Foxes\" },\n  chicken: { singular: \"Chicken\", plural: \"Chickens\" },\n  shorefish: { singular: \"Shore Fish\", plural: \"Shore Fish\" },\n};\n\nfunction createEmptyFoodActions(): FoodActionCounters {\n  return {\n    pushDeer: 0,\n    pushDeerOptional: false,\n    takeAssignments: {\n      deer: 0,\n      fox: 0,\n      chicken: 0,\n      shorefish: 0,\n    },\n    takeAssignmentsOptional: {\n      deer: false,\n      fox: false,\n      chicken: false,\n      shorefish: false,\n    },\n  };\n}\n\nfunction normalizeFoodSource(value: unknown): FoodSourceKey | null {\n  if (typeof value !== \"string\") {\n    return null;\n  }\n\n  const normalized = value.toLowerCase().replace(/[^a-z]/g, \"\");\n\n  switch (normalized) {\n    case \"deer\":\n      return \"deer\";\n    case \"fox\":\n      return \"fox\";\n    case \"chicken\":\n      return \"chicken\";\n    case \"shorefish\":\n      return \"shorefish\";\n    default:\n      return null;\n  }\n}\n\nfunction parseCount(value: unknown): number {\n  if (typeof value === \"number\") {\n    return Number.isFinite(value) ? value : 0;\n  }\n\n  if (typeof value === \"string\") {\n    const parsed = parseInt(value, 10);\n    return Number.isNaN(parsed) ? 0 : parsed;\n  }\n\n  return 0;\n}\n\nfunction extractPositiveCount(\n  value: unknown,\n  defaultValue = 0\n): number {\n  const parsed = parseCount(value);\n  if (parsed > 0) {\n    return parsed;\n  }\n  return defaultValue;\n}\n\nfunction formatPushSegment(count: number): string {\n  const normalized = Math.max(1, Math.floor(count) || 1);\n  return `Push ${normalized} Deer`;\n}\n\nfunction formatTakeSegment(\n  source: FoodSourceKey,\n  count: number\n): string {\n  const labels = FOOD_SOURCE_LABELS[source];\n  const normalizedCount = Math.max(1, Math.floor(count) || 1);\n  const villagerLabel = normalizedCount === 1 ? \"Villager\" : \"Villagers\";\n  const resourceLabel =\n    normalizedCount === 1 ? labels.singular : labels.plural;\n  return `Take ${resourceLabel} with ${normalizedCount} ${villagerLabel}`;\n}\n\nfunction formatOpeningFoodNote(\n  villagerCount: number,\n  expectedCount: number = STANDARD_OPENING_FOOD_VILLAGERS\n): string | undefined {\n  if (villagerCount < expectedCount) {\n    return toTitleCaseLabel(`Only ${villagerCount} villagers on food initially`);\n  }\n  if (villagerCount > expectedCount) {\n    return toTitleCaseLabel(`Put ${villagerCount} villagers on food initially`);\n  }\n  return undefined;\n}\n\ninterface ConversionState {\n  currentCheckpointType: CheckpointOption;\n  chronologicalActions: ChronologicalAction[];\n  lastCheckpointCreated: CheckpointOption | null;\n  dark_ageLumberCampCount: number;\n  currentStepIndex: number;\n  currentCheckpointHasMill: boolean;\n  hasEverBuiltMill: boolean;\n  firstBarracksStepIndex: number | null;\n  firstMillStepIndex: number | null;\n  hasEverBuiltBarracks: boolean;\n}\n\nfunction createEmptyVillagerDistribution(): VillagerDistribution {\n  return {\n    food: 0,\n    wood: 0,\n    gold: 0,\n    stone: 0,\n    builders: 0,\n    fishingShips: 0,\n  };\n}\n\nfunction mapAgeToTransitionType(targetAge: string): TransitionType {\n  const normalizedAge = targetAge\n    .replace(/([A-Z])/g, \"_$1\")\n    .toLowerCase()\n    .replace(/^_/, \"\");\n\n  switch (normalizedAge) {\n    case \"castle_age\":\n      return \"feudal_age_to_castle_age\";\n    case \"imperial_age\":\n      return \"castle_age_to_imperial_age\";\n    default:\n      return \"dark_age_to_feudal_age\";\n  }\n}\n\nfunction updateVillagersFromResources(\n  villagers: VillagerDistribution,\n  resources: {\n    food: number;\n    wood: number;\n    gold: number;\n    stone: number;\n    build: number;\n  },\n  foodNote?: string,\n  woodNote?: string\n): VillagerDistribution {\n  return {\n    food: resources.food,\n    wood: resources.wood,\n    gold: resources.gold,\n    stone: resources.stone,\n    builders: resources.build,\n    fishingShips: 0, // Don't track fishing ships separately yet\n    foodNote: foodNote,\n    woodNote: woodNote,\n  };\n}\n\nfunction isFarmSeedingStep(step: BuildOrderStep): boolean {\n  const stepData = step as unknown as Record<string, unknown>;\n\n  // Check for moveVillagers with to: 'farm'/'farms'\n  if (step.type === \"moveVillagers\") {\n    if (typeof stepData.to !== \"string\") return false;\n    const destination = stepData.to.toLowerCase();\n    return destination === \"farm\" || destination === \"farms\";\n  }\n\n  // Check for newVillagers with task: 'farm'/'farms'\n  if (step.type === \"newVillagers\") {\n    if (typeof stepData.task !== \"string\") return false;\n    const task = stepData.task.toLowerCase();\n    return task === \"farm\" || task === \"farms\";\n  }\n\n  return false;\n}\n\nfunction getFarmCountFromStep(step: BuildOrderStep): number {\n  if (!isFarmSeedingStep(step)) return 0;\n  const stepData = step as unknown as Record<string, unknown>;\n  return typeof stepData.count === \"number\" ? stepData.count : 0;\n}\n\nfunction isWoodAssignmentStep(step: BuildOrderStep): boolean {\n  const stepData = step as unknown as Record<string, unknown>;\n\n  // Check for moveVillagers with to: 'wood'\n  if (step.type === \"moveVillagers\") {\n    if (typeof stepData.to !== \"string\") return false;\n    const destination = stepData.to.toLowerCase();\n    return destination === \"wood\";\n  }\n\n  // Check for newVillagers with task: 'wood'\n  if (step.type === \"newVillagers\") {\n    if (typeof stepData.task !== \"string\") return false;\n    const task = stepData.task.toLowerCase();\n    return task === \"wood\";\n  }\n\n  return false;\n}\n\nfunction getWoodCountFromStep(step: BuildOrderStep): number {\n  if (!isWoodAssignmentStep(step)) return 0;\n  const stepData = step as unknown as Record<string, unknown>;\n  return typeof stepData.count === \"number\" ? stepData.count : 0;\n}\n\nfunction countBuildingTypeFromStep(\n  step: BuildOrderStep,\n  buildingType: string\n): number {\n  let count = 0;\n\n  if (step.type === \"build\" && step.buildings) {\n    step.buildings.forEach((building) => {\n      if (building.type === buildingType) {\n        count += building.count || 1;\n      }\n    });\n  } else if (step.type === \"newVillagers\" && step.buildings) {\n    step.buildings.forEach((building) => {\n      if (building.type === buildingType) {\n        count += building.count || 1;\n      }\n    });\n  }\n\n  return count;\n}\n\nfunction hasBarracksInStep(step: BuildOrderStep): boolean {\n  // Check for explicit barracks buildings\n  if (\n    (step.type === \"build\" ||\n      step.type === \"newVillagers\" ||\n      step.type === \"moveVillagers\") &&\n    step.buildings\n  ) {\n    return step.buildings.some((building) => building.type === \"barracks\");\n  }\n  return false;\n}\n\n\nfunction hasMillInStep(step: BuildOrderStep, civilization: string): boolean {\n  // Check for explicit mill/folwark buildings\n  if (\n    (step.type === \"build\" ||\n      step.type === \"newVillagers\" ||\n      step.type === \"moveVillagers\") &&\n    step.buildings\n  ) {\n    const hasMill = step.buildings.some((building) => {\n      // For Poles, only check for folwarks (they don't use mills)\n      if (civilization === \"Poles\") {\n        return building.type === \"folwark\";\n      }\n      // For other civilizations, check for mills\n      return building.type === \"mill\";\n    });\n    if (hasMill) return true;\n  }\n\n  return false;\n}\n\nfunction extractBuildingsFromStep(\n  step: BuildOrderStep,\n  currentCheckpointType: CheckpointOption,\n  civilization: string,\n  stepIndex: number,\n  firstBarracksStepIndex: number | null,\n  firstMillStepIndex: number | null\n): ChronologicalAction[] {\n  const actions: ChronologicalAction[] = [];\n\n  if (\n    (step.type === \"build\" ||\n      step.type === \"newVillagers\" ||\n      step.type === \"moveVillagers\") &&\n    step.buildings\n  ) {\n    step.buildings.forEach((building) => {\n      // Skip houses as they're not strategically significant\n      if (building.type === \"house\") return;\n\n      // For Poles: skip folwarks (handled in food notes), but show mills normally\n      if (civilization === \"Poles\" && building.type === \"folwark\") return;\n\n      // For other civs: skip mills (handled in food notes), but show folwarks normally\n      if (civilization !== \"Poles\" && building.type === \"mill\") return;\n\n      // Skip lumber camps, mining camps, and mule carts in checkpoint notes\n      if (\n        building.type === \"lumberCamp\" ||\n        building.type === \"miningCamp\" ||\n        building.type === \"muleCart\"\n      ) {\n        return;\n      }\n\n      const buildingName = formatBuildingName(building.type);\n\n      // Check if this is a wall type\n      const isWallType =\n        building.type === \"wall\" ||\n        building.type === \"palisadeWall\" ||\n        building.type === \"stoneWall\" ||\n        building.type === \"fortifiedWall\" ||\n        building.type === \"greatWall\" ||\n        building.type === \"gate\";\n\n      // Special handling for building content\n      let content: string;\n      if (isWallType) {\n        // Walls always show as \"Build a [Wall Type]\" without count\n        content = `Build a ${buildingName}`;\n      } else if (building.type === \"barracks\" &&\n          firstBarracksStepIndex !== null &&\n          firstMillStepIndex !== null &&\n          firstBarracksStepIndex < firstMillStepIndex) {\n        // Special handling for barracks - check if it should be \"Build Barracks before Mill\"\n        content = building.count > 1\n          ? `Build ${building.count} ${pluralize(buildingName, building.count)} before Mill`\n          : `Build ${buildingName} before Mill`;\n      } else {\n        // Default case - \"Build [BuildingName]\"\n        content = building.count > 1\n          ? `Build ${building.count} ${pluralize(buildingName, building.count)}`\n          : `Build ${buildingName}`;\n      }\n\n      actions.push({\n        stepIndex,\n        type: 'building',\n        content,\n        optional: step.optional,\n        buildingType: building.type,\n        buildingCount: building.count,\n      });\n    });\n  }\n\n  return actions;\n}\n\nfunction extractResearchFromStep(step: BuildOrderStep, stepIndex: number): ChronologicalAction[] {\n  const actions: ChronologicalAction[] = [];\n\n  if (step.type === \"research\" && step.tech) {\n    step.tech.forEach((tech) => {\n      const techName = getTechnologyLabel(tech);\n      actions.push({\n        stepIndex,\n        type: 'research',\n        content: `Research ${techName}`,\n        optional: step.optional\n      });\n    });\n  }\n\n  return actions;\n}\n\nfunction extractUnitsFromStep(step: BuildOrderStep, stepIndex: number): ChronologicalAction[] {\n  const actions: ChronologicalAction[] = [];\n\n  if (step.type === \"trainUnit\") {\n    const unitName = getUnitLabel(step.unit);\n    let content: string;\n\n    if (step.count === \"\" || step.count === \"unlimited\") {\n      content = `Start Training ${pluralize(unitName)}`;\n    } else {\n      const isSingleUnit = SINGLE_UNIT_ONLY_UNITS.has(step.unit);\n      const count = Number(step.count);\n      const displayCount = isSingleUnit || count === 1 ? \"\" : `${count} `;\n      const unitText = count === 1 ? unitName : pluralize(unitName, count);\n      content = `Train ${displayCount}${unitText}`.trim();\n    }\n\n    actions.push({\n      stepIndex,\n      type: 'unit',\n      content,\n      optional: step.optional\n    });\n  }\n\n  return actions;\n}\n\nfunction extractNotesFromStep(step: BuildOrderStep, stepIndex: number): ChronologicalAction[] {\n  const actions: ChronologicalAction[] = [];\n\n  // Process collectGold type steps\n  const unknownStep = step as unknown as Record<string, unknown>;\n  if (unknownStep.type === \"collectGold\") {\n    const description = convertTaskToReadableText(unknownStep.task as string);\n    actions.push({\n      stepIndex,\n      type: 'note',\n      content: description,\n      optional: step.optional\n    });\n  }\n\n  // Process trade type steps\n  if (step.type === \"trade\") {\n    const actionText = step.action === \"sell\" ? \"Sell\" : \"Buy\";\n    const resourceName = step.resource.charAt(0).toUpperCase() + step.resource.slice(1);\n    const content = `${actionText} ${step.count} ${resourceName}`;\n    actions.push({\n      stepIndex,\n      type: 'note',\n      content,\n      optional: step.optional\n    });\n  }\n\n  return actions;\n}\n\nfunction formatBuildingName(buildingType: string): string {\n  // Handle special cases and formatting\n  const buildingMap: { [key: string]: string } = {\n    archeryRange: \"Range\",\n    barracks: \"Barracks\",\n    stable: \"Stable\",\n    siegeWorkshop: \"Siege Workshop\",\n    blacksmith: \"Blacksmith\",\n    market: \"Market\",\n    monastery: \"Monastery\",\n    university: \"University\",\n    castle: \"Castle\",\n    townCenter: \"Town Center\",\n    mill: \"Mill\",\n    lumberCamp: \"Lumber Camp\",\n    miningCamp: \"Mining Camp\",\n    dock: \"Dock\",\n    house: \"House\",\n    farm: \"Farm\",\n    muleCart: \"Mule Cart\",\n    folwark: \"Folwark\",\n    fortifiedChurch: \"Fortified Church\",\n    caravanserai: \"Caravanserai\",\n    watchTower: \"Watch Tower\",\n    guardTower: \"Guard Tower\",\n    donjon: \"Donjon\",\n    feitoria: \"Feitoria\",\n    krepost: \"Krepost\",\n    harbor: \"Harbor\",\n    pasture: \"Pasture\",\n    wall: \"Wall\",\n    palisadeWall: \"Palisade Wall\",\n    stoneWall: \"Stone Wall\",\n    fortifiedWall: \"Fortified Wall\",\n    greatWall: \"Great Wall\",\n    gate: \"Gate\",\n    tower: \"Tower\",\n  };\n\n  return (\n    buildingMap[buildingType] ||\n    buildingType.charAt(0).toUpperCase() + buildingType.slice(1)\n  );\n}\n\nfunction consolidateBuildings(buildingsList: string[]): string {\n  if (buildingsList.length === 0) return \"\";\n\n  const buildingCounts = new Map<string, number>();\n  const buildingOrder: string[] = [];\n\n  buildingsList.forEach((buildingString) => {\n    // Parse building string like \"Build Barracks\", \"Build 2 Ranges\", or \"Build a Wall\"\n    const match = buildingString.match(/^Build (?:a |(\\d+) )?(.+)$/);\n    if (!match) return;\n\n    const countStr = match[1];\n    const buildingName = match[2];\n    const count = countStr ? parseInt(countStr) : 1;\n\n    // For walls (strings starting with \"Build a\"), deduplicate per wall type\n    // Only add once per checkpoint, ignore additional instances\n    const isWall = buildingString.startsWith(\"Build a \");\n\n    if (buildingCounts.has(buildingName)) {\n      if (isWall) {\n        // For walls, don't increment count - just deduplicate\n        return;\n      } else {\n        // For non-walls, sum the counts\n        buildingCounts.set(\n          buildingName,\n          buildingCounts.get(buildingName)! + count\n        );\n      }\n    } else {\n      buildingCounts.set(buildingName, count);\n      buildingOrder.push(buildingName);\n    }\n  });\n\n  const buildingParts = buildingOrder.map((buildingName) => {\n    const count = buildingCounts.get(buildingName)!;\n    if (count > 1) {\n      // If count > 1, the buildingName extracted from the string is already plural\n      // Don't pluralize again - just use it as-is\n      return `${count} ${buildingName}`;\n    } else {\n      return buildingName;\n    }\n  });\n\n  return `Build ${buildingParts.join(\" + \")}`;\n}\n\nfunction consolidateResearch(researchList: string[]): string {\n  if (researchList.length === 0) return \"\";\n\n  const researchCounts = new Map<string, number>();\n  const researchOrder: string[] = [];\n\n  researchList.forEach((researchString) => {\n    // Parse research string like \"Research Bloodlines\" or \"Research Forging\"\n    const match = researchString.match(/^Research (.+)$/);\n    if (!match) return;\n\n    const techName = match[1];\n\n    if (researchCounts.has(techName)) {\n      researchCounts.set(techName, researchCounts.get(techName)! + 1);\n    } else {\n      researchCounts.set(techName, 1);\n      researchOrder.push(techName);\n    }\n  });\n\n  const researchParts = researchOrder.map((techName) => {\n    const count = researchCounts.get(techName)!;\n    if (count > 1) {\n      return `${count} ${techName}`;\n    } else {\n      return techName;\n    }\n  });\n\n  return `Research ${researchParts.join(\" + \")}`;\n}\n\nfunction consolidateUnits(unitsList: string[]): string {\n  if (unitsList.length === 0) return \"\";\n\n  const unitCounts = new Map<string, number>();\n  const unitOrder: string[] = [];\n  const continuousUnits: string[] = [];\n\n  unitsList.forEach((unitString) => {\n    // Handle continuous training like \"Start Training Villagers\"\n    const continuousMatch = unitString.match(/^Start Training (.+)$/);\n    if (continuousMatch) {\n      continuousUnits.push(continuousMatch[1]);\n      return;\n    }\n\n    // Parse unit string like \"Train 5 Archers\" or \"Train Scout\"\n    const match = unitString.match(/^Train (?:(\\d+) )?(.+)$/);\n    if (!match) return;\n\n    const countStr = match[1];\n    const unitName = match[2];\n    const count = countStr ? parseInt(countStr, 10) : 1;\n\n    if (unitCounts.has(unitName)) {\n      unitCounts.set(unitName, unitCounts.get(unitName)! + count);\n    } else {\n      unitCounts.set(unitName, count);\n      unitOrder.push(unitName);\n    }\n  });\n\n  const parts: string[] = [];\n\n  // Add counted units\n  if (unitOrder.length > 0) {\n    const unitParts = unitOrder.map((unitName) => {\n      const count = unitCounts.get(unitName)!;\n      if (count === 1) {\n        return unitName;\n      }\n      return `${count} ${unitName}`;\n    });\n    parts.push(`Train ${unitParts.join(\" + \")}`);\n  }\n\n  // Add continuous units\n  if (continuousUnits.length > 0) {\n    parts.push(`Start Training ${continuousUnits.join(\" + \")}`);\n  }\n\n  return parts.join(\" | \");\n}\n\nfunction consolidateChronologicalActions(actions: ChronologicalAction[]): string[] {\n  if (actions.length === 0) return [];\n\n  // Sort by step index to maintain chronological order\n  const sortedActions = [...actions].sort((a, b) => a.stepIndex - b.stepIndex);\n\n  // Group consecutive actions of the same type and optional status for consolidation\n  const groups: { type: string; optional: boolean; actions: ChronologicalAction[] }[] = [];\n  let currentGroup: { type: string; optional: boolean; actions: ChronologicalAction[] } | null = null;\n\n  sortedActions.forEach(action => {\n    const isOptional = action.optional || false;\n    if (!currentGroup || currentGroup.type !== action.type || currentGroup.optional !== isOptional) {\n      currentGroup = { type: action.type, optional: isOptional, actions: [action] };\n      groups.push(currentGroup);\n    } else {\n      currentGroup.actions.push(action);\n    }\n  });\n\n  // Consolidate each group and maintain order\n  return groups.map(group => {\n    const contents = group.actions.map(action => action.content);\n\n    let consolidated: string;\n    switch (group.type) {\n      case 'building':\n        consolidated = consolidateBuildings(contents);\n        break;\n      case 'research':\n        consolidated = consolidateResearch(contents);\n        break;\n      case 'unit':\n        consolidated = consolidateUnits(contents);\n        break;\n      case 'note':\n        consolidated = contents.join(' | '); // Don't consolidate notes, just join\n        break;\n      default:\n        consolidated = contents.join(' | ');\n    }\n\n    // Add \"Optional:\" prefix if this group is optional\n    return group.optional && consolidated ? `Optional: ${consolidated}` : consolidated;\n  }).filter(result => result !== '');\n}\n\nfunction villagersAreEqual(\n  a: VillagerDistribution,\n  b: VillagerDistribution\n): boolean {\n  return (\n    a.food === b.food &&\n    a.wood === b.wood &&\n    a.gold === b.gold &&\n    a.stone === b.stone &&\n    a.builders === b.builders &&\n    a.fishingShips === b.fishingShips\n  );\n}\n\n// Step lookup utility functions\n\nfunction generateFoodNote(\n  checkpointType: CheckpointOption,\n  checkpointFarmsSeeded: number,\n  totalFarmsSeeded: number,\n  checkpointHasMill: boolean,\n  hasEverBuiltMill: boolean,\n  civilization: string,\n  checkpointFarmsOptional: boolean\n): { foodNote: string | undefined; newTotalFarms: number } {\n  // Get the correct building name based on civilization\n  const buildingName = civilization === \"Poles\" ? \"Folwark\" : \"Mill\";\n\n  // Calculate new farm total if farms are being seeded\n  const newTotalFarms =\n    checkpointFarmsSeeded > 0\n      ? totalFarmsSeeded + checkpointFarmsSeeded\n      : totalFarmsSeeded;\n\n  // Generate farm note component\n  const farmNote =\n    checkpointFarmsSeeded > 0\n      ? totalFarmsSeeded === 0\n        ? `Seed ${newTotalFarms} Farm${newTotalFarms === 1 ? \"\" : \"s\"}`\n        : `Go up to ${newTotalFarms} Farm${newTotalFarms === 1 ? \"\" : \"s\"}`\n      : null;\n\n  let resultNote: string | undefined;\n\n  if (checkpointType === \"dark_age\") {\n    // Rule 1: Dark Age + No Mill/Folwark = \"Skip Mill\"/\"Skip Folwark\"\n    if (!checkpointHasMill) {\n      resultNote = farmNote\n        ? `Skip ${buildingName} + ${farmNote}`\n        : `Skip ${buildingName}`;\n    } else {\n      // Rule 2: Dark Age + Mill/Folwark Built = no building note, farms only\n      resultNote = farmNote\n        ? `Seed ${newTotalFarms} Farm${newTotalFarms === 1 ? \"\" : \"s\"}`\n        : undefined;\n    }\n  } else {\n    // Post-Dark Age\n    // Rule 3: First mill/folwark ever built = \"Build Mill\"/\"Build Folwark\"\n    if (checkpointHasMill && !hasEverBuiltMill) {\n      resultNote = farmNote\n        ? `Build ${buildingName} + ${farmNote}`\n        : `Build ${buildingName}`;\n    } else {\n      // Rule 4: No mill/folwark or subsequent mill/folwark = farms only\n      if (checkpointFarmsSeeded > 0) {\n        if (totalFarmsSeeded === 0) {\n          // First time seeding farms\n          resultNote = `Seed ${newTotalFarms} Farm${\n            newTotalFarms === 1 ? \"\" : \"s\"\n          }`;\n        } else {\n          // Adding more farms\n          resultNote = `Go up to ${newTotalFarms} Farm${\n            newTotalFarms === 1 ? \"\" : \"s\"\n          }`;\n        }\n      }\n    }\n  }\n\n  // Add \"Optional:\" prefix if farms are optional and we have a note\n  if (checkpointFarmsOptional && resultNote) {\n    resultNote = `Optional: ${resultNote}`;\n  }\n\n  // Apply title case to the final note\n  if (resultNote) {\n    resultNote = toTitleCaseLabel(resultNote);\n  }\n\n  return {\n    foodNote: resultNote,\n    newTotalFarms,\n  };\n}\n\nfunction buildResourceNotes(\n  baseNote: string | undefined,\n  actions: FoodActionCounters,\n  openingFoodNote?: string\n): { foodNote?: string; goldNote?: string } {\n  const foodSegments: string[] = [];\n  const deerSegments: string[] = [];\n  const otherFoodSegments: string[] = [];\n  const farmSegments: string[] = [];\n  const goldSegments: string[] = [];\n  const openingSegments: string[] = [];\n\n  if (openingFoodNote && openingFoodNote.trim().length > 0) {\n    openingSegments.push(openingFoodNote);\n  }\n\n  if (actions.pushDeer > 0) {\n    let segment = formatPushSegment(actions.pushDeer);\n    if (actions.pushDeerOptional) {\n      segment = `Optional: ${segment}`;\n    }\n    deerSegments.push(segment);\n  } else {\n    const deerAssignments = actions.takeAssignments.deer;\n    if (deerAssignments > 0) {\n      let segment = formatTakeSegment(\"deer\", deerAssignments);\n      if (actions.takeAssignmentsOptional.deer) {\n        segment = `Optional: ${segment}`;\n      }\n      deerSegments.push(segment);\n    }\n  }\n\n  const takeOrder: FoodSourceKey[] = [\"deer\", \"fox\", \"chicken\", \"shorefish\"];\n  takeOrder.forEach((source) => {\n    if (source === \"deer\") {\n      return;\n    }\n    if (source === \"fox\") {\n      const count = actions.takeAssignments[source];\n      if (count > 0) {\n        let segment = formatTakeSegment(source, count);\n        if (actions.takeAssignmentsOptional[source]) {\n          segment = `Optional: ${segment}`;\n        }\n        goldSegments.push(segment);\n      }\n      return;\n    }\n    const count = actions.takeAssignments[source];\n    if (count > 0) {\n      let segment = formatTakeSegment(source, count);\n      if (actions.takeAssignmentsOptional[source]) {\n        segment = `Optional: ${segment}`;\n      }\n      otherFoodSegments.push(segment);\n    }\n  });\n\n  if (baseNote && baseNote.trim().length > 0) {\n    farmSegments.push(baseNote);\n  }\n\n  foodSegments.push(...openingSegments);\n  foodSegments.push(...deerSegments);\n  foodSegments.push(...otherFoodSegments);\n  foodSegments.push(...farmSegments);\n\n  return {\n    foodNote: foodSegments.length > 0 ? foodSegments.join(\" + \") : undefined,\n    goldNote: goldSegments.length > 0 ? goldSegments.join(\" + \") : undefined,\n  };\n}\n\nfunction preprocessStepsForTracking(\n  steps: BuildOrderStep[],\n  civilization: string\n): { firstBarracksStepIndex: number | null; firstMillStepIndex: number | null } {\n  let firstBarracksStepIndex: number | null = null;\n  let firstMillStepIndex: number | null = null;\n\n  for (let i = 0; i < steps.length; i++) {\n    const step = steps[i];\n\n    // Skip decision steps\n    if (step.type === \"decision\") {\n      continue;\n    }\n\n    // Track first barracks occurrence\n    if (firstBarracksStepIndex === null && hasBarracksInStep(step)) {\n      firstBarracksStepIndex = i;\n    }\n\n    // Track first mill occurrence (including berry-implied mills)\n    if (firstMillStepIndex === null && hasMillInStep(step, civilization)) {\n      firstMillStepIndex = i;\n    }\n\n    // Early exit if we found both\n    if (firstBarracksStepIndex !== null && firstMillStepIndex !== null) {\n      break;\n    }\n  }\n\n  return { firstBarracksStepIndex, firstMillStepIndex };\n}\n\nexport function convertStepsToCheckpoints(\n  steps: BuildOrderStep[],\n  civilization: string,\n  startingAge?: \"dark_age\" | \"feudal_age\" | \"castle_age\" | \"imperial_age\",\n  options?: {\n    hasPriorSteps?: boolean;\n    skipValidation?: boolean;\n    validateWithSteps?: BuildOrderStep[];\n  }\n): Checkpoint[] {\n  // Validate build for common issues\n  if (!options?.skipValidation) {\n    validateAndThrow(options?.validateWithSteps ?? steps);\n  }\n\n  // Preprocess steps to collect tracking data\n  const trackingData = preprocessStepsForTracking(steps, civilization);\n\n  const hasPriorSteps = options?.hasPriorSteps ?? false;\n  const initialCheckpointType: CheckpointOption =\n    startingAge || \"dark_age\";\n  const shouldTrackOpeningFood =\n    !hasPriorSteps && initialCheckpointType === \"dark_age\";\n\n  const checkpoints: Checkpoint[] = [];\n  const state: ConversionState = {\n    currentCheckpointType: initialCheckpointType,\n    chronologicalActions: [],\n    lastCheckpointCreated: null,\n    dark_ageLumberCampCount: 0,\n    currentStepIndex: 0,\n    currentCheckpointHasMill: false,\n    hasEverBuiltMill: false,\n    firstBarracksStepIndex: trackingData.firstBarracksStepIndex,\n    firstMillStepIndex: trackingData.firstMillStepIndex,\n    hasEverBuiltBarracks: trackingData.firstBarracksStepIndex !== null,\n  };\n\n  let currentVillagers = createEmptyVillagerDistribution();\n  let lastAgeVillagers = createEmptyVillagerDistribution();\n  let lastTransitionVillagers = createEmptyVillagerDistribution();\n  let pendingTransition: string | null = null;\n  let openingFoodNote: string | undefined;\n  let openingFoodNoteApplied = false;\n  let hasCapturedOpeningFood = false;\n  let maxFoodBeforeNonFood = 0;\n\n  // Farm tracking\n  let totalFarmsSeeded = 0;\n  let checkpointFarmsSeeded = 0;\n  let checkpointFarmsOptional = false;\n  let checkpointFoodActions = createEmptyFoodActions();\n\n  // Wood tranche tracking (only for age checkpoints, not transitions)\n  let woodTranches: number[] = [];\n\n  const captureOpeningFoodNote = (step: BuildOrderStep) => {\n    if (!shouldTrackOpeningFood || hasCapturedOpeningFood) {\n      return;\n    }\n\n    const { food, wood, gold, stone, build } = step.resources;\n    const hasNonFoodVillagers = wood > 0 || gold > 0 || stone > 0 || build > 0;\n\n    if (!hasNonFoodVillagers) {\n      if (food > maxFoodBeforeNonFood) {\n        maxFoodBeforeNonFood = food;\n      }\n      return;\n    }\n\n    const foodCountBeforeNonFood =\n      maxFoodBeforeNonFood > 0 ? maxFoodBeforeNonFood : food;\n    const note = formatOpeningFoodNote(foodCountBeforeNonFood);\n\n    if (note) {\n      openingFoodNote = note;\n    }\n    hasCapturedOpeningFood = true;\n  };\n\n  const consumeOpeningFoodNote = (): string | undefined => {\n    if (openingFoodNoteApplied || !openingFoodNote) {\n      return undefined;\n    }\n    openingFoodNoteApplied = true;\n    return openingFoodNote;\n  };\n\n  for (let i = 0; i < steps.length; i++) {\n    const step = steps[i];\n    state.currentStepIndex = i;\n\n    // Skip decision steps in linear checkpoint conversion\n    if (step.type === \"decision\") {\n      continue;\n    }\n\n    // Note: Barracks and mill tracking is now done in preprocessing phase\n\n    // Track farm seeding\n    if (isFarmSeedingStep(step)) {\n      const farmCount = getFarmCountFromStep(step);\n      checkpointFarmsSeeded += farmCount;\n      // Track if farms are optional (all contributions must be optional to mark as optional)\n      if (step.optional && checkpointFarmsSeeded === farmCount) {\n        checkpointFarmsOptional = true;\n      } else if (!step.optional) {\n        checkpointFarmsOptional = false;\n      }\n    }\n\n    // Track wildlife-related food actions\n    if (step.type === \"lure\") {\n      const targetAnimal = normalizeFoodSource(\n        (step as unknown as { animal?: string }).animal\n      );\n\n      if (targetAnimal) {\n        const rawCount = (step as unknown as { count?: number | string }).count;\n        const methodValue = (step as unknown as { method?: string }).method;\n        const normalizedMethod =\n          methodValue === \"push\" || methodValue === \"villagers\"\n            ? methodValue\n            : targetAnimal === \"deer\"\n            ? \"push\"\n            : \"villagers\";\n\n        if (targetAnimal === \"deer\" && normalizedMethod === \"push\") {\n          const pushCount = extractPositiveCount(rawCount, 1);\n          if (pushCount > 0) {\n            checkpointFoodActions.pushDeer += pushCount;\n            // Track if this is optional (all contributions must be optional to mark as optional)\n            if (step.optional && checkpointFoodActions.pushDeer === pushCount) {\n              checkpointFoodActions.pushDeerOptional = true;\n            } else if (!step.optional) {\n              checkpointFoodActions.pushDeerOptional = false;\n            }\n          }\n        } else {\n          const takeCount = extractPositiveCount(rawCount, 1);\n          if (takeCount > 0) {\n            checkpointFoodActions.takeAssignments[targetAnimal] += takeCount;\n            // Track if this is optional (all contributions must be optional to mark as optional)\n            if (step.optional && checkpointFoodActions.takeAssignments[targetAnimal] === takeCount) {\n              checkpointFoodActions.takeAssignmentsOptional[targetAnimal] = true;\n            } else if (!step.optional) {\n              checkpointFoodActions.takeAssignmentsOptional[targetAnimal] = false;\n            }\n          }\n        }\n      }\n    }\n\n    if (step.type === \"newVillagers\") {\n      const target = normalizeFoodSource(\n        (step as unknown as { task?: string }).task\n      );\n      if (target) {\n        const assignCount = extractPositiveCount(\n          (step as unknown as { count?: number | string }).count,\n          1\n        );\n        if (assignCount > 0) {\n          checkpointFoodActions.takeAssignments[target] += assignCount;\n          // Track if this is optional\n          if (step.optional && checkpointFoodActions.takeAssignments[target] === assignCount) {\n            checkpointFoodActions.takeAssignmentsOptional[target] = true;\n          } else if (!step.optional) {\n            checkpointFoodActions.takeAssignmentsOptional[target] = false;\n          }\n        }\n      }\n    }\n\n    if (step.type === \"moveVillagers\") {\n      const destination = normalizeFoodSource(\n        (step as unknown as { to?: string }).to\n      );\n      if (destination) {\n        const moveCount = extractPositiveCount(\n          (step as unknown as { count?: number | string }).count,\n          1\n        );\n        if (moveCount > 0) {\n          checkpointFoodActions.takeAssignments[destination] += moveCount;\n          // Track if this is optional\n          if (step.optional && checkpointFoodActions.takeAssignments[destination] === moveCount) {\n            checkpointFoodActions.takeAssignmentsOptional[destination] = true;\n          } else if (!step.optional) {\n            checkpointFoodActions.takeAssignmentsOptional[destination] = false;\n          }\n        }\n      }\n    }\n\n    // Track mill building (only for non-age transition steps)\n    if (step.type !== \"ageUp\" && step.type !== \"newAge\") {\n      if (hasMillInStep(step, civilization)) {\n        state.currentCheckpointHasMill = true;\n      }\n    }\n\n    // Track wood assignments for current age (before ageUp)\n    if (\n      step.type !== \"ageUp\" &&\n      step.type !== \"newAge\" &&\n      isWoodAssignmentStep(step)\n    ) {\n      const woodCount = getWoodCountFromStep(step);\n      if (woodCount > 0 && woodTranches.length === 0) {\n        woodTranches.push(woodCount);\n      }\n    }\n\n    // Track resource allocations\n    const totalVillagers =\n      step.resources.food +\n      step.resources.wood +\n      step.resources.gold +\n      step.resources.stone +\n      step.resources.build;\n\n    if (totalVillagers > 0) {\n      captureOpeningFoodNote(step);\n      currentVillagers = updateVillagersFromResources(\n        currentVillagers,\n        step.resources\n      );\n    }\n\n    // Track dark age lumber camps before age up\n    if (\n      state.currentCheckpointType === \"dark_age\" &&\n      step.type !== \"ageUp\" &&\n      step.type !== \"newAge\"\n    ) {\n      state.dark_ageLumberCampCount += countBuildingTypeFromStep(\n        step,\n        \"lumberCamp\"\n      );\n    }\n\n    // Accumulate actions for all non-age steps\n    if (step.type !== \"ageUp\" && step.type !== \"newAge\") {\n      const stepBuildings = extractBuildingsFromStep(\n        step,\n        state.currentCheckpointType,\n        civilization,\n        state.currentStepIndex,\n        state.firstBarracksStepIndex,\n        state.firstMillStepIndex\n      );\n      if (stepBuildings.length > 0) {\n        state.chronologicalActions.push(...stepBuildings);\n      }\n\n      const stepResearch = extractResearchFromStep(step, state.currentStepIndex);\n      if (stepResearch.length > 0) {\n        state.chronologicalActions.push(...stepResearch);\n      }\n\n      const stepUnits = extractUnitsFromStep(step, state.currentStepIndex);\n      if (stepUnits.length > 0) {\n        state.chronologicalActions.push(...stepUnits);\n      }\n\n      const stepNotes = extractNotesFromStep(step, state.currentStepIndex);\n      if (stepNotes.length > 0) {\n        state.chronologicalActions.push(...stepNotes);\n      }\n    }\n\n    // Handle age transitions\n    if (step.type === \"ageUp\") {\n      // Create checkpoint for current age if villagers changed or we have content\n      const villagersChanged = !villagersAreEqual(\n        currentVillagers,\n        lastAgeVillagers\n      );\n      const hasActions = state.chronologicalActions.length > 0;\n\n      if (\n        (villagersChanged || hasActions) &&\n        state.lastCheckpointCreated !== state.currentCheckpointType\n      ) {\n        // Generate food note (farms and mill logic)\n        const { foodNote: baseFoodNote, newTotalFarms } = generateFoodNote(\n          state.currentCheckpointType,\n          checkpointFarmsSeeded,\n          totalFarmsSeeded,\n          state.currentCheckpointHasMill,\n          state.hasEverBuiltMill,\n          civilization,\n          checkpointFarmsOptional\n        );\n        totalFarmsSeeded = newTotalFarms;\n        checkpointFarmsSeeded = 0;\n        checkpointFarmsOptional = false;\n        const openingFoodNoteForCheckpoint = consumeOpeningFoodNote();\n        const { foodNote: combinedFoodNote, goldNote: combinedGoldNote } = buildResourceNotes(\n          baseFoodNote,\n          checkpointFoodActions,\n          openingFoodNoteForCheckpoint\n        );\n\n        // Update mill history after generating food note\n        if (state.currentCheckpointHasMill) {\n          state.hasEverBuiltMill = true;\n        }\n\n        // Generate wood note if wood assignments exist in this age\n        let woodNote: string | undefined = undefined;\n        if (\n          woodTranches.length > 0 &&\n          state.currentCheckpointType === \"dark_age\"\n        ) {\n          const initialWoodVillagers = woodTranches[0];\n          const finalWoodVillagers = currentVillagers.wood;\n          if (initialWoodVillagers !== finalWoodVillagers) {\n            woodNote = toTitleCaseLabel(`${initialWoodVillagers} initially`);\n          }\n        }\n\n        // Add lumber camp info for dark age if 2 or more\n        if (\n          state.currentCheckpointType === \"dark_age\" &&\n          state.dark_ageLumberCampCount >= 2\n        ) {\n          if (woodNote) {\n            woodNote += `; ${toTitleCaseLabel(`build ${state.dark_ageLumberCampCount} lumber camps`)}`;\n          } else {\n            woodNote = toTitleCaseLabel(`Build ${state.dark_ageLumberCampCount} lumber camps`);\n          }\n        }\n\n        // Consolidate actions in chronological order\n        const allNotes = consolidateChronologicalActions(state.chronologicalActions);\n        const villagersWithNotes = {\n          ...currentVillagers,\n          ...(combinedFoodNote && { foodNote: combinedFoodNote }),\n          ...(combinedGoldNote && { goldNote: combinedGoldNote }),\n          ...(woodNote && { woodNote }),\n        };\n\n        checkpoints.push({\n          type: state.currentCheckpointType,\n          villagers: villagersWithNotes,\n          genericNotes: allNotes,\n        });\n        state.lastCheckpointCreated = state.currentCheckpointType;\n        lastAgeVillagers = { ...currentVillagers };\n        state.chronologicalActions = [];\n        state.currentCheckpointHasMill = false; // Reset mill flag\n        woodTranches = []; // Reset wood tranches after creating age checkpoint\n        checkpointFoodActions = createEmptyFoodActions();\n      }\n\n      // Extract actions from the ageUp step itself\n      const transitionBuildings = extractBuildingsFromStep(\n        step,\n        state.currentCheckpointType,\n        civilization,\n        state.currentStepIndex,\n        state.firstBarracksStepIndex,\n        state.firstMillStepIndex\n      );\n      if (transitionBuildings.length > 0) {\n        state.chronologicalActions.push(...transitionBuildings);\n      }\n\n      // Check for mills in the ageUp step itself\n      if (hasMillInStep(step, civilization)) {\n        state.currentCheckpointHasMill = true;\n      }\n\n      const transitionResearch = extractResearchFromStep(step, state.currentStepIndex);\n      if (transitionResearch.length > 0) {\n        state.chronologicalActions.push(...transitionResearch);\n      }\n\n      const transitionUnits = extractUnitsFromStep(step, state.currentStepIndex);\n      if (transitionUnits.length > 0) {\n        state.chronologicalActions.push(...transitionUnits);\n      }\n\n      const transitionNotes = extractNotesFromStep(step, state.currentStepIndex);\n      if (transitionNotes.length > 0) {\n        state.chronologicalActions.push(...transitionNotes);\n      }\n\n      // Set transition age\n      switch (step.age) {\n        case \"feudalAge\":\n          state.currentCheckpointType = \"dark_age_to_feudal_age\";\n          break;\n        case \"castleAge\":\n          state.currentCheckpointType = \"feudal_age_to_castle_age\";\n          break;\n        case \"imperialAge\":\n          state.currentCheckpointType = \"castle_age_to_imperial_age\";\n          break;\n      }\n\n      // Remember this transition in case it's the last step\n      pendingTransition = step.age;\n    } else if (step.type === \"newAge\") {\n      // At the end of transition, check if villagers changed from last checkpoint\n      const villagersChanged = !villagersAreEqual(\n        currentVillagers,\n        lastTransitionVillagers\n      );\n      const hasActions = state.chronologicalActions.length > 0;\n\n      if (villagersChanged || hasActions) {\n        // Generate food note (farms and mill logic) - transition phases don't handle mill logic\n        const { foodNote: baseFoodNote, newTotalFarms } = generateFoodNote(\n          state.currentCheckpointType,\n          checkpointFarmsSeeded,\n          totalFarmsSeeded,\n          state.currentCheckpointHasMill,\n          state.hasEverBuiltMill,\n          civilization,\n          checkpointFarmsOptional\n        );\n        totalFarmsSeeded = newTotalFarms;\n        checkpointFarmsSeeded = 0;\n        checkpointFarmsOptional = false;\n        const openingFoodNoteForCheckpoint = consumeOpeningFoodNote();\n        const { foodNote: combinedFoodNote, goldNote: combinedGoldNote } = buildResourceNotes(\n          baseFoodNote,\n          checkpointFoodActions,\n          openingFoodNoteForCheckpoint\n        );\n\n        // Update mill history after generating food note\n        if (state.currentCheckpointHasMill) {\n          state.hasEverBuiltMill = true;\n        }\n\n        // Consolidate actions in chronological order\n        const allNotes = consolidateChronologicalActions(state.chronologicalActions);\n        const villagersWithNote = {\n          ...currentVillagers,\n          ...(combinedFoodNote && { foodNote: combinedFoodNote }),\n          ...(combinedGoldNote && { goldNote: combinedGoldNote }),\n        };\n\n        // Find the previous step to get the transition type\n        const prevAgeUpStep = steps\n          .slice(0, i)\n          .reverse()\n          .find((s) => s.type === \"ageUp\");\n        if (prevAgeUpStep) {\n          checkpoints.push({\n            type: mapAgeToTransitionType(prevAgeUpStep.age),\n            villagers: villagersWithNote,\n            genericNotes: allNotes,\n          });\n          lastTransitionVillagers = { ...currentVillagers };\n          state.chronologicalActions = [];\n          state.currentCheckpointHasMill = false; // Reset mill flag\n          checkpointFoodActions = createEmptyFoodActions();\n        }\n      }\n\n      // Clear pending transition since it's been handled\n      pendingTransition = null;\n\n      // Update to target age\n      switch (step.age) {\n        case \"feudalAge\":\n          state.currentCheckpointType = \"feudal_age\";\n          break;\n        case \"castleAge\":\n          state.currentCheckpointType = \"castle_age\";\n          break;\n        case \"imperialAge\":\n          state.currentCheckpointType = \"imperial_age\";\n          break;\n      }\n    }\n  }\n\n  // Handle pending transition checkpoint (when ageUp is the last step)\n  if (pendingTransition) {\n    const villagersChanged = !villagersAreEqual(\n      currentVillagers,\n      lastTransitionVillagers\n    );\n    const hasActions = state.chronologicalActions.length > 0;\n\n    if (villagersChanged || hasActions) {\n      // Generate food note (farms and mill logic) - transition phases don't handle mill logic\n      const { foodNote: baseFoodNote, newTotalFarms } = generateFoodNote(\n        state.currentCheckpointType,\n        checkpointFarmsSeeded,\n        totalFarmsSeeded,\n        state.currentCheckpointHasMill,\n        state.hasEverBuiltMill,\n        civilization,\n        checkpointFarmsOptional\n      );\n      totalFarmsSeeded = newTotalFarms;\n      checkpointFarmsSeeded = 0;\n      checkpointFarmsOptional = false;\n      const openingFoodNoteForCheckpoint = consumeOpeningFoodNote();\n      const { foodNote: combinedFoodNote, goldNote: combinedGoldNote } = buildResourceNotes(\n        baseFoodNote,\n        checkpointFoodActions,\n        openingFoodNoteForCheckpoint\n      );\n\n      // Update mill history after generating food note\n      if (state.currentCheckpointHasMill) {\n        state.hasEverBuiltMill = true;\n      }\n\n      // Consolidate actions in chronological order\n      const allNotes = consolidateChronologicalActions(state.chronologicalActions);\n      const villagersWithNote = {\n        ...currentVillagers,\n        ...(combinedFoodNote && { foodNote: combinedFoodNote }),\n        ...(combinedGoldNote && { goldNote: combinedGoldNote }),\n      };\n\n      checkpoints.push({\n        type: mapAgeToTransitionType(pendingTransition),\n        villagers: villagersWithNote,\n        genericNotes: allNotes,\n      });\n      state.chronologicalActions = [];\n      state.currentCheckpointHasMill = false; // Reset mill flag\n      lastTransitionVillagers = { ...currentVillagers };\n      checkpointFoodActions = createEmptyFoodActions();\n    }\n  }\n\n  // Add final checkpoint for remaining activities in current age\n  const villagersChanged = !villagersAreEqual(\n    currentVillagers,\n    lastAgeVillagers\n  );\n  const hasActions = state.chronologicalActions.length > 0;\n\n  if (\n    (villagersChanged || hasActions) &&\n    state.lastCheckpointCreated !== state.currentCheckpointType\n  ) {\n    // Generate food note (farms and mill logic)\n    const { foodNote: baseFoodNote, newTotalFarms } = generateFoodNote(\n      state.currentCheckpointType,\n      checkpointFarmsSeeded,\n      totalFarmsSeeded,\n      state.currentCheckpointHasMill,\n      state.hasEverBuiltMill,\n      civilization,\n      checkpointFarmsOptional\n    );\n    totalFarmsSeeded = newTotalFarms;\n    checkpointFarmsSeeded = 0;\n    checkpointFarmsOptional = false;\n    const openingFoodNoteForCheckpoint = consumeOpeningFoodNote();\n    const { foodNote: combinedFoodNote, goldNote: combinedGoldNote } = buildResourceNotes(\n      baseFoodNote,\n      checkpointFoodActions,\n      openingFoodNoteForCheckpoint\n    );\n\n    // Update mill history after generating food note\n    if (state.currentCheckpointHasMill) {\n      state.hasEverBuiltMill = true;\n    }\n\n    // Generate wood note if wood assignments exist in this age\n    let woodNote: string | undefined = undefined;\n    if (\n      woodTranches.length > 0 &&\n      state.currentCheckpointType === \"dark_age\"\n    ) {\n      const initialWoodVillagers = woodTranches[0];\n      const finalWoodVillagers = currentVillagers.wood;\n      if (initialWoodVillagers !== finalWoodVillagers) {\n        woodNote = toTitleCaseLabel(`${initialWoodVillagers} initially`);\n      }\n    }\n\n    // Add lumber camp info for dark age if 2 or more\n    if (\n      state.currentCheckpointType === \"dark_age\" &&\n      state.dark_ageLumberCampCount >= 2\n    ) {\n      if (woodNote) {\n        woodNote += `; ${toTitleCaseLabel(`build ${state.dark_ageLumberCampCount} lumber camps`)}`;\n      } else {\n        woodNote = toTitleCaseLabel(`Build ${state.dark_ageLumberCampCount} lumber camps`);\n      }\n    }\n\n    // Consolidate actions in chronological order\n    const allNotes = consolidateChronologicalActions(state.chronologicalActions);\n    const villagersWithNotes = {\n      ...currentVillagers,\n      ...(combinedFoodNote && { foodNote: combinedFoodNote }),\n      ...(combinedGoldNote && { goldNote: combinedGoldNote }),\n      ...(woodNote && { woodNote }),\n    };\n\n    checkpoints.push({\n      type: state.currentCheckpointType,\n      villagers: villagersWithNotes,\n      genericNotes: allNotes,\n    });\n    checkpointFoodActions = createEmptyFoodActions();\n  }\n\n  return checkpoints;\n}\n\nfunction groupStepsByAlternatives(\n  steps: BuildOrderStep[]\n): { decisionText?: string; steps: BuildOrderStep[] }[] {\n  const alternatives: { decisionText?: string; steps: BuildOrderStep[] }[] = [];\n  let currentSteps: BuildOrderStep[] = [];\n  let currentDecisionText: string | undefined = undefined;\n\n  steps.forEach((step) => {\n    if (step.type === \"decision\") {\n      // If we have accumulated steps, create an alternative from them\n      if (currentSteps.length > 0) {\n        alternatives.push({\n          decisionText: currentDecisionText,\n          steps: currentSteps,\n        });\n        currentSteps = [];\n      }\n\n      // Set the decision text for the next alternative\n      currentDecisionText = step.text;\n    } else {\n      // Accumulate non-decision steps\n      currentSteps.push(step);\n    }\n  });\n\n  // Add any remaining steps as the final alternative\n  if (currentSteps.length > 0) {\n    alternatives.push({\n      decisionText: currentDecisionText,\n      steps: currentSteps,\n    });\n  }\n\n  return alternatives;\n}\n\nexport function convertStepsToAlternativeCheckpoints(\n  steps: BuildOrderStep[],\n  civilization: string\n): AlternativeCheckpointPath[] {\n  // Validate the full build once before processing alternatives\n  validateAndThrow(steps);\n\n  // Check if build has decision steps\n  const hasDecisions = steps.some((step) => step.type === \"decision\");\n\n  if (!hasDecisions) {\n    // If no decisions, return single path with all checkpoints\n    return [\n      {\n        checkpoints: convertStepsToCheckpoints(steps, civilization, undefined, {\n          skipValidation: true,\n        }),\n      },\n    ];\n  }\n\n  // Find the first decision point\n  const firstDecisionIndex = steps.findIndex(\n    (step) => step.type === \"decision\"\n  );\n\n  // Split into common steps (before first decision) and remaining steps\n  const commonSteps = steps.slice(0, firstDecisionIndex);\n  const remainingSteps = steps.slice(firstDecisionIndex);\n\n  // Convert common steps to checkpoints\n  const commonCheckpoints =\n    commonSteps.length > 0\n      ? convertStepsToCheckpoints(commonSteps, civilization, undefined, {\n          skipValidation: true,\n        })\n      : [];\n\n  // Group remaining steps by decision alternatives\n  const alternatives = groupStepsByAlternatives(remainingSteps);\n\n  // Convert each alternative by processing the full sequence (common + alternative)\n  // Helper function to determine the current age state when alternatives begin\n  function findCurrentAgeState(\n    steps: BuildOrderStep[],\n    firstDecisionIndex: number\n  ): \"dark_age\" | \"feudal_age\" | \"castle_age\" | \"imperial_age\" {\n    let currentAge: \"dark_age\" | \"feudal_age\" | \"castle_age\" | \"imperial_age\" =\n      \"dark_age\";\n\n    // Look through steps before the first decision to find the most recent newAge\n    for (let i = 0; i < firstDecisionIndex; i++) {\n      const step = steps[i];\n      if (step.type === \"newAge\") {\n        switch (step.age) {\n          case \"feudalAge\":\n            currentAge = \"feudal_age\";\n            break;\n          case \"castleAge\":\n            currentAge = \"castle_age\";\n            break;\n          case \"imperialAge\":\n            currentAge = \"imperial_age\";\n            break;\n        }\n      }\n    }\n\n    return currentAge;\n  }\n\n  // Determine what age we're in when alternatives start\n  const currentAge = findCurrentAgeState(steps, firstDecisionIndex);\n\n  return alternatives.map((alternative) => {\n    // Convert the alternative steps starting from the current age context\n    const alternativeCheckpoints = convertStepsToCheckpoints(\n      alternative.steps,\n      civilization,\n      currentAge,\n      {\n        hasPriorSteps: true,\n        skipValidation: true,\n      }\n    );\n\n    return {\n      decisionText: alternative.decisionText,\n      checkpoints: alternativeCheckpoints,\n      commonCheckpoints:\n        commonCheckpoints.length > 0 ? commonCheckpoints : undefined,\n    };\n  });\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 5351, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/BuildView.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Image from \"next/image\";\nimport EmptyState from \"@/components/EmptyState\";\nimport BuildDisplay from \"@/components/BuildDisplay\";\nimport AlternativeCheckpointDisplay from \"@/components/AlternativeCheckpointDisplay\";\nimport ResourceIcon from \"@/components/ResourceIcon\";\nimport { Build, Checkpoint, VillagerDistribution } from \"@/types/build\";\nimport { BuildOrderStep, Resources } from \"@/types/buildFormat\";\nimport {\n  convertStepsToAlternativeCheckpoints,\n  convertStepsToCheckpoints,\n} from \"@/lib/buildConverter\";\nimport { getAgeImagePath } from \"@/lib/imageUtils\";\nimport { validateBuildOrder } from \"@/lib/buildValidation\";\nimport ValidationWarnings from \"@/components/ValidationWarnings\";\nimport { taskToResource } from \"@/lib/taskUtils\";\n\ntype ViewMode = \"steps\" | \"checkpoints\";\n\ninterface BuildViewProps {\n  build: Build | null | undefined;\n  className?: string;\n  initialViewMode?: ViewMode;\n  viewMode?: ViewMode;\n  onViewModeChange?: (mode: ViewMode) => void;\n  showToggle?: boolean;\n}\n\nconst resourceOrder = [\n  \"food\",\n  \"wood\",\n  \"gold\",\n  \"stone\",\n  \"builders\",\n  \"fishingShips\",\n] as const;\n\nconst COLLECT_GOLD_TASK_METADATA: Record<\n  string,\n  { subType: \"newVillagers\"; count: number } | { subType: \"moveVillagers\"; count: number; from: string; to: string }\n> = {\n  collect10GoldWithNewVillager: { subType: \"newVillagers\", count: 1 },\n  collect40GoldWithTwoNewVillagers: { subType: \"newVillagers\", count: 2 },\n  collect30GoldWithNewVillager: { subType: \"newVillagers\", count: 1 },\n  collect10GoldAfterBarracksIsBuilt: {\n    subType: \"moveVillagers\",\n    count: 1,\n    from: \"build\",\n    to: \"gold\",\n  },\n};\n\nconst createDefaultResources = (): Resources => ({\n  food: 0,\n  wood: 0,\n  gold: 0,\n  stone: 0,\n  build: 0,\n});\n\nfunction applyStepToResources(\n  step: BuildOrderStep,\n  startingResources: Resources\n): { nextResources: Resources; updatedStep: BuildOrderStep } {\n  const resources = { ...startingResources };\n\n  switch (step.type) {\n    case \"newVillagers\": {\n      const targetResource = taskToResource(step.task);\n      const count = Math.max(0, step.count || 0);\n      resources[targetResource] = (resources[targetResource] || 0) + count;\n      break;\n    }\n    case \"moveVillagers\": {\n      const fromResource = taskToResource(step.from);\n      const toResource = taskToResource(step.to);\n      const count = Math.max(0, step.count || 0);\n      resources[fromResource] = Math.max(\n        0,\n        (resources[fromResource] || 0) - count\n      );\n      resources[toResource] = (resources[toResource] || 0) + count;\n      break;\n    }\n    case \"collectGold\": {\n      const metadata = COLLECT_GOLD_TASK_METADATA[step.task];\n      if (metadata) {\n        if (metadata.subType === \"newVillagers\") {\n          const count = Math.max(0, metadata.count);\n          resources.gold = (resources.gold || 0) + count;\n        } else if (metadata.subType === \"moveVillagers\") {\n          const fromResource = taskToResource(metadata.from);\n          const toResource = taskToResource(metadata.to);\n          const count = Math.max(0, metadata.count);\n          resources[fromResource] = Math.max(\n            0,\n            (resources[fromResource] || 0) - count\n          );\n          resources[toResource] = (resources[toResource] || 0) + count;\n        }\n      }\n      break;\n    }\n    default:\n      break;\n  }\n\n  const sanitizedResources = {\n    food: Math.max(0, resources.food || 0),\n    wood: Math.max(0, resources.wood || 0),\n    gold: Math.max(0, resources.gold || 0),\n    stone: Math.max(0, resources.stone || 0),\n    build: Math.max(0, resources.build || 0),\n  } satisfies Resources;\n\n  return {\n    nextResources: sanitizedResources,\n    updatedStep: { ...step, resources: sanitizedResources },\n  };\n}\n\nfunction recalculateSegmentResources(\n  steps: BuildOrderStep[],\n  startingResources: Resources\n): { updatedSteps: BuildOrderStep[]; finalResources: Resources } {\n  let currentResources = { ...startingResources };\n  const updatedSteps: BuildOrderStep[] = [];\n\n  for (const step of steps) {\n    const { nextResources, updatedStep } = applyStepToResources(\n      step,\n      currentResources\n    );\n    updatedSteps.push(updatedStep);\n    currentResources = nextResources;\n  }\n\n  return { updatedSteps, finalResources: currentResources };\n}\n\nfunction recalculateStepResources(steps: BuildOrderStep[]): BuildOrderStep[] {\n  const firstDecisionIndex = steps.findIndex((step) => step.type === \"decision\");\n  if (firstDecisionIndex === -1) {\n    return recalculateSegmentResources(steps, createDefaultResources()).updatedSteps;\n  }\n\n  const commonSegment = steps.slice(0, firstDecisionIndex);\n  const {\n    updatedSteps: updatedCommonSteps,\n    finalResources: baseResources,\n  } = recalculateSegmentResources(commonSegment, createDefaultResources());\n\n  const updatedSteps: BuildOrderStep[] = [...updatedCommonSteps];\n  const baseSnapshot = { ...baseResources };\n\n  let index = firstDecisionIndex;\n  while (index < steps.length) {\n    const decisionStep = steps[index];\n    if (decisionStep.type === \"decision\") {\n      updatedSteps.push({\n        ...decisionStep,\n        resources: { ...baseSnapshot },\n      });\n      index += 1;\n    }\n\n    let nextDecisionIndex = steps.findIndex(\n      (step, idx) => idx >= index && step.type === \"decision\"\n    );\n    if (nextDecisionIndex === -1) {\n      nextDecisionIndex = steps.length;\n    }\n\n    const alternativeSegment = steps.slice(index, nextDecisionIndex);\n    if (alternativeSegment.length > 0) {\n      const { updatedSteps: updatedAlternativeSteps } =\n        recalculateSegmentResources(alternativeSegment, baseSnapshot);\n      updatedSteps.push(...updatedAlternativeSteps);\n    }\n\n    index = nextDecisionIndex;\n  }\n\n  return updatedSteps;\n}\n\nconst ResourceItem = ({\n  resource,\n  count,\n  note,\n  difference,\n}: {\n  resource: string;\n  count: number;\n  note?: string;\n  difference?: number;\n}) => {\n  return (\n    <div className=\"flex items-center space-x-2 sm:space-x-3\">\n      <div className=\"bg-muted px-2 py-1 rounded-default min-w-14 sm:min-w-16 flex items-center justify-center space-x-1\">\n        <ResourceIcon resource={resource} width={20} height={20} />\n        <span className=\"text-foreground font-medium text-xs sm:text-sm\">\n          {count}\n        </span>\n      </div>\n      {difference !== undefined && difference !== 0 && (\n        <span\n          className={`text-xs font-medium ${\n            difference > 0 ? \"text-foreground\" : \"text-cancel\"\n          }`}\n        >\n          {difference > 0 ? \"+\" : \"\"}\n          {difference}\n        </span>\n      )}\n      {note && (\n        <span className=\"text-foreground text-xs sm:text-base\">{note}</span>\n      )}\n    </div>\n  );\n};\n\nconst TextNote = ({ text }: { text: string }) => (\n  <li className=\"text-foreground text-xs sm:text-base text-pretty\">{text}</li>\n);\n\nconst getPhaseTitle = (type?: string, index?: number): string => {\n  if (!type) return `Step ${(index || 0) + 1}`;\n\n  const titleMap: Record<string, string> = {\n    dark_age: \"Dark Age\",\n    feudal_age: \"Feudal Age\",\n    castle_age: \"Castle Age\",\n    imperial_age: \"Imperial Age\",\n    dark_age_to_feudal_age: \"Advance to Feudal Age\",\n    feudal_age_to_castle_age: \"Advance to Castle Age\",\n    castle_age_to_imperial_age: \"Advance to Imperial Age\",\n  };\n\n  return titleMap[type] || `Step ${(index || 0) + 1}`;\n};\n\nconst getResourceNote = (\n  resource: string,\n  checkpoint: Checkpoint\n): string | undefined => {\n  const key = `${resource}Note` as keyof VillagerDistribution;\n  const note = checkpoint.villagers[key];\n  return typeof note === \"string\" ? note : undefined;\n};\n\nconst getResourceDifference = (\n  resource: string,\n  checkpoint: Checkpoint,\n  previousCheckpoint?: Checkpoint\n): number | undefined => {\n  if (!previousCheckpoint) return undefined;\n  const currentCount =\n    (checkpoint.villagers[\n      resource as keyof typeof checkpoint.villagers\n    ] as number) || 0;\n  const previousCount =\n    (previousCheckpoint.villagers[\n      resource as keyof typeof previousCheckpoint.villagers\n    ] as number) || 0;\n  return currentCount - previousCount;\n};\n\nconst renderAgeIcon = (type?: string) => {\n  if (!type) return null;\n\n  if (type.includes(\"_to_\")) {\n    const [startAge, endAge] = type.split(\"_to_\");\n    const startIconSrc = getAgeImagePath(startAge);\n    const endIconSrc = getAgeImagePath(endAge);\n\n    if (!startIconSrc || !endIconSrc) return null;\n\n    return (\n      <div className=\"flex items-center space-x-1\">\n        <Image src={startIconSrc} alt={startAge} width={24} height={24} />\n        <div className=\"text-foreground text-sm font-bold\"></div>\n        <Image src={endIconSrc} alt={endAge} width={24} height={24} />\n      </div>\n    );\n  }\n\n  const iconSrc = getAgeImagePath(type);\n  if (!iconSrc) return null;\n\n  return <Image src={iconSrc} alt={type} width={24} height={24} />;\n};\n\nconst BuildPhase = ({\n  checkpoint,\n  index,\n  previousCheckpoint,\n}: {\n  checkpoint: Checkpoint;\n  index: number;\n  previousCheckpoint?: Checkpoint;\n}) => {\n  const hasResourceChanges = React.useMemo(() => {\n    if (!previousCheckpoint) return true;\n    return resourceOrder.some((resource) => {\n      const current =\n        (checkpoint.villagers[\n          resource as keyof typeof checkpoint.villagers\n        ] as number) || 0;\n      const previous =\n        (previousCheckpoint.villagers[\n          resource as keyof typeof previousCheckpoint.villagers\n        ] as number) || 0;\n      return current !== previous;\n    });\n  }, [checkpoint, previousCheckpoint]);\n\n  const hasResourceNotes = React.useMemo(() => {\n    return resourceOrder.some((resource) => {\n      const note = getResourceNote(resource, checkpoint);\n      return note && note.trim() !== \"\";\n    });\n  }, [checkpoint]);\n\n  const shouldShowResources = hasResourceChanges || hasResourceNotes;\n  const hasGenericNotes =\n    checkpoint.genericNotes && checkpoint.genericNotes.length > 0;\n  const shouldRender = shouldShowResources || hasGenericNotes;\n\n  if (!shouldRender) {\n    return null;\n  }\n\n  return (\n    <div className=\"bg-background rounded-default shadow-default overflow-hidden mb-4 sm:mb-6\">\n      <div className=\"bg-muted px-4 py-3 sm:px-6 sm:py-4 flex justify-between items-center\">\n        <div className=\"flex items-center space-x-2 min-w-0 flex-1\">\n          {checkpoint.type && (\n            <div className=\"flex items-center space-x-1 sm:space-x-2 flex-shrink-0\">\n              {renderAgeIcon(checkpoint.type)}\n            </div>\n          )}\n          <h3 className=\"text-sm font-semibold text-foreground text-pretty truncate\">\n            {getPhaseTitle(checkpoint.type, index)}\n          </h3>\n        </div>\n      </div>\n\n      <div className=\"p-4 sm:p-6\">\n        {shouldShowResources && (\n          <div className=\"space-y-2 sm:space-y-3\">\n            {resourceOrder\n              .map((resource) => {\n                const count =\n                  (checkpoint.villagers[\n                    resource as keyof typeof checkpoint.villagers\n                  ] as number) || 0;\n                const note = getResourceNote(resource, checkpoint);\n                const difference = getResourceDifference(\n                  resource,\n                  checkpoint,\n                  previousCheckpoint\n                );\n                if (count > 0 || (note && note.trim().length > 0)) {\n                  return (\n                    <ResourceItem\n                      key={resource}\n                      resource={resource}\n                      count={count}\n                      note={note}\n                      difference={difference}\n                    />\n                  );\n                }\n                return null;\n              })\n              .filter(Boolean)}\n          </div>\n        )}\n\n        {hasGenericNotes && (\n          <div className={shouldShowResources ? \"mt-4 sm:mt-6\" : \"\"}>\n            {shouldShowResources && (\n              <div className=\"w-full h-px bg-muted mb-3 sm:mb-4\" />\n            )}\n            <ul className=\"space-y-1 sm:space-y-2 list-disc list-inside\">\n              {checkpoint.genericNotes?.map((note, noteIndex) => (\n                <TextNote key={noteIndex} text={note} />\n              ))}\n            </ul>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nconst ViewToggle = ({\n  viewMode,\n  onToggle,\n  showToggle,\n}: {\n  viewMode: ViewMode;\n  onToggle: (mode: ViewMode) => void;\n  showToggle: boolean;\n}) => {\n  if (!showToggle) return null;\n\n  return (\n    <div className=\"flex justify-center mb-6\">\n      <div className=\"bg-muted rounded-default p-1 inline-flex shadow-default\">\n        <button\n          onClick={() => onToggle(\"steps\")}\n          className={`px-4 py-2 rounded-default text-sm font-medium transition-all ${\n            viewMode === \"steps\"\n              ? \"bg-background text-foreground shadow-default\"\n              : \"text-foreground/70 hover:text-foreground\"\n          }`}\n        >\n          Steps\n        </button>\n        <button\n          onClick={() => onToggle(\"checkpoints\")}\n          className={`px-4 py-2 rounded-default text-sm font-medium transition-all ${\n            viewMode === \"checkpoints\"\n              ? \"bg-background text-foreground shadow-default\"\n              : \"text-foreground/70 hover:text-foreground\"\n          }`}\n        >\n          Checkpoints\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default function BuildView({\n  build,\n  className,\n  initialViewMode = \"steps\",\n  viewMode: controlledViewMode,\n  onViewModeChange,\n  showToggle,\n}: BuildViewProps) {\n  const normalizedSteps = React.useMemo(\n    () => (build?.build ? recalculateStepResources(build.build) : []),\n    [build]\n  );\n\n  const normalizedBuild = React.useMemo(() => {\n    if (!build) return null;\n    if (!build.build) return build;\n    return { ...build, build: normalizedSteps };\n  }, [build, normalizedSteps]);\n\n  const [internalViewMode, setInternalViewMode] =\n    React.useState<ViewMode>(initialViewMode);\n\n  const buildIdentifier = React.useMemo(\n    () => normalizedBuild?.id ?? JSON.stringify(normalizedBuild ?? null),\n    [normalizedBuild]\n  );\n\n  React.useEffect(() => {\n    setInternalViewMode(initialViewMode);\n  }, [initialViewMode, buildIdentifier]);\n\n  const isControlled = controlledViewMode !== undefined;\n  const viewMode = controlledViewMode ?? internalViewMode;\n\n  const handleToggle = React.useCallback(\n    (mode: ViewMode) => {\n      if (!isControlled) {\n        setInternalViewMode(mode);\n      }\n      onViewModeChange?.(mode);\n    },\n    [isControlled, onViewModeChange]\n  );\n\n  const supportsNewFormat = Array.isArray(normalizedBuild?.build);\n  const stepCount = normalizedBuild?.build?.length ?? 0;\n\n  // Check for validation errors to determine if we should show the toggle\n  const hasValidationErrors = React.useMemo(() => {\n    if (!normalizedBuild?.build || normalizedBuild.build.length === 0) return false;\n    const validationResult = validateBuildOrder(\n      normalizedBuild.build,\n      normalizedBuild.civilization\n    );\n    return !validationResult.isValid;\n  }, [normalizedBuild]);\n\n  const showViewToggle =\n    showToggle !== undefined ? showToggle : (supportsNewFormat && !hasValidationErrors);\n\n  const checkpointsContent = React.useMemo(() => {\n    if (!normalizedBuild) {\n      return <EmptyState text=\"No build data available.\" />;\n    }\n\n    if (supportsNewFormat) {\n      if (!normalizedBuild.build || normalizedBuild.build.length === 0) {\n        return <EmptyState text=\"No build steps defined for this build.\" />;\n      }\n\n      try {\n        const hasDecisions = normalizedBuild.build.some(\n          (step) => step.type === \"decision\"\n        );\n\n        if (hasDecisions) {\n          const alternatives = convertStepsToAlternativeCheckpoints(\n            normalizedBuild.build,\n            normalizedBuild.civilization\n          );\n          return (\n            <AlternativeCheckpointDisplay alternatives={alternatives} />\n          );\n        }\n\n        const checkpoints = convertStepsToCheckpoints(\n          normalizedBuild.build,\n          normalizedBuild.civilization\n        );\n\n        return (\n          <div className=\"space-y-6\">\n            {checkpoints\n              .map((checkpoint, index, all) => (\n                <BuildPhase\n                  key={index}\n                  checkpoint={checkpoint}\n                  index={index}\n                  previousCheckpoint={index > 0 ? all[index - 1] : undefined}\n                />\n              ))\n              .filter(Boolean)}\n          </div>\n        );\n      } catch (error) {\n        // If conversion fails, show error message\n        const errorMessage = error instanceof Error ? error.message : \"An unknown error occurred\";\n        return (\n          <>\n            <ValidationWarnings\n              errors={[{ message: errorMessage, severity: \"error\" }]}\n              title=\"Cannot Display Checkpoint View\"\n            />\n            <p className=\"text-foreground/60 text-sm text-center\">Please switch to Steps view to see the build.</p>\n          </>\n        );\n      }\n    }\n\n    return <EmptyState text=\"No build data defined for this build.\" />;\n  }, [normalizedBuild, supportsNewFormat]);\n\n  const stepsContent = React.useMemo(() => {\n    if (!normalizedBuild) {\n      return <EmptyState text=\"No build data available.\" />;\n    }\n\n    if (!supportsNewFormat) {\n      return <EmptyState text=\"No build steps defined for this build.\" />;\n    }\n\n    if (stepCount === 0) {\n      return <EmptyState text=\"No build steps defined for this build.\" />;\n    }\n    return <BuildDisplay build={normalizedBuild} />;\n  }, [normalizedBuild, supportsNewFormat, stepCount]);\n\n  const effectiveViewMode: ViewMode = supportsNewFormat\n    ? viewMode\n    : \"checkpoints\";\n\n  const content =\n    effectiveViewMode === \"steps\" ? stepsContent : checkpointsContent;\n\n  return (\n    <div className={className}>\n      <ViewToggle\n        viewMode={viewMode}\n        onToggle={handleToggle}\n        showToggle={showViewToggle}\n      />\n      {content}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6103, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/AuthPromptModal.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\nimport Button from \"./Button\";\n\ninterface AuthPromptModalProps {\n    isOpen: boolean;\n    onClose: () => void;\n    onLogin: () => void;\n    onRegister: () => void;\n}\n\nexport default function AuthPromptModal({\n    isOpen,\n    onClose,\n    onLogin,\n    onRegister,\n}: AuthPromptModalProps) {\n    if (!isOpen) return null;\n\n    return (\n        <>\n            {/* Backdrop */}\n            <div className=\"fixed inset-0 bg-muted/80 z-50 backdrop-blur-sm cursor-pointer\" onClick={onClose} />\n\n            {/* Dialog */}\n            <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none\">\n                <div className=\"bg-background rounded-default shadow-hover max-w-md w-full p-6 pointer-events-auto border border-foreground/10\">\n                    <h3 className=\"text-xl font-bold text-foreground mb-2 text-center\">\n                        Account Required\n                    </h3>\n\n                    <p className=\"text-foreground/80 mb-8 text-center text-pretty\">\n                        Please log in or create an account to rate builds, save favorites, and keep them on your profile.\n                    </p>\n\n                    <div className=\"flex flex-col gap-3\">\n                        <Button onClick={onLogin} fullWidth>\n                            Log In\n                        </Button>\n                        <Button onClick={onRegister} variant=\"secondary\" fullWidth>\n                            Create Account\n                        </Button>\n                        <button\n                            onClick={onClose}\n                            className=\"mt-2 text-sm text-foreground/60 hover:text-foreground transition-colors\"\n                        >\n                            Cancel\n                        </button>\n                    </div>\n                </div>\n            </div>\n        </>\n    );\n}\n"],"names":[],"mappings":";;;;AAGA;AAHA;;;AAYe,SAAS,gBAAgB,KAKjB;QALiB,EACpC,MAAM,EACN,OAAO,EACP,OAAO,EACP,UAAU,EACS,GALiB;IAMpC,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACI;;0BAEI,6LAAC;gBAAI,WAAU;gBAAiE,SAAS;;;;;;0BAGzF,6LAAC;gBAAI,WAAU;0BACX,cAAA,6LAAC;oBAAI,WAAU;;sCACX,6LAAC;4BAAG,WAAU;sCAAqD;;;;;;sCAInE,6LAAC;4BAAE,WAAU;sCAAkD;;;;;;sCAI/D,6LAAC;4BAAI,WAAU;;8CACX,6LAAC,+HAAA,CAAA,UAAM;oCAAC,SAAS;oCAAS,SAAS;8CAAC;;;;;;8CAGpC,6LAAC,+HAAA,CAAA,UAAM;oCAAC,SAAS;oCAAY,SAAQ;oCAAY,SAAS;8CAAC;;;;;;8CAG3D,6LAAC;oCACG,SAAS;oCACT,WAAU;8CACb;;;;;;;;;;;;;;;;;;;;;;;;;AAQzB;KA1CwB","debugId":null}},
    {"offset": {"line": 6208, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/utils/rtsOverlayExport.ts"],"sourcesContent":["import { Build } from \"@/types/build\";\nimport { BuildOrderStep } from \"@/types/buildFormat\";\n\n/** Get the images conversion dictionary.\n * \n * @returns    dictionary to convert 'Build Order Guide' names to 'RTS Overlay' names\n */\nfunction getImagesDictionary(): Record<string, string> {\n    return {\n        'sheep': 'animal/Sheep_aoe2DE.png',\n        'sheeps': 'animal/Sheep_aoe2DE.png',\n        'shore fish': 'animal/AoE2_DE_shore_fish_icon.png',\n        'boar': 'animal/Boar_aoe2DE.png',\n        'boars': 'animal/Boar_aoe2DE.png',\n        'deer': 'animal/Deer_aoe2DE.png',\n        'deers': 'animal/Deer_aoe2DE.png',\n        'farm': 'mill/FarmDE.png',\n        'farms': 'mill/FarmDE.png',\n\n        'wood': 'resource/Aoe2de_wood.png',\n        'stone': 'resource/Aoe2de_stone.png',\n        'gold': 'resource/Aoe2de_gold.png',\n        'berry': 'resource/BerryBushDE.png',\n        'berries': 'resource/BerryBushDE.png',\n        'food': 'resource/Aoe2de_food.png',\n        'build': 'resource/Aoe2de_hammer.png',\n\n        'folwark': 'mill/Aoe2-icon--folwark.png',\n        'folwarks': 'mill/Aoe2-icon--folwark.png',\n        'house': 'other/House_aoe2DE.png',\n        'houses': 'other/House_aoe2DE.png',\n        'mill': 'mill/Mill_aoe2de.png',\n        'mills': 'mill/Mill_aoe2de.png',\n        'lumber camp': 'lumber_camp/Lumber_camp_aoe2de.png',\n        'lumber camps': 'lumber_camp/Lumber_camp_aoe2de.png',\n        'mining camp': 'mining_camp/Mining_camp_aoe2de.png',\n        'mining camps': 'mining_camp/Mining_camp_aoe2de.png',\n        'dock': 'dock/Dock_aoe2de.png',\n        'docks': 'dock/Dock_aoe2de.png',\n        'barracks': 'barracks/Barracks_aoe2DE.png',\n        'market': 'market/Market_aoe2DE.png',\n        'markets': 'market/Market_aoe2DE.png',\n        'blacksmith': 'blacksmith/Blacksmith_aoe2de.png',\n        'blacksmiths': 'blacksmith/Blacksmith_aoe2de.png',\n        'range': 'archery_range/Archery_range_aoe2DE.png',\n        'ranges': 'archery_range/Archery_range_aoe2DE.png',\n        'archery range': 'archery_range/Archery_range_aoe2DE.png',\n        'archery ranges': 'archery_range/Archery_range_aoe2DE.png',\n        'stable': 'stable/Stable_aoe2DE.png',\n        'stables': 'stable/Stable_aoe2DE.png',\n        'tower': 'defensive_structures/Tower_aoe2de.png',\n        'towers': 'defensive_structures/Tower_aoe2de.png',\n        'town center': 'town_center/Towncenter_aoe2DE.png',\n        'town centers': 'town_center/Towncenter_aoe2DE.png',\n        'tc': 'town_center/Towncenter_aoe2DE.png',\n        'monastery': 'monastery/MonasteryAoe2DE.png',\n        'monasteries': 'monastery/MonasteryAoe2DE.png',\n        'university': 'university/University_AoE2_DE.png',\n        'universities': 'university/University_AoE2_DE.png',\n        'siege workshop': 'siege_workshop/Siege_workshop_aoe2DE.png',\n        'siege workshops': 'siege_workshop/Siege_workshop_aoe2DE.png',\n        'castle': 'castle/Castle_aoe2DE.png',\n        'castles': 'castle/Castle_aoe2DE.png',\n        'krepost': 'defensive_structures/Krepost_aoe2de.png',\n        'kreposts': 'defensive_structures/Krepost_aoe2de.png',\n        'feitoria': 'other/Feitoria_aoe2DE.png',\n        'fish trap': 'dock/Fish_trap_aoe2DE.png',\n        'fish traps': 'dock/Fish_trap_aoe2DE.png',\n        'palisade': 'defensive_structures/Palisade_wall_aoe2de.png',\n        'palisades': 'defensive_structures/Palisade_wall_aoe2de.png',\n        'wall': 'defensive_structures/Palisade_wall_aoe2de.png',\n        'walls': 'defensive_structures/Palisade_wall_aoe2de.png',\n        'stone wall': 'defensive_structures/Stone_wall_aoe2de.png',\n        'stone walls': 'defensive_structures/Stone_wall_aoe2de.png',\n        'donjon': 'defensive_structures/Donjon_aoe2DE.png',\n        'donjons': 'defensive_structures/Donjon_aoe2DE.png',\n        'wonder': 'other/Wonder_aoe2DE.png',\n        'wonders': 'other/Wonder_aoe2DE.png',\n        'caravanserai': 'other/Ao2de_caravanserai_icon.png',\n        'caravanserais': 'other/Ao2de_caravanserai_icon.png',\n\n        'dark age': 'age/DarkAgeIconDE_alpha.png',\n        'feudal age': 'age/FeudalAgeIconDE_alpha.png',\n        'castle age': 'age/CastleAgeIconDE_alpha.png',\n        'imperial age': 'age/ImperialAgeIconDE_alpha.png',\n\n        'chemistry': 'university/ChemistryDE.png',\n        'double-bit axe': 'lumber_camp/DoubleBitAxe_aoe2DE.png',\n        'horse collar': 'mill/HorseCollarDE.png',\n        'loom': 'town_center/LoomDE.png',\n        'wheelbarrow': 'town_center/WheelbarrowDE.png',\n        'hand cart': 'town_center/HandcartDE.png',\n        'bow saw': 'lumber_camp/BowSawDE.png',\n        'two-man saw': 'lumber_camp/TwoManSawDE.png',\n        'heavy plow': 'mill/HeavyPlowDE.png',\n        'crop rotation': 'mill/CropRotationDE.png',\n        'gold mining': 'mining_camp/GoldMiningDE.png',\n        'gold shaft mining': 'mining_camp/GoldShaftMiningDE.png',\n        'stone mining': 'mining_camp/StoneMiningDE.png',\n        'stone shaft mining': 'mining_camp/StoneShaftMiningDE.png',\n        'gillnets': 'dock/GillnetsDE.png',\n        'fletching': 'blacksmith/FletchingDE.png',\n        'bodkin arrow': 'blacksmith/BodkinArrowDE.png',\n        'bracer': 'blacksmith/BracerDE.png',\n        'padded archer armor': 'blacksmith/PaddedArcherArmorDE.png',\n        'leather archer armor': 'blacksmith/LeatherArcherArmorDE.png',\n        'ring archer armor': 'blacksmith/RingArcherArmorDE.png',\n        'ballistics': 'university/BallisticsDE.png',\n        'thumb ring': 'archery_range/ThumbRingDE.png',\n        'parthian tactics': 'archery_range/ParthianTacticsDE.png',\n        'supplies': 'barracks/Suplliesicon.png',\n        'forging': 'blacksmith/Forging_aoe2de.png',\n        'iron casting': 'blacksmith/IronCastingDE.png',\n        'blast furnace': 'blacksmith/BlastFurnaceDE.png',\n        'scale mail armor': 'blacksmith/ScaleMailArmorDE.png',\n        'chain mail armor': 'blacksmith/ChainMailArmorDE.png',\n        'plate mail armor': 'blacksmith/PlateMailArmorDE.png',\n        'bloodlines': 'stable/BloodlinesDE.png',\n        'husbandry': 'stable/HusbandryDE.png',\n        'scale barding armor': 'blacksmith/ScaleBardingArmorDE.png',\n        'chain barding armor': 'blacksmith/ChainBardingDE.png',\n        'plate barding armor': 'blacksmith/PlateBardingArmorDE.png',\n        'town watch': 'town_center/TownWatchDE.png',\n        'town patrol': 'town_center/TownPatrolDE.png',\n        'careening': 'dock/CareeningDE.png',\n        'dry dock': 'dock/DryDockDE.png',\n        'shipwright': 'dock/ShipwrightDE.png',\n        'man-at-arms': 'barracks/ManAtArmsUpgDE.png',\n        'pikeman': 'barracks/PikemanUpDE.png',\n        'redemption': 'monastery/RedemptionDE.png',\n        'arson': 'barracks/ArsonDE.png',\n        'gambeson': 'barracks/GambesonsDE.png',\n        'gambesons': 'barracks/GambesonsDE.png',\n        'siege elephant': 'siege_workshop/AoE2DE_Siege_Elephant_icon.png',\n        'heavy camel rider': 'stable/HeavyCamelUpgDE.png',\n\n        'vill': 'resource/MaleVillDE.jpg',\n        'vills': 'resource/MaleVillDE.jpg',\n        'villager': 'resource/MaleVillDE.jpg',\n        'villagers': 'resource/MaleVillDE.jpg',\n        'militia': 'barracks/MilitiaDE.png',\n        'militias': 'barracks/MilitiaDE.png',\n        'man at arms': 'barracks/Manatarms_aoe2DE.png',\n        'man-at arms': 'barracks/Manatarms_aoe2DE.png',\n        'men at arms': 'barracks/Manatarms_aoe2DE.png',\n        'men-at arms': 'barracks/Manatarms_aoe2DE.png',\n        'men-at-arms': 'barracks/Manatarms_aoe2DE.png',\n        'longswordsman': 'barracks/Longswordsman_aoe2DE.png',\n        'longswordsmen': 'barracks/Longswordsman_aoe2DE.png',\n        'two-handed swordsman': 'barracks/Twohanded_aoe2DE.png',\n        'two-handed swordsmen': 'barracks/Twohanded_aoe2DE.png',\n        'champion': 'barracks/Champion_aoe2DE.png',\n        'champions': 'barracks/Champion_aoe2DE.png',\n        'spearman': 'barracks/Spearman_aoe2DE.png',\n        'spearmans': 'barracks/Spearman_aoe2DE.png',\n        'halberdier': 'barracks/Halberdier_aoe2DE.png',\n        'halberdiers': 'barracks/Halberdier_aoe2DE.png',\n        'eagle scout': 'barracks/Eaglescout_aoe2DE.png',\n        'eagle scouts': 'barracks/Eaglescout_aoe2DE.png',\n        'eagle warrior': 'barracks/Eaglewarrior_aoe2DE.png',\n        'eagle warriors': 'barracks/Eaglewarrior_aoe2DE.png',\n        'elite eagle warrior': 'barracks/EliteEaglewarrior_aoe2DE.png',\n        'elite eagle warriors': 'barracks/EliteEaglewarrior_aoe2DE.png',\n        'archer': 'archery_range/Archer_aoe2DE.png',\n        'archers': 'archery_range/Archer_aoe2DE.png',\n        'crossbowman': 'archery_range/Crossbowman_aoe2DE.png',\n        'crossbowmen': 'archery_range/Crossbowman_aoe2DE.png',\n        'arbalester': 'archery_range/Arbalester_aoe2DE.png',\n        'arbalesters': 'archery_range/Arbalester_aoe2DE.png',\n        'skirmisher': 'archery_range/Skirmisher_aoe2DE.png',\n        'skirmishers': 'archery_range/Skirmisher_aoe2DE.png',\n        'elite skirmisher': 'archery_range/Elite_skirmisher_aoe2DE.png',\n        'elite skirmishers': 'archery_range/Elite_skirmisher_aoe2DE.png',\n        'imperial skirmisher': 'archery_range/ImperialSkirmisherUpgDE.png',\n        'imperial skirmishers': 'archery_range/ImperialSkirmisherUpgDE.png',\n        'cavalry archer': 'archery_range/Cavalryarcher_aoe2DE.png',\n        'cavalry archers': 'archery_range/Cavalryarcher_aoe2DE.png',\n        'heavy cavalry archer': 'archery_range/Heavycavalryarcher_aoe2de.png',\n        'heavy cavalry archers': 'archery_range/Heavycavalryarcher_aoe2de.png',\n        'elephant archer': 'archery_range/ElephantArcherIcon-DE.png',\n        'elephant archers': 'archery_range/ElephantArcherIcon-DE.png',\n        'elite elephant archer': 'archery_range/ElephantArcherIcon-DE.png',\n        'elite elephant archers': 'archery_range/ElephantArcherIcon-DE.png',\n        'hand cannoneer': 'archery_range/Hand_cannoneer_aoe2DE.png',\n        'hand cannoneers': 'archery_range/Hand_cannoneer_aoe2DE.png',\n\n        'scout': 'stable/Scoutcavalry_aoe2DE.png',\n        'scouts': 'stable/Scoutcavalry_aoe2DE.png',\n        'light cavalry': 'stable/Lightcavalry_aoe2DE.png',\n        'hussar': 'stable/Hussar_aoe2DE.png',\n        'hussars': 'stable/Hussar_aoe2DE.png',\n        'knight': 'stable/Knight_aoe2DE.png',\n        'knights': 'stable/Knight_aoe2DE.png',\n        'cavalier': 'stable/Cavalier_aoe2DE.png',\n        'cavaliers': 'stable/Cavalier_aoe2DE.png',\n        'paladin': 'stable/Paladin_aoe2DE.png',\n        'paladins': 'stable/Paladin_aoe2DE.png',\n        'battle elephant': 'stable/Battle_elephant_aoe2DE.png',\n        'battle elephants': 'stable/Battle_elephant_aoe2DE.png',\n        'elite battle elephant': 'stable/EliteBattleElephantUpg.png',\n        'elite battle elephants': 'stable/EliteBattleElephantUpg.png',\n        'steppe lancer': 'stable/Steppelancericon.png',\n        'steppe lancers': 'stable/Steppelancericon.png',\n        'elite steppe lancer': 'stable/Elitesteppelancericon.png',\n        'elite steppe lancers': 'stable/Elitesteppelancericon.png',\n        'camel rider': 'stable/Camelrider_aoe2DE.png',\n        'camel riders': 'stable/Camelrider_aoe2DE.png',\n\n        'petard': 'castle/Petard_aoe2DE.png',\n        'petards': 'castle/Petard_aoe2DE.png',\n        'bombard cannon': 'siege_workshop/Bombard_cannon_aoe2DE.png',\n        'bombard cannons': 'siege_workshop/Bombard_cannon_aoe2DE.png',\n        'ram': 'siege_workshop/Battering_ram_aoe2DE.png',\n        'rams': 'siege_workshop/Battering_ram_aoe2DE.png',\n        'battering ram': 'siege_workshop/Battering_ram_aoe2DE.png',\n        'battering rams': 'siege_workshop/Battering_ram_aoe2DE.png',\n        'scorpion': 'siege_workshop/Scorpion_aoe2DE.png',\n        'scorpions': 'siege_workshop/Scorpion_aoe2DE.png',\n        'mangonel': 'siege_workshop/Mangonel_aoe2DE.png',\n        'mangonels': 'siege_workshop/Mangonel_aoe2DE.png',\n        'siege tower': 'siege_workshop/Siegetower_aoe2DE.png',\n        'siege towers': 'siege_workshop/Siegetower_aoe2DE.png',\n        'armored elephant': 'siege_workshop/AoE2DE_Armored_Elephant_icon.png',\n        'armored elephants': 'siege_workshop/AoE2DE_Armored_Elephant_icon.png',\n        'monk': 'monastery/Monk_aoe2DE.png',\n        'monks': 'monastery/Monk_aoe2DE.png',\n        'fishing ship': 'dock/FishingShipDE.png',\n        'fishing ships': 'dock/FishingShipDE.png',\n        'galley': 'dock/Galley_aoe2DE.png',\n        'galleys': 'dock/Galley_aoe2DE.png',\n        'fire galley': 'dock/Fire_galley_aoe2DE.png',\n        'fire galleys': 'dock/Fire_galley_aoe2DE.png',\n        'war galley': 'dock/War_galley_aoe2DE.png',\n        'war galleys': 'dock/War_galley_aoe2DE.png',\n\n        'jaguarwarrior': 'unique_unit/JaguarWarriorIcon-DE.png',\n        'jaguar warrior': 'unique_unit/JaguarWarriorIcon-DE.png',\n        'jaguar warriors': 'unique_unit/JaguarWarriorIcon-DE.png',\n        'ratha': 'unique_unit/Aoe2de_ratha_ranged.png',\n        'camelarcher': 'unique_unit/CamelArcherIcon-DE.png',\n        'camel archer': 'unique_unit/CamelArcherIcon-DE.png',\n        'camel archers': 'unique_unit/CamelArcherIcon-DE.png',\n        'genitour': 'unique_unit/GenitourIcon-DE.png',\n        'genitours': 'unique_unit/GenitourIcon-DE.png',\n        'hussitewagon': 'unique_unit/Aoe2-icon-hussite-wagon.png',\n        'hussite wagon': 'unique_unit/Aoe2-icon-hussite-wagon.png',\n        'hussite wagons': 'unique_unit/Aoe2-icon-hussite-wagon.png',\n        'houfnice': 'unique_unit/Aoe2-icon--houfnice.png',\n        'longbowman': 'unique_unit/LongbowmanIcon-DE.png',\n        'longbowmen': 'unique_unit/LongbowmanIcon-DE.png',\n        'konnik': 'unique_unit/Konnikicon.png',\n        'konniks': 'unique_unit/Konnikicon.png',\n        'coustillier': 'unique_unit/Aoe2-icon-coustillier.png',\n        'coustilliers': 'unique_unit/Aoe2-icon-coustillier.png',\n        'flemishmilitia': 'unique_unit/Aoe2-icon-flemish-militia.png',\n        'flemish militia': 'unique_unit/Aoe2-icon-flemish-militia.png',\n        'flemish militias': 'unique_unit/Aoe2-icon-flemish-militia.png',\n        'arambai': 'unique_unit/Arambaiicon-DE.png',\n        'arambais': 'unique_unit/Arambaiicon-DE.png',\n        'cataphract': 'unique_unit/CataphractIcon-DE.png',\n        'cataphracts': 'unique_unit/CataphractIcon-DE.png',\n        'woadraider': 'unique_unit/WoadRaiderIcon-DE.png',\n        'woad raider': 'unique_unit/WoadRaiderIcon-DE.png',\n        'woad raiders': 'unique_unit/WoadRaiderIcon-DE.png',\n        'chukonu': 'unique_unit/ChukoNuIcon-DE.png',\n        'chu ko nu': 'unique_unit/ChukoNuIcon-DE.png',\n        'kipchak': 'unique_unit/Kipchakicon.png',\n        'kipchaks': 'unique_unit/Kipchakicon.png',\n        'urumiswordsman': 'unique_unit/Aoe2de_Urumi.png',\n        'urumi swordsman': 'unique_unit/Aoe2de_Urumi.png',\n        'urumi swordsmen': 'unique_unit/Aoe2de_Urumi.png',\n        'thirisadai': 'unique_unit/Aoe2de_Thirisadai.png',\n        'thirisadais': 'unique_unit/Aoe2de_Thirisadai.png',\n        'shotelwarrior': 'unique_unit/Shotelwarrioricon-DE.png',\n        'shotel warrior': 'unique_unit/Shotelwarrioricon-DE.png',\n        'shotel warriors': 'unique_unit/Shotelwarrioricon-DE.png',\n        'throwingaxeman': 'unique_unit/ThrowingAxemanIcon-DE.png',\n        'throwing axeman': 'unique_unit/ThrowingAxemanIcon-DE.png',\n        'throwing axemen': 'unique_unit/ThrowingAxemanIcon-DE.png',\n        'huskarl': 'unique_unit/HuskarlIcon-DE.png',\n        'huskarls': 'unique_unit/HuskarlIcon-DE.png',\n        'chakramthrower': 'unique_unit/Aoe2de_Chakram.png',\n        'chakram thrower': 'unique_unit/Aoe2de_Chakram.png',\n        'chakram throwers': 'unique_unit/Aoe2de_Chakram.png',\n        'shrivamsharider': 'unique_unit/Aoe2de_shrivamsha_rider.png',\n        'shrivamsha rider': 'unique_unit/Aoe2de_shrivamsha_rider.png',\n        'shrivamsha riders': 'unique_unit/Aoe2de_shrivamsha_rider.png',\n        'camelscout': 'unique_unit/Aoe2de_camel_scout.png',\n        'camel scout': 'unique_unit/Aoe2de_camel_scout.png',\n        'camel scouts': 'unique_unit/Aoe2de_camel_scout.png',\n        'ghulam': 'unique_unit/Aoe2de_Ghulam.png',\n        'ghulams': 'unique_unit/Aoe2de_Ghulam.png',\n        'imperialcamelrider': 'unique_unit/ImperialCamelRiderIcon-DE.png',\n        'imperial camel rider': 'unique_unit/ImperialCamelRiderIcon-DE.png',\n        'imperial camel riders': 'unique_unit/ImperialCamelRiderIcon-DE.png',\n        'tarkan': 'unique_unit/TarkanIcon-DE.png',\n        'tarkans': 'unique_unit/TarkanIcon-DE.png',\n        'kamayuk': 'unique_unit/KamayukIcon-DE.png',\n        'kamayuks': 'unique_unit/KamayukIcon-DE.png',\n        'slinger': 'unique_unit/SlingerIcon-DE.png',\n        'slingers': 'unique_unit/SlingerIcon-DE.png',\n        'genoesecrossbowman': 'unique_unit/GenoeseCrossbowmanIcon-DE.png',\n        'genoese crossbowman': 'unique_unit/GenoeseCrossbowmanIcon-DE.png',\n        'genoese crossbowmen': 'unique_unit/GenoeseCrossbowmanIcon-DE.png',\n        'condottiero': 'unique_unit/CondottieroIcon-DE.png',\n        'samurai': 'unique_unit/SamuraiIcon-DE.png',\n        'samurais': 'unique_unit/SamuraiIcon-DE.png',\n        'ballistaelephant': 'unique_unit/Ballistaelephanticon-DE.png',\n        'ballista elephant': 'unique_unit/Ballistaelephanticon-DE.png',\n        'ballista elephants': 'unique_unit/Ballistaelephanticon-DE.png',\n        'warwagon': 'unique_unit/WarWagonIcon-DE.png',\n        'war wagon': 'unique_unit/WarWagonIcon-DE.png',\n        'war wagons': 'unique_unit/WarWagonIcon-DE.png',\n        'turtleship': 'unique_unit/TurtleShipIcon-DE.png',\n        'turtle ship': 'unique_unit/TurtleShipIcon-DE.png',\n        'turtle ships': 'unique_unit/TurtleShipIcon-DE.png',\n        'leitis': 'unique_unit/Leitisicon.png',\n        'wingedhussar': 'stable/Winged-hussar_upgrade.png',\n        'winged hussar': 'stable/Winged-hussar_upgrade.png',\n        'winged hussars': 'stable/Winged-hussar_upgrade.png',\n        'magyarhuszar': 'unique_unit/MagyarHuszarIcon-DE.png',\n        'magyar huszar': 'unique_unit/MagyarHuszarIcon-DE.png',\n        'magyar huszars': 'unique_unit/MagyarHuszarIcon-DE.png',\n        'karambitwarrior': 'unique_unit/Karambitwarrioricon-DE.png',\n        'karambit warrior': 'unique_unit/Karambitwarrioricon-DE.png',\n        'karambit warriors': 'unique_unit/Karambitwarrioricon-DE.png',\n        'gbeto': 'unique_unit/GbetoIcon-DE.png',\n        'plumedarcher': 'unique_unit/PlumedArcherIcon-DE.png',\n        'plumed archer': 'unique_unit/PlumedArcherIcon-DE.png',\n        'plumed archers': 'unique_unit/PlumedArcherIcon-DE.png',\n        'mangudai': 'unique_unit/MangudaiIcon-DE.png',\n        'mangudais': 'unique_unit/MangudaiIcon-DE.png',\n        'warelephant': 'unique_unit/WarElephantIcon-DE.png',\n        'war elephant': 'unique_unit/WarElephantIcon-DE.png',\n        'war elephants': 'unique_unit/WarElephantIcon-DE.png',\n        'obuch': 'unique_unit/Aoe2-icon--obuch.png',\n        'organgun': 'unique_unit/OrganGunIcon-DE.png',\n        'organ gun': 'unique_unit/OrganGunIcon-DE.png',\n        'organ guns': 'unique_unit/OrganGunIcon-DE.png',\n        'caravel': 'unique_unit/CaravelIcon-DE.png',\n        'caravels': 'unique_unit/CaravelIcon-DE.png',\n        'mameluke': 'unique_unit/MamelukeIcon-DE.png',\n        'mamelukes': 'unique_unit/MamelukeIcon-DE.png',\n        'serjeant': 'unique_unit/Aoe2-icon-serjeant.png',\n        'serjeants': 'unique_unit/Aoe2-icon-serjeant.png',\n        'boyar': 'unique_unit/BoyarIcon-DE.png',\n        'boyars': 'unique_unit/BoyarIcon-DE.png',\n        'conq': 'unique_unit/ConquistadorIcon-DE.png',\n        'conqs': 'unique_unit/ConquistadorIcon-DE.png',\n        'conquistador': 'unique_unit/ConquistadorIcon-DE.png',\n        'conquistadors': 'unique_unit/ConquistadorIcon-DE.png',\n        'missionary': 'unique_unit/MissionaryIcon-DE.png',\n        'missionaries': 'unique_unit/MissionaryIcon-DE.png',\n        'keshik': 'unique_unit/Keshikicon.png',\n        'keshiks': 'unique_unit/Keshikicon.png',\n        'flamingcamel': 'unique_unit/Flaming_camel_icon.png',\n        'flaming camel': 'unique_unit/Flaming_camel_icon.png',\n        'flaming camels': 'unique_unit/Flaming_camel_icon.png',\n        'teutonicknight': 'unique_unit/TeutonicKnightIcon-DE.png',\n        'teutonic knight': 'unique_unit/TeutonicKnightIcon-DE.png',\n        'teutonic knights': 'unique_unit/TeutonicKnightIcon-DE.png',\n        'janissary': 'unique_unit/JanissaryIcon-DE.png',\n        'janissaries': 'unique_unit/JanissaryIcon-DE.png',\n        'rattanarcher': 'unique_unit/Rattanarchericon-DE.png',\n        'rattan archer': 'unique_unit/Rattanarchericon-DE.png',\n        'rattan archers': 'unique_unit/Rattanarchericon-DE.png',\n        'berserk': 'unique_unit/BerserkIcon-DE.png',\n        'berserks': 'unique_unit/BerserkIcon-DE.png',\n        'longboat': 'unique_unit/LongboatIcon-DE.png',\n        'longboats': 'unique_unit/LongboatIcon-DE.png'\n    };\n}\n\n/** Convert JSON string to text output.\n *\n * @param input    JSON string input to convert\n *\n * @returns    converted text content\n */\nexport const htmlDecode = (input: string) => {\n    if (typeof window === 'undefined') return input;\n    const doc = new DOMParser().parseFromString(input, 'text/html');\n    return doc.documentElement.textContent || \"\";\n}\n\n/** Trim the white spaces at the beginning and end of string.\n *  Note: re-implemented to be compatible with old browsers.\n * \n * @param x     input string\n *\n * @returns    string with initial and last spaces trimmed\n */\nfunction trim(x: string) {\n    return x.replace(/^\\s+|\\s+$/gm, '');\n}\n\n/** Trim the white spaces at the beginning of string.\n *  Note: re-implemented to be compatible with old browsers.\n * \n * @param x     input string\n *\n * @returns    string with initial spaces trimmed\n */\nfunction ltrim(x: string) {\n    return x.replace(/^\\s+/gm, '');\n}\n\n/** Convert a note written as only TXT to a note with illustrated format, looking initially for\n *  patterns of maximal size, and then decreasing progressively the size of the checked patterns. \n * \n * @param note            note in raw TXT\n * @param convertDict     dictionary for conversions\n * @param toLower         true to look in the dictionary with key set in lower case\n * @param maxSize         maximal size of the split note pattern, less than 1 to take the full split length\n * @param ignoreInDict    list of symbols to ignore when checking if it is in the dictionary\n *\n * @returns    note updated (potentially with illustration)\n */\nexport const convertTxtToIllustrated = (note: string, convertDict: Record<string, string>, toLower = false, maxSize = -1, ignoreInDict: string[] = []): string => {\n\n    const noteSplit = note.split(' ');  // note split based on spaces\n    const splitCount = noteSplit.length;  // number of elements in the split\n\n    if (splitCount < 1) {  // safety if no element\n        return '';\n    }\n\n    // initial gather count size\n    const initGatherCount = (maxSize < 1) ? splitCount : maxSize;\n\n    for (let gatherCount = initGatherCount; gatherCount > 0; gatherCount--) {  // number of elements to gather for dictionary check\n\n        const setCount = splitCount - gatherCount + 1;  // number of gather sets that can be made\n\n        for (let firstID = 0; firstID < setCount; firstID++) {  // ID of the first element\n\n            let checkNote = noteSplit[firstID];\n            for (let nextElemID = firstID + 1; nextElemID < firstID + gatherCount; nextElemID++) {  // gather the next elements\n                checkNote += ' ' + noteSplit[nextElemID];\n            }\n\n            let updatedCheckNote = checkNote;  // update based on requests\n\n            for (const ignoreElem of ignoreInDict) {  // ignore parts in dictionary\n                updatedCheckNote = updatedCheckNote.replace(ignoreElem, '');\n            }\n\n            if (toLower) {  // to lower case\n                updatedCheckNote = updatedCheckNote.toLowerCase();\n            }\n\n            if (updatedCheckNote in convertDict) {  // note to check is available in dictionary\n\n                // used to retrieve ignored parts\n                let ignoreBefore = '';\n                let ignoreAfter = '';\n\n                if (ignoreInDict.length > 0) {\n                    const checkNoteLen = checkNote.length;\n\n                    // get back ignored parts (before dictionary replace)\n                    for (let characterID = 0; characterID < checkNoteLen; characterID++) {\n                        if (ignoreInDict.includes(checkNote[characterID])) {\n                            ignoreBefore += checkNote[characterID];\n                        }\n                        else {\n                            break;\n                        }\n                    }\n\n                    // get back ignored parts (after dictionary replace)\n                    for (let characterID = checkNoteLen - 1; characterID >= 0; characterID--) {\n                        if (ignoreInDict.includes(checkNote[characterID])) {\n                            ignoreAfter += checkNote[characterID]\n                        }\n                        else {\n                            break;\n                        }\n                    }\n                    if (ignoreAfter !== '') {  // reverse order\n                        ignoreAfter = ignoreAfter.split('').reverse().join('');\n                    }\n                }\n\n                let beforeNote = '';  // gather note parts before the found sub-note\n                for (let beforeID = 0; beforeID < firstID; beforeID++) {\n                    beforeNote += ' ' + noteSplit[beforeID];\n                }\n                beforeNote = ltrim(beforeNote);\n\n                let afterNote = '';  // gather note parts after the found sub-note\n                for (let afterID = firstID + gatherCount; afterID < splitCount; afterID++) {\n                    afterNote += ' ' + noteSplit[afterID];\n                }\n                afterNote = ltrim(afterNote);\n\n                // compose final note with part before, sub-note found and part after\n                let finalNote = '';\n                if (beforeNote !== '') {\n                    finalNote += convertTxtToIllustrated(beforeNote, convertDict, toLower, maxSize, ignoreInDict) + ' ';\n                }\n\n                finalNote += ignoreBefore + '@' + convertDict[updatedCheckNote] + '@' + ignoreAfter;\n\n                if (afterNote !== '') {\n                    finalNote += ' ' + convertTxtToIllustrated(afterNote, convertDict, toLower, maxSize, ignoreInDict);\n                }\n\n                return finalNote;\n            }\n        }\n    }\n\n    // note (and sub-notes parts) not found, returning the initial TXT note\n    return note;\n}\n\n/** Get an object element, checking if it exists (and providing a default value if it does not exist).\n * \n * @param item            item object to check\n * @param name            name of the requested property of the item object \n * @param defaultValue    default value to return in case the requested name is not found\n *\n * @returns    value of the requested item, defaut value if not found\n */\nconst getElemSafe = (item: Record<string, unknown>, name: string, defaultValue: unknown) => {\n    return item.hasOwnProperty(name) ? item[name] : defaultValue;\n}\n\n/** Compute the contribution of a requested resource, even if it does not exist.\n * \n * @param resources    object with the different resources\n * @param name         name of the property to look for\n *\n * @returns    requested resource contribution value\n */\nconst resourceContribution = (resources: Record<string, number>, name: string) => {\n    if (resources.hasOwnProperty(name)) { // resource value stored\n        return resources[name] >= 0 ? resources[name] : 0;\n    }\n    else { // resource not stored, return 0\n        return 0;\n    }\n}\n\n/** Update the age ID (1:Dark, 2:Feudal, 3:Castle, 4:Imperial).\n * \n * @param currentAge    current age ID\n * @param step          current BO step\n *\n * @returns    updated age ID\n */\nconst updateAge = (currentAge: number, step: BuildOrderStep) => {\n    if (step.type === \"ageUp\" || step.type === \"newAge\") {\n        const age = step.age;\n\n        if (age === \"darkAge\") return 1;\n        else if (age === \"feudalAge\") return 2;\n        else if (age === \"castleAge\") return 3;\n        else if (age === \"imperialAge\") return 4;\n        else return currentAge;\n    }\n    else { // no age update\n        return currentAge;\n    }\n}\n\n/** Get the age icon string sequence for each age ID\n * \n * @param ageID    age ID (1:Dark, 2:Feudal, 3:Castle, 4:Imperial)\n *\n * @returns    string to add image of age ('Unknown age' if wrong ID)\n */\nconst getAgeIcon = (ageID: number) => {\n    if (ageID === 1) return '@age/DarkAgeIconDE_alpha.png@';\n    else if (ageID === 2) return '@age/FeudalAgeIconDE_alpha.png@';\n    else if (ageID === 3) return '@age/CastleAgeIconDE_alpha.png@';\n    else if (ageID === 4) return '@age/ImperialAgeIconDE_alpha.png@';\n    else return 'Unknown age';\n}\n\n/** Check if 2 sets of resources are identical.\n * \n * @param resourcesA    first set of resources to compare\n * @param resourcesB    second set of resources to compare\n *\n * @returns    true if identical resources\n */\nconst isIdenticalResources = (resourcesA: Record<string, number>, resourcesB: Record<string, number>) => {\n    return (resourcesA.wood === resourcesB.wood) &&\n        (resourcesA.food === resourcesB.food) &&\n        (resourcesA.gold === resourcesB.gold) &&\n        (resourcesA.stone === resourcesB.stone) &&\n        (resourcesA.builder === resourcesB.builder);\n}\n\n// Helper to get text representation of a step\nconst getStepText = (step: BuildOrderStep): string => {\n    switch (step.type) {\n        case \"newVillagers\":\n            return `Create ${step.count} villagers on ${step.task}`;\n        case \"moveVillagers\":\n            return `Move ${step.count} villagers from ${step.from} to ${step.to}`;\n        case \"lure\":\n            return `Lure ${step.count} ${step.animal}`;\n        case \"research\":\n            return `Research ${step.tech.join(\", \")}`;\n        case \"ageUp\":\n            return `Click up to ${step.age}`;\n        case \"newAge\":\n            return `Reach ${step.age}`;\n        case \"build\":\n            return `Build ${step.buildings.map(b => `${b.count} ${b.type}`).join(\", \")}`;\n        case \"custom\":\n            return step.text;\n        case \"trade\":\n            return `${step.action === 'buy' ? 'Buy' : 'Sell'} ${step.count} ${step.resource}`;\n        case \"trainUnit\":\n            return `Train ${step.count} ${step.unit}`;\n        case \"collectGold\":\n            return `Collect ${step.count} gold with ${step.task}`;\n        case \"decision\":\n            return `Decision: ${step.text}`;\n        default:\n            return \"Unknown step\";\n    }\n}\n\n/** Copy build order to clipboard for RTS Overlay.\n * https://github.com/CraftySalamander/RTS_Overlay\n * \n * @param build - build object with the build order information\n *\n * @returns Promise that resolves when copy is done\n */\nexport const exportForRTSOverlay = async (build: Build): Promise<void> => {\n\n    // start JSON Obj\n    const jsonObj: Record<string, unknown> = {\n        name: getElemSafe(build as unknown as Record<string, unknown>, 'title', 'Unkown title'),\n        civilization: getElemSafe(build as unknown as Record<string, unknown>, 'civilization', 'Any'),\n        author: getElemSafe(build as unknown as Record<string, unknown>, 'author', 'Build Order Guide'),\n        source: getElemSafe(build as unknown as Record<string, unknown>, 'source', 'https://buildorderguide.com'),\n        description: getElemSafe(build as unknown as Record<string, unknown>, 'description', ''),\n        build_order: []\n    };\n\n    // update civilizations for RTS Overlay\n    if (jsonObj['civilization'] === 'Generic') {\n        jsonObj['civilization'] = 'Any';\n    }\n    else if (jsonObj['civilization'] === 'Meso') {\n        jsonObj['civilization'] = ['Aztecs', 'Incas', 'Mayans'];\n    }\n\n    // obtain the BO steps\n    const steps = build.build || [];\n    const stepsCount = steps.length;\n\n    let currentAge = 1; // start in first Age (Dark Age)\n\n    // store previous resources\n    let previousResources: Record<string, number> = {\n        wood: -1,\n        food: -1,\n        gold: -1,\n        stone: -1,\n        builder: -1\n    };\n\n    // get the conversion dictionary\n    const convertDict = getImagesDictionary();\n\n    let ageUpFlag = false; // true when step type is 'ageUp' (starting next step, until 'newAge')\n    let newAgeFlag = false; // true when step type is 'newAge' (only used for next step)\n    let newStepAge = false; // true to use a new step following 'ageUp' or 'newAge'\n\n    // loop on all the steps\n    for (let i = 0; i < stepsCount; i++) {\n        const step = steps[i];\n\n        // resources\n        const resources = step.resources || {\n            wood: -1,\n            food: -1,\n            gold: -1,\n            stone: -1,\n            build: -1\n        };\n\n        // store new resources\n        const newResources: Record<string, number> = {\n            wood: getElemSafe(resources as unknown as Record<string, unknown>, 'wood', -1) as number,\n            food: getElemSafe(resources as unknown as Record<string, unknown>, 'food', -1) as number,\n            gold: getElemSafe(resources as unknown as Record<string, unknown>, 'gold', -1) as number,\n            stone: getElemSafe(resources as unknown as Record<string, unknown>, 'stone', -1) as number,\n            builder: getElemSafe(resources as unknown as Record<string, unknown>, 'build', -1) as number\n        };\n        // do not display builder if no builder for this step\n        if (newResources['builder'] === 0) {\n            newResources['builder'] = -1;\n        }\n\n        // count the number of villagers\n        const newVillagerCount =\n            resourceContribution(newResources, 'wood') +\n            resourceContribution(newResources, 'food') +\n            resourceContribution(newResources, 'gold') +\n            resourceContribution(newResources, 'stone') +\n            resourceContribution(newResources, 'builder');\n\n        // naw age started\n        if (step.type === 'newAge') {\n            ageUpFlag = false;\n            newAgeFlag = true;\n            newStepAge = true;\n            continue; // skip (nothing to add)\n        }\n\n        // convert note to Overlay format\n        let rawNote = trim(getStepText(step));\n        if (step.type === 'decision') { // special case for choice\n            rawNote = step.text;\n        }\n        const newNote = convertTxtToIllustrated(rawNote, convertDict, true, 3, []);\n\n        // check if we should still use the previous step\n        let usePreviousStep = false;\n\n        let ageUpNote = '';\n        if (ageUpFlag || newAgeFlag) { // going to next age or reaching it\n            usePreviousStep = ((jsonObj['build_order'] as unknown[]).length >= 1) && !newStepAge;\n            ageUpNote = (ageUpFlag ? 'Before ' : 'In ') + getAgeIcon(currentAge);\n            newStepAge = false;\n        }\n        else { // normal step\n            usePreviousStep = (((jsonObj['build_order'] as unknown[]).length >= 1) &&\n                isIdenticalResources(newResources, previousResources)); // no resource count change\n        }\n\n        // copy the resources for storing\n        const storeResources: Record<string, number> = Object.assign({}, newResources);\n        if (storeResources['builder'] === -1) { // remove builder if not set\n            delete storeResources['builder'];\n        }\n\n        if (usePreviousStep) { // use previous BO step\n            const previousID = (jsonObj['build_order'] as unknown[]).length - 1; // ID of the previous BO step\n\n            (jsonObj['build_order'] as Record<string, unknown>[])[previousID].villager_count = newVillagerCount;\n            (jsonObj['build_order'] as Record<string, unknown>[])[previousID].age = currentAge;\n            (jsonObj['build_order'] as Record<string, unknown>[])[previousID].resources = storeResources;\n            ((jsonObj['build_order'] as Record<string, unknown>[])[previousID].notes as unknown[]).push(newNote);\n        }\n        else { // new BO step\n            // new step element for the JSON format\n            const newStepJson: Record<string, unknown> = {\n                villager_count: newVillagerCount,\n                age: currentAge,\n                resources: storeResources,\n                notes: []\n            };\n            if (ageUpNote !== '') {\n                (newStepJson['notes'] as unknown[]).push(ageUpNote);\n            }\n            if (newNote !== '') {\n                (newStepJson['notes'] as unknown[]).push(newNote);\n            }\n\n            // add new step\n            (jsonObj['build_order'] as unknown[]).push(newStepJson);\n        }\n\n        // store previous resources\n        previousResources = newResources;\n\n        // check if age up flag (to use from next step until 'newAge')\n        if (step.type === 'ageUp') {\n            ageUpFlag = true;\n            newAgeFlag = false;\n            newStepAge = true;\n\n            // update current age (starting next step)\n            currentAge = updateAge(currentAge, step);\n        }\n\n        // new age flag disappears at the end of the step following its rise\n        newAgeFlag = false;\n    }\n\n    const str = JSON.stringify(jsonObj, null, 4); // JSON to output string\n\n    // save to clipboard\n    try {\n        await navigator.clipboard.writeText(htmlDecode(str));\n    } catch (err) {\n        console.error('Could not copy text: ', err);\n        throw err;\n    }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 6909, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/ExportButton.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\nimport { Build } from \"@/types/build\";\nimport { exportForRTSOverlay } from \"@/utils/rtsOverlayExport\";\nimport Image from \"next/image\";\nimport Button from \"./Button\";\n\ninterface ExportButtonProps {\n  build: Build;\n  fullWidth?: boolean;\n}\n\nexport default function ExportButton({\n  build,\n  fullWidth = false,\n}: ExportButtonProps) {\n  const [isExporting, setIsExporting] = useState(false);\n  const [showSuccess, setShowSuccess] = useState(false);\n\n  const handleExport = async () => {\n    setIsExporting(true);\n    try {\n      await exportForRTSOverlay(build);\n      setShowSuccess(true);\n      setTimeout(() => setShowSuccess(false), 3000);\n    } catch (error) {\n      console.error(\"Export failed:\", error);\n      alert(\"Failed to copy to clipboard. Please try again.\");\n    } finally {\n      setIsExporting(false);\n    }\n  };\n\n  return (\n    <div className={`relative ${fullWidth ? \"w-full\" : \"inline-block\"}`}>\n      <Button\n        onClick={handleExport}\n        disabled={isExporting}\n        variant=\"secondary\"\n        fullWidth={fullWidth}\n        title=\"Copy to clipboard for RTS Overlay\"\n      >\n        <span className=\"flex items-center justify-center gap-2\">\n          <Image\n            src=\"/images/Other/rts_overlay-icon.png\"\n            alt=\"RTS Overlay\"\n            width={20}\n            height={20}\n            className=\"opacity-80\"\n          />\n          <span>{isExporting ? \"Exporting...\" : \"Export for RTS\"}</span>\n        </span>\n      </Button>\n\n      {showSuccess && (\n        <div className=\"absolute top-full left-1/2 transform -translate-x-1/2 mt-2 px-3 py-1 bg-primary text-primary-foreground text-xs rounded shadow-lg whitespace-nowrap z-50 animate-in fade-in slide-in-from-top-1\">\n          Copied to clipboard!\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;AACA;;;AANA;;;;;AAae,SAAS,aAAa,KAGjB;QAHiB,EACnC,KAAK,EACL,YAAY,KAAK,EACC,GAHiB;;IAInC,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAC/C,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,MAAM,eAAe;QACnB,eAAe;QACf,IAAI;YACF,MAAM,CAAA,GAAA,mIAAA,CAAA,sBAAmB,AAAD,EAAE;YAC1B,eAAe;YACf,WAAW,IAAM,eAAe,QAAQ;QAC1C,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,kBAAkB;YAChC,MAAM;QACR,SAAU;YACR,eAAe;QACjB;IACF;IAEA,qBACE,6LAAC;QAAI,WAAW,AAAC,YAAiD,OAAtC,YAAY,WAAW;;0BACjD,6LAAC,+HAAA,CAAA,UAAM;gBACL,SAAS;gBACT,UAAU;gBACV,SAAQ;gBACR,WAAW;gBACX,OAAM;0BAEN,cAAA,6LAAC;oBAAK,WAAU;;sCACd,6LAAC,gIAAA,CAAA,UAAK;4BACJ,KAAI;4BACJ,KAAI;4BACJ,OAAO;4BACP,QAAQ;4BACR,WAAU;;;;;;sCAEZ,6LAAC;sCAAM,cAAc,iBAAiB;;;;;;;;;;;;;;;;;YAIzC,6BACC,6LAAC;gBAAI,WAAU;0BAAkM;;;;;;;;;;;;AAMzN;GAjDwB;KAAA","debugId":null}},
    {"offset": {"line": 7011, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/InteractiveRating.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState } from \"react\";\n\ninterface InteractiveRatingProps {\n  currentRating?: number;\n  onRate?: (rating: number) => void;\n  onSelect?: (rating: number) => void;\n  disabled?: boolean;\n  showContainer?: boolean;\n  className?: string;\n  showTitle?: boolean;\n  showStatusText?: boolean;\n}\n\nexport default function InteractiveRating({\n  currentRating = 0,\n  onRate,\n  onSelect,\n  disabled = false,\n  showContainer = true,\n  className = \"\",\n  showTitle = true,\n  showStatusText = true,\n}: InteractiveRatingProps) {\n  const [hoverRating, setHoverRating] = useState<number>(0);\n\n  const handleMouseEnter = (rating: number) => {\n    if (!disabled) {\n      setHoverRating(rating);\n    }\n  };\n\n  const handleMouseLeave = () => {\n    setHoverRating(0);\n  };\n\n  const handleClick = (rating: number) => {\n    if (!disabled) {\n      if (onSelect) {\n        onSelect(rating);\n      } else if (onRate) {\n        onRate(rating);\n      }\n    }\n  };\n\n  const getStarColor = (starNumber: number) => {\n    const activeRating = hoverRating || currentRating;\n    return starNumber <= activeRating ? \"text-primary\" : \"text-muted\";\n  };\n\n  const content = (\n    <>\n      {(showTitle || showStatusText) && (\n        <div className=\"text-center mb-4\">\n          {showTitle && (\n            <h3 className=\"text-lg font-bold text-foreground mb-2\">\n              Rate this build\n            </h3>\n          )}\n          {showStatusText && (\n            <p className=\"text-sm text-foreground/70\">\n              {currentRating > 0\n                ? `You rated this build ${currentRating} star${currentRating !== 1 ? \"s\" : \"\"}`\n                : \"Click a star to rate this build\"}\n            </p>\n          )}\n        </div>\n      )}\n      \n      <div className=\"flex justify-center space-x-2\">\n        {[1, 2, 3, 4, 5].map((starNumber) => (\n          <button\n            key={starNumber}\n            className={`${\n              disabled \n                ? \"cursor-not-allowed opacity-50\" \n                : \"cursor-pointer hover:scale-110 transition-transform duration-200\"\n            } p-1`}\n            onClick={() => handleClick(starNumber)}\n            onMouseEnter={() => handleMouseEnter(starNumber)}\n            disabled={disabled}\n            aria-label={`Rate ${starNumber} stars`}\n          >\n            <svg\n              className={`w-8 h-8 ${getStarColor(starNumber)}`}\n              fill=\"currentColor\"\n              viewBox=\"0 0 20 20\"\n            >\n              <path d=\"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z\" />\n            </svg>\n          </button>\n        ))}\n      </div>\n    </>\n  );\n\n  const wrapperClasses = showContainer\n    ? \"bg-background rounded-default shadow-default p-6 w-full max-w-md mx-auto\"\n    : \"w-full\";\n\n  return (\n    <div\n      className={`${wrapperClasses} ${className}`}\n      onMouseLeave={handleMouseLeave}\n    >\n      {content}\n    </div>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;;;AAFA;;AAee,SAAS,kBAAkB,KASjB;QATiB,EACxC,gBAAgB,CAAC,EACjB,MAAM,EACN,QAAQ,EACR,WAAW,KAAK,EAChB,gBAAgB,IAAI,EACpB,YAAY,EAAE,EACd,YAAY,IAAI,EAChB,iBAAiB,IAAI,EACE,GATiB;;IAUxC,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAU;IAEvD,MAAM,mBAAmB,CAAC;QACxB,IAAI,CAAC,UAAU;YACb,eAAe;QACjB;IACF;IAEA,MAAM,mBAAmB;QACvB,eAAe;IACjB;IAEA,MAAM,cAAc,CAAC;QACnB,IAAI,CAAC,UAAU;YACb,IAAI,UAAU;gBACZ,SAAS;YACX,OAAO,IAAI,QAAQ;gBACjB,OAAO;YACT;QACF;IACF;IAEA,MAAM,eAAe,CAAC;QACpB,MAAM,eAAe,eAAe;QACpC,OAAO,cAAc,eAAe,iBAAiB;IACvD;IAEA,MAAM,wBACJ;;YACG,CAAC,aAAa,cAAc,mBAC3B,6LAAC;gBAAI,WAAU;;oBACZ,2BACC,6LAAC;wBAAG,WAAU;kCAAyC;;;;;;oBAIxD,gCACC,6LAAC;wBAAE,WAAU;kCACV,gBAAgB,IACb,AAAC,wBAA4C,OAArB,eAAc,SAAsC,OAA/B,kBAAkB,IAAI,MAAM,MACzE;;;;;;;;;;;;0BAMZ,6LAAC;gBAAI,WAAU;0BACZ;oBAAC;oBAAG;oBAAG;oBAAG;oBAAG;iBAAE,CAAC,GAAG,CAAC,CAAC,2BACpB,6LAAC;wBAEC,WAAW,AAAC,GAIX,OAHC,WACI,kCACA,oEACL;wBACD,SAAS,IAAM,YAAY;wBAC3B,cAAc,IAAM,iBAAiB;wBACrC,UAAU;wBACV,cAAY,AAAC,QAAkB,OAAX,YAAW;kCAE/B,cAAA,6LAAC;4BACC,WAAW,AAAC,WAAmC,OAAzB,aAAa;4BACnC,MAAK;4BACL,SAAQ;sCAER,cAAA,6LAAC;gCAAK,GAAE;;;;;;;;;;;uBAhBL;;;;;;;;;;;;IAwBf,MAAM,iBAAiB,gBACnB,6EACA;IAEJ,qBACE,6LAAC;QACC,WAAW,AAAC,GAAoB,OAAlB,gBAAe,KAAa,OAAV;QAChC,cAAc;kBAEb;;;;;;AAGP;GA/FwB;KAAA","debugId":null}},
    {"offset": {"line": 7138, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/RatingModal.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState } from \"react\";\nimport Button from \"./Button\";\nimport InteractiveRating from \"./InteractiveRating\";\n\ninterface RatingModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  userRating: number;\n  onRate: (rating: number) => Promise<void> | void;\n  submitting: boolean;\n}\n\nexport default function RatingModal({\n  isOpen,\n  onClose,\n  userRating,\n  onRate,\n  submitting,\n}: RatingModalProps) {\n  const [selectedRating, setSelectedRating] = useState<number>(userRating || 0);\n\n  useEffect(() => {\n    if (isOpen) {\n      setSelectedRating(userRating || 0);\n    }\n  }, [isOpen, userRating]);\n\n  if (!isOpen) return null;\n\n  const handleConfirm = async () => {\n    if (!selectedRating) {\n      onClose();\n      return;\n    }\n\n    try {\n      await onRate(selectedRating);\n      onClose();\n    } catch (error) {\n      console.error(\"Failed to submit rating\", error);\n    }\n  };\n\n  return (\n    <>\n      <div\n        className=\"fixed inset-0 bg-muted/80 z-50 backdrop-blur-sm cursor-pointer\"\n        onClick={onClose}\n      />\n\n      <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 pointer-events-none\">\n        <div className=\"bg-background rounded-default shadow-hover max-w-lg w-full p-6 border border-foreground/10 pointer-events-auto\">\n          <div className=\"flex items-start justify-between gap-4 mb-4\">\n            <div className=\"space-y-1\">\n              <h3 className=\"text-xl font-bold text-foreground\">\n                Rate this build\n              </h3>\n            </div>\n          </div>\n\n          <div className=\"mb-2\" />\n\n          <InteractiveRating\n            currentRating={selectedRating}\n            onSelect={setSelectedRating}\n            disabled={submitting}\n            showContainer={false}\n            showTitle={false}\n          />\n\n          <div className=\"mt-6 flex justify-end gap-3\">\n            <Button onClick={onClose} variant=\"secondary\" type=\"button\">\n              Cancel\n            </Button>\n            <Button\n              onClick={handleConfirm}\n              disabled={!selectedRating || submitting}\n              type=\"button\"\n            >\n              {submitting ? \"Saving...\" : \"Confirm\"}\n            </Button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;;AAJA;;;;AAce,SAAS,YAAY,KAMjB;QANiB,EAClC,MAAM,EACN,OAAO,EACP,UAAU,EACV,MAAM,EACN,UAAU,EACO,GANiB;;IAOlC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,CAAA,GAAA,6JAAA,CAAA,WAAQ,AAAD,EAAU,cAAc;IAE3E,CAAA,GAAA,6JAAA,CAAA,YAAS,AAAD;iCAAE;YACR,IAAI,QAAQ;gBACV,kBAAkB,cAAc;YAClC;QACF;gCAAG;QAAC;QAAQ;KAAW;IAEvB,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,gBAAgB;QACpB,IAAI,CAAC,gBAAgB;YACnB;YACA;QACF;QAEA,IAAI;YACF,MAAM,OAAO;YACb;QACF,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,2BAA2B;QAC3C;IACF;IAEA,qBACE;;0BACE,6LAAC;gBACC,WAAU;gBACV,SAAS;;;;;;0BAGX,6LAAC;gBAAI,WAAU;0BACb,cAAA,6LAAC;oBAAI,WAAU;;sCACb,6LAAC;4BAAI,WAAU;sCACb,cAAA,6LAAC;gCAAI,WAAU;0CACb,cAAA,6LAAC;oCAAG,WAAU;8CAAoC;;;;;;;;;;;;;;;;sCAMtD,6LAAC;4BAAI,WAAU;;;;;;sCAEf,6LAAC,0IAAA,CAAA,UAAiB;4BAChB,eAAe;4BACf,UAAU;4BACV,UAAU;4BACV,eAAe;4BACf,WAAW;;;;;;sCAGb,6LAAC;4BAAI,WAAU;;8CACb,6LAAC,+HAAA,CAAA,UAAM;oCAAC,SAAS;oCAAS,SAAQ;oCAAY,MAAK;8CAAS;;;;;;8CAG5D,6LAAC,+HAAA,CAAA,UAAM;oCACL,SAAS;oCACT,UAAU,CAAC,kBAAkB;oCAC7B,MAAK;8CAEJ,aAAa,cAAc;;;;;;;;;;;;;;;;;;;;;;;;;AAO1C;GA1EwB;KAAA","debugId":null}},
    {"offset": {"line": 7289, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/components/FavoriteButton.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n\ninterface FavoriteButtonProps {\n  isFavorited: boolean;\n  onToggle: (e?: React.MouseEvent) => void;\n}\n\nexport default function FavoriteButton({\n  isFavorited,\n  onToggle,\n}: FavoriteButtonProps) {\n  return (\n    <button \n      className={`transition-colors duration-200 ${isFavorited ? \"text-cancel\" : \"text-muted hover:text-cancel\"}`}\n      onClick={(e) => {\n        e.stopPropagation();\n        onToggle(e);\n      }}\n      aria-label={isFavorited ? \"Remove from favorites\" : \"Add to favorites\"}\n    >\n      <svg\n        className=\"w-6 h-6\"\n        fill={isFavorited ? \"currentColor\" : \"none\"}\n        stroke=\"currentColor\"\n        viewBox=\"0 0 24 24\"\n      >\n        <path\n          strokeLinecap=\"round\"\n          strokeLinejoin=\"round\"\n          strokeWidth={2}\n          d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\"\n        />\n      </svg>\n    </button>\n  );\n}"],"names":[],"mappings":";;;;AAAA;;AASe,SAAS,eAAe,KAGjB;QAHiB,EACrC,WAAW,EACX,QAAQ,EACY,GAHiB;IAIrC,qBACE,6LAAC;QACC,WAAW,AAAC,kCAA8F,OAA7D,cAAc,gBAAgB;QAC3E,SAAS,CAAC;YACR,EAAE,eAAe;YACjB,SAAS;QACX;QACA,cAAY,cAAc,0BAA0B;kBAEpD,cAAA,6LAAC;YACC,WAAU;YACV,MAAM,cAAc,iBAAiB;YACrC,QAAO;YACP,SAAQ;sBAER,cAAA,6LAAC;gBACC,eAAc;gBACd,gBAAe;gBACf,aAAa;gBACb,GAAE;;;;;;;;;;;;;;;;AAKZ;KA5BwB","debugId":null}},
    {"offset": {"line": 7342, "column": 0}, "map": {"version":3,"sources":["file:///Users/johannesberger/Developer/buildorderguide/src/app/builds/%5Bid%5D/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport { useParams, useRouter } from \"next/navigation\";\nimport Navigation from \"@/components/Navigation\";\nimport { useAuth } from \"@/contexts/AuthContext\";\nimport VillagerCounts from \"@/components/VillagerCounts\";\nimport Rating from \"@/components/Rating\";\nimport Button from \"@/components/Button\";\nimport CivIcon from \"@/components/CivIcon\";\nimport AttributeBadges from \"@/components/AttributeBadges\";\nimport LoadingSpinner from \"@/components/LoadingSpinner\";\nimport EmptyState from \"@/components/EmptyState\";\nimport Header from \"@/components/Header\";\nimport DifficultyBadge from \"@/components/DifficultyBadge\";\nimport DatabaseService from \"@/lib/database\";\nimport { Build } from \"@/types/build\";\nimport Image from \"next/image\";\nimport BuildView from \"@/components/BuildView\";\nimport AuthPromptModal from \"@/components/AuthPromptModal\";\nimport ExportButton from \"@/components/ExportButton\";\nimport RatingModal from \"@/components/RatingModal\";\nimport FavoriteButton from \"@/components/FavoriteButton\";\n\n// Loading Component\nconst LoadingView = () => (\n  <div className=\"min-h-screen bg-background\">\n    <Navigation />\n    <main className=\"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8\">\n      <div className=\"px-4 py-6 sm:px-0\">\n        <div className=\"text-center py-12\">\n          <LoadingSpinner label=\"Loading build...\" />\n        </div>\n      </div>\n    </main>\n  </div>\n);\n\n// Error Component\nconst ErrorView = ({ error }: { error: string | null }) => (\n  <div className=\"min-h-screen bg-background\">\n    <Navigation />\n    <main className=\"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8\">\n      <div className=\"px-4 py-6 sm:px-0\">\n        <EmptyState text={error || \"The requested build could not be found.\"} />\n      </div>\n    </main>\n  </div>\n);\n\n// Header Component\nconst BuildHeader = ({\n  build,\n  userRating,\n  onOpenRating,\n  onStartFocus,\n  isFavorited,\n  onToggleFavorite,\n}: {\n  build: Build;\n  userRating: number;\n  onOpenRating: () => void;\n  onStartFocus?: () => void;\n  isFavorited: boolean;\n  onToggleFavorite: () => void;\n}) => {\n  const placeholderImage = \"/images/Other/BuildImagePlaceholder.png\";\n  const canUseFocusMode = Array.isArray(build.build) && build.build.length > 0;\n  const ratingButtonLabel =\n    userRating > 0 ? `Update rating (${userRating}/5)` : \"Rate this build\";\n\n  return (\n    <div className=\"text-center mb-6\">\n      {/* Civ */}\n      <div className=\"flex items-center justify-center mb-2\">\n        <CivIcon civilization={build.civilization} showName={true} />\n      </div>\n\n      {/* Title */}\n      <Header text={build.title} />\n\n      {/* Author and source */}\n      <p className=\"text-sm text-foreground -mt-4 mb-4\">\n        {build.source ? (\n          <a\n            href={build.source}\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"underline hover:text-primary transition-colors\"\n          >\n            {build.author || \"??\"}\n          </a>\n        ) : (\n          build.author || \"??\"\n        )}\n      </p>\n\n      {/* Build image */}\n      <Image\n        src={build.imageURL || placeholderImage}\n        alt={build.title}\n        width={150}\n        height={112}\n        className=\"mb-4 mx-auto object-cover\"\n        onError={(e) => {\n          console.error(\"Image failed to load:\", build.imageURL);\n          e.currentTarget.src = placeholderImage;\n        }}\n        onLoad={() => {\n          if (build.imageURL) {\n            console.log(\"Image loaded successfully:\", build.imageURL);\n          }\n        }}\n      />\n\n      {/* Description */}\n      {build.description && (\n        <div className=\"max-w-2xl mx-auto mb-4 px-4\">\n          <p className=\"text-sm leading-relaxed text-pretty\">\n            {build.description}\n          </p>\n        </div>\n      )}\n\n      {/* Difficulty, Attributes, and Villager counts */}\n      <div className=\"flex flex-wrap justify-center items-center gap-2 mb-2\">\n        {build.difficulty && <DifficultyBadge difficulty={build.difficulty} />}\n        {build.attributes && build.attributes.length > 0 && (\n          <AttributeBadges attributes={build.attributes} />\n        )}\n        <div className=\"[&>div]:mb-0\">\n          <VillagerCounts build={build} />\n        </div>\n      </div>\n\n      {/* Rating summary with Favorite Button */}\n      <div className=\"flex items-center justify-center gap-3 mb-4\">\n        <Rating rating={build.avg_rating} size=\"medium\" />\n        <FavoriteButton isFavorited={isFavorited} onToggle={onToggleFavorite} />\n      </div>\n\n      {/* Actions */}\n      <div className=\"flex flex-wrap justify-center gap-3 mb-6\">\n        <div className=\"flex-1 min-w-[180px] sm:flex-none\">\n          <Button onClick={onOpenRating} fullWidth>\n            {ratingButtonLabel}\n          </Button>\n        </div>\n\n        <div className=\"flex-1 min-w-[180px] sm:flex-none\">\n          <ExportButton build={build} fullWidth />\n        </div>\n\n        <div className=\"flex-1 min-w-[180px] sm:flex-none\">\n          <Button\n            onClick={onStartFocus}\n            disabled={!onStartFocus || !canUseFocusMode}\n            variant=\"secondary\"\n            fullWidth\n          >\n            Start Focus Mode\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n// Main Page Component\nexport default function BuildDetailPage() {\n  const params = useParams();\n  const router = useRouter();\n  const { currentUser } = useAuth();\n  const [build, setBuild] = useState<Build | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [userRating, setUserRating] = useState<number>(0);\n  const [submittingRating, setSubmittingRating] = useState(false);\n  const [isRatingModalOpen, setIsRatingModalOpen] = useState(false);\n  const [isAuthPromptOpen, setIsAuthPromptOpen] = useState(false);\n  const [favorites, setFavorites] = useState<string[]>([]);\n\n  const handleOpenRatingModal = () => {\n    if (!currentUser) {\n      setIsAuthPromptOpen(true);\n      return;\n    }\n\n    setIsRatingModalOpen(true);\n  };\n\n  useEffect(() => {\n    if (params.id) {\n      loadBuild(params.id as string);\n    }\n  }, [params.id]);\n\n  // Load user's existing rating when user or build changes\n  useEffect(() => {\n    if (currentUser && build?.id) {\n      loadUserRating(build.id, currentUser.uid);\n    } else {\n      setUserRating(0);\n    }\n  }, [currentUser, build?.id]);\n\n  // Load user's favorites when user changes\n  const loadUserFavorites = useCallback(async () => {\n    if (!currentUser) return;\n    try {\n      const userProfile = await DatabaseService.loadProfileInfo({\n        uid: currentUser.uid,\n      });\n      if (userProfile.favorites) {\n        setFavorites(userProfile.favorites);\n      } else {\n        setFavorites([]);\n      }\n    } catch (error) {\n      console.error(\"Failed to load user favorites:\", error);\n      // User profile doesn't exist yet - this is normal for new users\n      setFavorites([]);\n    }\n  }, [currentUser]);\n\n  useEffect(() => {\n    if (currentUser) {\n      loadUserFavorites();\n    } else {\n      setFavorites([]);\n    }\n  }, [currentUser, loadUserFavorites]);\n\n  const loadBuild = async (buildId: string) => {\n    try {\n      setLoading(true);\n      setError(null);\n      const buildData = await DatabaseService.loadPublishedBuildWithId(buildId);\n      setBuild(buildData);\n    } catch {\n      setError(\"Failed to load build\");\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const loadUserRating = async (buildId: string, userId: string) => {\n    try {\n      const rating = await DatabaseService.loadUserRatingForBuild(\n        buildId,\n        userId\n      );\n      setUserRating(rating.rating);\n    } catch {\n      // User hasn't rated this build yet, which is fine\n      setUserRating(0);\n    }\n  };\n\n  const handleRating = async (rating: number) => {\n    if (!currentUser) {\n      setIsRatingModalOpen(false);\n      setIsAuthPromptOpen(true);\n      return;\n    }\n\n    if (!build) return;\n\n    try {\n      setSubmittingRating(true);\n      await DatabaseService.rateBuildWithIdForUser(\n        build.id,\n        { uid: currentUser.uid },\n        rating\n      );\n      setUserRating(rating);\n\n      // Reload build to get updated average rating\n      await loadBuild(build.id);\n    } catch (error) {\n      console.error(\"Failed to submit rating:\", error);\n      alert(\"Failed to submit rating. Please try again.\");\n    } finally {\n      setSubmittingRating(false);\n    }\n  };\n\n  const handleStartFocus = useCallback(() => {\n    if (!build?.id) return;\n    router.push(`/builds/${build.id}/focus`);\n  }, [build?.id, router]);\n\n  const handleToggleFavorite = async () => {\n    if (!currentUser) {\n      setIsAuthPromptOpen(true);\n      return;\n    }\n\n    if (!build) return;\n\n    try {\n      const isFavorited = favorites.includes(build.id);\n\n      if (isFavorited) {\n        // Remove from favorites\n        setFavorites(favorites.filter((id) => id !== build.id));\n        await DatabaseService.removeFavBuildWithIdForUser(build.id, {\n          uid: currentUser.uid,\n        });\n      } else {\n        // Add to favorites\n        setFavorites([...favorites, build.id]);\n        await DatabaseService.favBuildWithIdForUser(build.id, {\n          uid: currentUser.uid,\n        });\n      }\n    } catch (error) {\n      console.error(\"Failed to toggle favorite:\", error);\n      // Show user-friendly error message\n      alert(\"Failed to update favorites. Please try again.\");\n      // Revert the local state change on error\n      await loadUserFavorites();\n    }\n  };\n\n  if (loading) {\n    return <LoadingView />;\n  }\n\n  if (error || !build) {\n    return <ErrorView error={error} />;\n  }\n\n  console.log(\"Build:\", build);\n\n  return (\n    <div className=\"min-h-screen bg-background\">\n      <Navigation />\n      <main className=\"max-w-4xl mx-auto py-6 sm:px-6 lg:px-8\">\n        <div className=\"px-4 sm:px-0\">\n          <BuildHeader\n            build={build}\n            userRating={userRating}\n            onOpenRating={handleOpenRatingModal}\n            onStartFocus={handleStartFocus}\n            isFavorited={favorites.includes(build.id)}\n            onToggleFavorite={handleToggleFavorite}\n          />\n\n          <BuildView build={build} />\n        </div>\n      </main>\n\n      {isRatingModalOpen && (\n        <RatingModal\n          isOpen={isRatingModalOpen}\n          onClose={() => setIsRatingModalOpen(false)}\n          userRating={userRating}\n          onRate={handleRating}\n          submitting={submittingRating}\n        />\n      )}\n\n      {isAuthPromptOpen && (\n        <AuthPromptModal\n          isOpen={isAuthPromptOpen}\n          onClose={() => setIsAuthPromptOpen(false)}\n          onLogin={() => router.push(\"/login\")}\n          onRegister={() => router.push(\"/register\")}\n        />\n      )}\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}